"use strict";var Fn=Object.defineProperty;var Dn=(a,t,e)=>t in a?Fn(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var Ce=(a,t,e)=>Dn(a,typeof t!="symbol"?t+"":t,e);const K=require("siyuan");var mt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Sn(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function gt(a){throw new Error('Could not dynamically require "'+a+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pn={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(a,t){(function(e){a.exports=e()})(function(){return function e(n,i,r){function o(u,g){if(!i[u]){if(!n[u]){var d=typeof gt=="function"&&gt;if(!g&&d)return d(u,!0);if(s)return s(u,!0);var p=new Error("Cannot find module '"+u+"'");throw p.code="MODULE_NOT_FOUND",p}var c=i[u]={exports:{}};n[u][0].call(c.exports,function(b){var m=n[u][1][b];return o(m||b)},c,c.exports,e,n,i,r)}return i[u].exports}for(var s=typeof gt=="function"&&gt,l=0;l<r.length;l++)o(r[l]);return o}({1:[function(e,n,i){var r=e("./utils"),o=e("./support"),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(l){for(var u,g,d,p,c,b,m,v=[],y=0,w=l.length,C=w,D=r.getTypeOf(l)!=="string";y<l.length;)C=w-y,d=D?(u=l[y++],g=y<w?l[y++]:0,y<w?l[y++]:0):(u=l.charCodeAt(y++),g=y<w?l.charCodeAt(y++):0,y<w?l.charCodeAt(y++):0),p=u>>2,c=(3&u)<<4|g>>4,b=1<C?(15&g)<<2|d>>6:64,m=2<C?63&d:64,v.push(s.charAt(p)+s.charAt(c)+s.charAt(b)+s.charAt(m));return v.join("")},i.decode=function(l){var u,g,d,p,c,b,m=0,v=0,y="data:";if(l.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var w,C=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===s.charAt(64)&&C--,l.charAt(l.length-2)===s.charAt(64)&&C--,C%1!=0)throw new Error("Invalid base64 input, bad content length.");for(w=o.uint8array?new Uint8Array(0|C):new Array(0|C);m<l.length;)u=s.indexOf(l.charAt(m++))<<2|(p=s.indexOf(l.charAt(m++)))>>4,g=(15&p)<<4|(c=s.indexOf(l.charAt(m++)))>>2,d=(3&c)<<6|(b=s.indexOf(l.charAt(m++))),w[v++]=u,c!==64&&(w[v++]=g),b!==64&&(w[v++]=d);return w}},{"./support":30,"./utils":32}],2:[function(e,n,i){var r=e("./external"),o=e("./stream/DataWorker"),s=e("./stream/Crc32Probe"),l=e("./stream/DataLengthProbe");function u(g,d,p,c,b){this.compressedSize=g,this.uncompressedSize=d,this.crc32=p,this.compression=c,this.compressedContent=b}u.prototype={getContentWorker:function(){var g=new o(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),d=this;return g.on("end",function(){if(this.streamInfo.data_length!==d.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),g},getCompressedWorker:function(){return new o(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},u.createWorkerFrom=function(g,d,p){return g.pipe(new s).pipe(new l("uncompressedSize")).pipe(d.compressWorker(p)).pipe(new l("compressedSize")).withStreamInfo("compression",d)},n.exports=u},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,n,i){var r=e("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},i.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,n,i){var r=e("./utils"),o=function(){for(var s,l=[],u=0;u<256;u++){s=u;for(var g=0;g<8;g++)s=1&s?3988292384^s>>>1:s>>>1;l[u]=s}return l}();n.exports=function(s,l){return s!==void 0&&s.length?r.getTypeOf(s)!=="string"?function(u,g,d,p){var c=o,b=p+d;u^=-1;for(var m=p;m<b;m++)u=u>>>8^c[255&(u^g[m])];return-1^u}(0|l,s,s.length,0):function(u,g,d,p){var c=o,b=p+d;u^=-1;for(var m=p;m<b;m++)u=u>>>8^c[255&(u^g.charCodeAt(m))];return-1^u}(0|l,s,s.length,0):0}},{"./utils":32}],5:[function(e,n,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(e,n,i){var r=null;r=typeof Promise<"u"?Promise:e("lie"),n.exports={Promise:r}},{lie:37}],7:[function(e,n,i){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=e("pako"),s=e("./utils"),l=e("./stream/GenericWorker"),u=r?"uint8array":"array";function g(d,p){l.call(this,"FlateWorker/"+d),this._pako=null,this._pakoAction=d,this._pakoOptions=p,this.meta={}}i.magic="\b\0",s.inherits(g,l),g.prototype.processChunk=function(d){this.meta=d.meta,this._pako===null&&this._createPako(),this._pako.push(s.transformTo(u,d.data),!1)},g.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},g.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},g.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var d=this;this._pako.onData=function(p){d.push({data:p,meta:d.meta})}},i.compressWorker=function(d){return new g("Deflate",d)},i.uncompressWorker=function(){return new g("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,n,i){function r(c,b){var m,v="";for(m=0;m<b;m++)v+=String.fromCharCode(255&c),c>>>=8;return v}function o(c,b,m,v,y,w){var C,D,x=c.file,B=c.compression,S=w!==u.utf8encode,z=s.transformTo("string",w(x.name)),T=s.transformTo("string",u.utf8encode(x.name)),Z=x.comment,ne=s.transformTo("string",w(Z)),F=s.transformTo("string",u.utf8encode(Z)),j=T.length!==x.name.length,h=F.length!==Z.length,L="",J="",U="",ee=x.dir,W=x.date,ie={crc32:0,compressedSize:0,uncompressedSize:0};b&&!m||(ie.crc32=c.crc32,ie.compressedSize=c.compressedSize,ie.uncompressedSize=c.uncompressedSize);var M=0;b&&(M|=8),S||!j&&!h||(M|=2048);var P=0,oe=0;ee&&(P|=16),y==="UNIX"?(oe=798,P|=function(Y,ye){var ve=Y;return Y||(ve=ye?16893:33204),(65535&ve)<<16}(x.unixPermissions,ee)):(oe=20,P|=function(Y){return 63&(Y||0)}(x.dosPermissions)),C=W.getUTCHours(),C<<=6,C|=W.getUTCMinutes(),C<<=5,C|=W.getUTCSeconds()/2,D=W.getUTCFullYear()-1980,D<<=4,D|=W.getUTCMonth()+1,D<<=5,D|=W.getUTCDate(),j&&(J=r(1,1)+r(g(z),4)+T,L+="up"+r(J.length,2)+J),h&&(U=r(1,1)+r(g(ne),4)+F,L+="uc"+r(U.length,2)+U);var te="";return te+=`
\0`,te+=r(M,2),te+=B.magic,te+=r(C,2),te+=r(D,2),te+=r(ie.crc32,4),te+=r(ie.compressedSize,4),te+=r(ie.uncompressedSize,4),te+=r(z.length,2),te+=r(L.length,2),{fileRecord:d.LOCAL_FILE_HEADER+te+z+L,dirRecord:d.CENTRAL_FILE_HEADER+r(oe,2)+te+r(ne.length,2)+"\0\0\0\0"+r(P,4)+r(v,4)+z+L+ne}}var s=e("../utils"),l=e("../stream/GenericWorker"),u=e("../utf8"),g=e("../crc32"),d=e("../signature");function p(c,b,m,v){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=b,this.zipPlatform=m,this.encodeFileName=v,this.streamFiles=c,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}s.inherits(p,l),p.prototype.push=function(c){var b=c.meta.percent||0,m=this.entriesCount,v=this._sources.length;this.accumulate?this.contentBuffer.push(c):(this.bytesWritten+=c.data.length,l.prototype.push.call(this,{data:c.data,meta:{currentFile:this.currentFile,percent:m?(b+100*(m-v-1))/m:100}}))},p.prototype.openedSource=function(c){this.currentSourceOffset=this.bytesWritten,this.currentFile=c.file.name;var b=this.streamFiles&&!c.file.dir;if(b){var m=o(c,b,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},p.prototype.closedSource=function(c){this.accumulate=!1;var b=this.streamFiles&&!c.file.dir,m=o(c,b,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),b)this.push({data:function(v){return d.DATA_DESCRIPTOR+r(v.crc32,4)+r(v.compressedSize,4)+r(v.uncompressedSize,4)}(c),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},p.prototype.flush=function(){for(var c=this.bytesWritten,b=0;b<this.dirRecords.length;b++)this.push({data:this.dirRecords[b],meta:{percent:100}});var m=this.bytesWritten-c,v=function(y,w,C,D,x){var B=s.transformTo("string",x(D));return d.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(y,2)+r(y,2)+r(w,4)+r(C,4)+r(B.length,2)+B}(this.dirRecords.length,m,c,this.zipComment,this.encodeFileName);this.push({data:v,meta:{percent:100}})},p.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},p.prototype.registerPrevious=function(c){this._sources.push(c);var b=this;return c.on("data",function(m){b.processChunk(m)}),c.on("end",function(){b.closedSource(b.previous.streamInfo),b._sources.length?b.prepareNextSource():b.end()}),c.on("error",function(m){b.error(m)}),this},p.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},p.prototype.error=function(c){var b=this._sources;if(!l.prototype.error.call(this,c))return!1;for(var m=0;m<b.length;m++)try{b[m].error(c)}catch{}return!0},p.prototype.lock=function(){l.prototype.lock.call(this);for(var c=this._sources,b=0;b<c.length;b++)c[b].lock()},n.exports=p},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,n,i){var r=e("../compressions"),o=e("./ZipFileWorker");i.generateWorker=function(s,l,u){var g=new o(l.streamFiles,u,l.platform,l.encodeFileName),d=0;try{s.forEach(function(p,c){d++;var b=function(w,C){var D=w||C,x=r[D];if(!x)throw new Error(D+" is not a valid compression method !");return x}(c.options.compression,l.compression),m=c.options.compressionOptions||l.compressionOptions||{},v=c.dir,y=c.date;c._compressWorker(b,m).withStreamInfo("file",{name:p,dir:v,date:y,comment:c.comment||"",unixPermissions:c.unixPermissions,dosPermissions:c.dosPermissions}).pipe(g)}),g.entriesCount=d}catch(p){g.error(p)}return g}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,n,i){function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new r;for(var s in this)typeof this[s]!="function"&&(o[s]=this[s]);return o}}(r.prototype=e("./object")).loadAsync=e("./load"),r.support=e("./support"),r.defaults=e("./defaults"),r.version="3.10.1",r.loadAsync=function(o,s){return new r().loadAsync(o,s)},r.external=e("./external"),n.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,n,i){var r=e("./utils"),o=e("./external"),s=e("./utf8"),l=e("./zipEntries"),u=e("./stream/Crc32Probe"),g=e("./nodejsUtils");function d(p){return new o.Promise(function(c,b){var m=p.decompressed.getContentWorker().pipe(new u);m.on("error",function(v){b(v)}).on("end",function(){m.streamInfo.crc32!==p.decompressed.crc32?b(new Error("Corrupted zip : CRC32 mismatch")):c()}).resume()})}n.exports=function(p,c){var b=this;return c=r.extend(c||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),g.isNode&&g.isStream(p)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",p,!0,c.optimizedBinaryString,c.base64).then(function(m){var v=new l(c);return v.load(m),v}).then(function(m){var v=[o.Promise.resolve(m)],y=m.files;if(c.checkCRC32)for(var w=0;w<y.length;w++)v.push(d(y[w]));return o.Promise.all(v)}).then(function(m){for(var v=m.shift(),y=v.files,w=0;w<y.length;w++){var C=y[w],D=C.fileNameStr,x=r.resolve(C.fileNameStr);b.file(x,C.decompressed,{binary:!0,optimizedBinaryString:!0,date:C.date,dir:C.dir,comment:C.fileCommentStr.length?C.fileCommentStr:null,unixPermissions:C.unixPermissions,dosPermissions:C.dosPermissions,createFolders:c.createFolders}),C.dir||(b.file(x).unsafeOriginalName=D)}return v.zipComment.length&&(b.comment=v.zipComment),b})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,n,i){var r=e("../utils"),o=e("../stream/GenericWorker");function s(l,u){o.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(u)}r.inherits(s,o),s.prototype._bindStream=function(l){var u=this;(this._stream=l).pause(),l.on("data",function(g){u.push({data:g,meta:{percent:0}})}).on("error",function(g){u.isPaused?this.generatedError=g:u.error(g)}).on("end",function(){u.isPaused?u._upstreamEnded=!0:u.end()})},s.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},n.exports=s},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,n,i){var r=e("readable-stream").Readable;function o(s,l,u){r.call(this,l),this._helper=s;var g=this;s.on("data",function(d,p){g.push(d)||g._helper.pause(),u&&u(p)}).on("error",function(d){g.emit("error",d)}).on("end",function(){g.push(null)})}e("../utils").inherits(o,r),o.prototype._read=function(){this._helper.resume()},n.exports=o},{"../utils":32,"readable-stream":16}],14:[function(e,n,i){n.exports={isNode:typeof Buffer<"u",newBufferFrom:function(r,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(r,o);if(typeof r=="number")throw new Error('The "data" argument must not be a number');return new Buffer(r,o)},allocBuffer:function(r){if(Buffer.alloc)return Buffer.alloc(r);var o=new Buffer(r);return o.fill(0),o},isBuffer:function(r){return Buffer.isBuffer(r)},isStream:function(r){return r&&typeof r.on=="function"&&typeof r.pause=="function"&&typeof r.resume=="function"}}},{}],15:[function(e,n,i){function r(x,B,S){var z,T=s.getTypeOf(B),Z=s.extend(S||{},g);Z.date=Z.date||new Date,Z.compression!==null&&(Z.compression=Z.compression.toUpperCase()),typeof Z.unixPermissions=="string"&&(Z.unixPermissions=parseInt(Z.unixPermissions,8)),Z.unixPermissions&&16384&Z.unixPermissions&&(Z.dir=!0),Z.dosPermissions&&16&Z.dosPermissions&&(Z.dir=!0),Z.dir&&(x=y(x)),Z.createFolders&&(z=v(x))&&w.call(this,z,!0);var ne=T==="string"&&Z.binary===!1&&Z.base64===!1;S&&S.binary!==void 0||(Z.binary=!ne),(B instanceof d&&B.uncompressedSize===0||Z.dir||!B||B.length===0)&&(Z.base64=!1,Z.binary=!0,B="",Z.compression="STORE",T="string");var F=null;F=B instanceof d||B instanceof l?B:b.isNode&&b.isStream(B)?new m(x,B):s.prepareContent(x,B,Z.binary,Z.optimizedBinaryString,Z.base64);var j=new p(x,F,Z);this.files[x]=j}var o=e("./utf8"),s=e("./utils"),l=e("./stream/GenericWorker"),u=e("./stream/StreamHelper"),g=e("./defaults"),d=e("./compressedObject"),p=e("./zipObject"),c=e("./generate"),b=e("./nodejsUtils"),m=e("./nodejs/NodejsStreamInputAdapter"),v=function(x){x.slice(-1)==="/"&&(x=x.substring(0,x.length-1));var B=x.lastIndexOf("/");return 0<B?x.substring(0,B):""},y=function(x){return x.slice(-1)!=="/"&&(x+="/"),x},w=function(x,B){return B=B!==void 0?B:g.createFolders,x=y(x),this.files[x]||r.call(this,x,null,{dir:!0,createFolders:B}),this.files[x]};function C(x){return Object.prototype.toString.call(x)==="[object RegExp]"}var D={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(x){var B,S,z;for(B in this.files)z=this.files[B],(S=B.slice(this.root.length,B.length))&&B.slice(0,this.root.length)===this.root&&x(S,z)},filter:function(x){var B=[];return this.forEach(function(S,z){x(S,z)&&B.push(z)}),B},file:function(x,B,S){if(arguments.length!==1)return x=this.root+x,r.call(this,x,B,S),this;if(C(x)){var z=x;return this.filter(function(Z,ne){return!ne.dir&&z.test(Z)})}var T=this.files[this.root+x];return T&&!T.dir?T:null},folder:function(x){if(!x)return this;if(C(x))return this.filter(function(T,Z){return Z.dir&&x.test(T)});var B=this.root+x,S=w.call(this,B),z=this.clone();return z.root=S.name,z},remove:function(x){x=this.root+x;var B=this.files[x];if(B||(x.slice(-1)!=="/"&&(x+="/"),B=this.files[x]),B&&!B.dir)delete this.files[x];else for(var S=this.filter(function(T,Z){return Z.name.slice(0,x.length)===x}),z=0;z<S.length;z++)delete this.files[S[z].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(x){var B,S={};try{if((S=s.extend(x||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=S.type.toLowerCase(),S.compression=S.compression.toUpperCase(),S.type==="binarystring"&&(S.type="string"),!S.type)throw new Error("No output type specified.");s.checkSupport(S.type),S.platform!=="darwin"&&S.platform!=="freebsd"&&S.platform!=="linux"&&S.platform!=="sunos"||(S.platform="UNIX"),S.platform==="win32"&&(S.platform="DOS");var z=S.comment||this.comment||"";B=c.generateWorker(this,S,z)}catch(T){(B=new l("error")).error(T)}return new u(B,S.type||"string",S.mimeType)},generateAsync:function(x,B){return this.generateInternalStream(x).accumulate(B)},generateNodeStream:function(x,B){return(x=x||{}).type||(x.type="nodebuffer"),this.generateInternalStream(x).toNodejsStream(B)}};n.exports=D},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,n,i){n.exports=e("stream")},{stream:void 0}],17:[function(e,n,i){var r=e("./DataReader");function o(s){r.call(this,s);for(var l=0;l<this.data.length;l++)s[l]=255&s[l]}e("../utils").inherits(o,r),o.prototype.byteAt=function(s){return this.data[this.zero+s]},o.prototype.lastIndexOfSignature=function(s){for(var l=s.charCodeAt(0),u=s.charCodeAt(1),g=s.charCodeAt(2),d=s.charCodeAt(3),p=this.length-4;0<=p;--p)if(this.data[p]===l&&this.data[p+1]===u&&this.data[p+2]===g&&this.data[p+3]===d)return p-this.zero;return-1},o.prototype.readAndCheckSignature=function(s){var l=s.charCodeAt(0),u=s.charCodeAt(1),g=s.charCodeAt(2),d=s.charCodeAt(3),p=this.readData(4);return l===p[0]&&u===p[1]&&g===p[2]&&d===p[3]},o.prototype.readData=function(s){if(this.checkOffset(s),s===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,l},n.exports=o},{"../utils":32,"./DataReader":18}],18:[function(e,n,i){var r=e("../utils");function o(s){this.data=s,this.length=s.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(s){this.checkIndex(this.index+s)},checkIndex:function(s){if(this.length<this.zero+s||s<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+s+"). Corrupted zip ?")},setIndex:function(s){this.checkIndex(s),this.index=s},skip:function(s){this.setIndex(this.index+s)},byteAt:function(){},readInt:function(s){var l,u=0;for(this.checkOffset(s),l=this.index+s-1;l>=this.index;l--)u=(u<<8)+this.byteAt(l);return this.index+=s,u},readString:function(s){return r.transformTo("string",this.readData(s))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var s=this.readInt(4);return new Date(Date.UTC(1980+(s>>25&127),(s>>21&15)-1,s>>16&31,s>>11&31,s>>5&63,(31&s)<<1))}},n.exports=o},{"../utils":32}],19:[function(e,n,i){var r=e("./Uint8ArrayReader");function o(s){r.call(this,s)}e("../utils").inherits(o,r),o.prototype.readData=function(s){this.checkOffset(s);var l=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,l},n.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,n,i){var r=e("./DataReader");function o(s){r.call(this,s)}e("../utils").inherits(o,r),o.prototype.byteAt=function(s){return this.data.charCodeAt(this.zero+s)},o.prototype.lastIndexOfSignature=function(s){return this.data.lastIndexOf(s)-this.zero},o.prototype.readAndCheckSignature=function(s){return s===this.readData(4)},o.prototype.readData=function(s){this.checkOffset(s);var l=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,l},n.exports=o},{"../utils":32,"./DataReader":18}],21:[function(e,n,i){var r=e("./ArrayReader");function o(s){r.call(this,s)}e("../utils").inherits(o,r),o.prototype.readData=function(s){if(this.checkOffset(s),s===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+s);return this.index+=s,l},n.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(e,n,i){var r=e("../utils"),o=e("../support"),s=e("./ArrayReader"),l=e("./StringReader"),u=e("./NodeBufferReader"),g=e("./Uint8ArrayReader");n.exports=function(d){var p=r.getTypeOf(d);return r.checkSupport(p),p!=="string"||o.uint8array?p==="nodebuffer"?new u(d):o.uint8array?new g(r.transformTo("uint8array",d)):new s(r.transformTo("array",d)):new l(d)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,n,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,n,i){var r=e("./GenericWorker"),o=e("../utils");function s(l){r.call(this,"ConvertWorker to "+l),this.destType=l}o.inherits(s,r),s.prototype.processChunk=function(l){this.push({data:o.transformTo(this.destType,l.data),meta:l.meta})},n.exports=s},{"../utils":32,"./GenericWorker":28}],25:[function(e,n,i){var r=e("./GenericWorker"),o=e("../crc32");function s(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(s,r),s.prototype.processChunk=function(l){this.streamInfo.crc32=o(l.data,this.streamInfo.crc32||0),this.push(l)},n.exports=s},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,n,i){var r=e("../utils"),o=e("./GenericWorker");function s(l){o.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}r.inherits(s,o),s.prototype.processChunk=function(l){if(l){var u=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=u+l.data.length}o.prototype.processChunk.call(this,l)},n.exports=s},{"../utils":32,"./GenericWorker":28}],27:[function(e,n,i){var r=e("../utils"),o=e("./GenericWorker");function s(l){o.call(this,"DataWorker");var u=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(g){u.dataIsReady=!0,u.data=g,u.max=g&&g.length||0,u.type=r.getTypeOf(g),u.isPaused||u._tickAndRepeat()},function(g){u.error(g)})}r.inherits(s,o),s.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},s.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,u=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,u);break;case"uint8array":l=this.data.subarray(this.index,u);break;case"array":case"nodebuffer":l=this.data.slice(this.index,u)}return this.index=u,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},n.exports=s},{"../utils":32,"./GenericWorker":28}],28:[function(e,n,i){function r(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,s){return this._listeners[o].push(s),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,s){if(this._listeners[o])for(var l=0;l<this._listeners[o].length;l++)this._listeners[o][l].call(this,s)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var s=this;return o.on("data",function(l){s.processChunk(l)}),o.on("end",function(){s.end()}),o.on("error",function(l){s.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,s){return this.extraStreamInfo[o]=s,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},n.exports=r},{}],29:[function(e,n,i){var r=e("../utils"),o=e("./ConvertWorker"),s=e("./GenericWorker"),l=e("../base64"),u=e("../support"),g=e("../external"),d=null;if(u.nodestream)try{d=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function p(b,m){return new g.Promise(function(v,y){var w=[],C=b._internalType,D=b._outputType,x=b._mimeType;b.on("data",function(B,S){w.push(B),m&&m(S)}).on("error",function(B){w=[],y(B)}).on("end",function(){try{var B=function(S,z,T){switch(S){case"blob":return r.newBlob(r.transformTo("arraybuffer",z),T);case"base64":return l.encode(z);default:return r.transformTo(S,z)}}(D,function(S,z){var T,Z=0,ne=null,F=0;for(T=0;T<z.length;T++)F+=z[T].length;switch(S){case"string":return z.join("");case"array":return Array.prototype.concat.apply([],z);case"uint8array":for(ne=new Uint8Array(F),T=0;T<z.length;T++)ne.set(z[T],Z),Z+=z[T].length;return ne;case"nodebuffer":return Buffer.concat(z);default:throw new Error("concat : unsupported type '"+S+"'")}}(C,w),x);v(B)}catch(S){y(S)}w=[]}).resume()})}function c(b,m,v){var y=m;switch(m){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=m,this._mimeType=v,r.checkSupport(y),this._worker=b.pipe(new o(y)),b.lock()}catch(w){this._worker=new s("error"),this._worker.error(w)}}c.prototype={accumulate:function(b){return p(this,b)},on:function(b,m){var v=this;return b==="data"?this._worker.on(b,function(y){m.call(v,y.data,y.meta)}):this._worker.on(b,function(){r.delay(m,arguments,v)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(b){if(r.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:this._outputType!=="nodebuffer"},b)}},n.exports=c},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,n,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var r=new ArrayBuffer(0);try{i.blob=new Blob([r],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(r),i.blob=o.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!e("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(e,n,i){for(var r=e("./utils"),o=e("./support"),s=e("./nodejsUtils"),l=e("./stream/GenericWorker"),u=new Array(256),g=0;g<256;g++)u[g]=252<=g?6:248<=g?5:240<=g?4:224<=g?3:192<=g?2:1;u[254]=u[254]=1;function d(){l.call(this,"utf-8 decode"),this.leftOver=null}function p(){l.call(this,"utf-8 encode")}i.utf8encode=function(c){return o.nodebuffer?s.newBufferFrom(c,"utf-8"):function(b){var m,v,y,w,C,D=b.length,x=0;for(w=0;w<D;w++)(64512&(v=b.charCodeAt(w)))==55296&&w+1<D&&(64512&(y=b.charCodeAt(w+1)))==56320&&(v=65536+(v-55296<<10)+(y-56320),w++),x+=v<128?1:v<2048?2:v<65536?3:4;for(m=o.uint8array?new Uint8Array(x):new Array(x),w=C=0;C<x;w++)(64512&(v=b.charCodeAt(w)))==55296&&w+1<D&&(64512&(y=b.charCodeAt(w+1)))==56320&&(v=65536+(v-55296<<10)+(y-56320),w++),v<128?m[C++]=v:(v<2048?m[C++]=192|v>>>6:(v<65536?m[C++]=224|v>>>12:(m[C++]=240|v>>>18,m[C++]=128|v>>>12&63),m[C++]=128|v>>>6&63),m[C++]=128|63&v);return m}(c)},i.utf8decode=function(c){return o.nodebuffer?r.transformTo("nodebuffer",c).toString("utf-8"):function(b){var m,v,y,w,C=b.length,D=new Array(2*C);for(m=v=0;m<C;)if((y=b[m++])<128)D[v++]=y;else if(4<(w=u[y]))D[v++]=65533,m+=w-1;else{for(y&=w===2?31:w===3?15:7;1<w&&m<C;)y=y<<6|63&b[m++],w--;1<w?D[v++]=65533:y<65536?D[v++]=y:(y-=65536,D[v++]=55296|y>>10&1023,D[v++]=56320|1023&y)}return D.length!==v&&(D.subarray?D=D.subarray(0,v):D.length=v),r.applyFromCharCode(D)}(c=r.transformTo(o.uint8array?"uint8array":"array",c))},r.inherits(d,l),d.prototype.processChunk=function(c){var b=r.transformTo(o.uint8array?"uint8array":"array",c.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=b;(b=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),b.set(m,this.leftOver.length)}else b=this.leftOver.concat(b);this.leftOver=null}var v=function(w,C){var D;for((C=C||w.length)>w.length&&(C=w.length),D=C-1;0<=D&&(192&w[D])==128;)D--;return D<0||D===0?C:D+u[w[D]]>C?D:C}(b),y=b;v!==b.length&&(o.uint8array?(y=b.subarray(0,v),this.leftOver=b.subarray(v,b.length)):(y=b.slice(0,v),this.leftOver=b.slice(v,b.length))),this.push({data:i.utf8decode(y),meta:c.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=d,r.inherits(p,l),p.prototype.processChunk=function(c){this.push({data:i.utf8encode(c.data),meta:c.meta})},i.Utf8EncodeWorker=p},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,n,i){var r=e("./support"),o=e("./base64"),s=e("./nodejsUtils"),l=e("./external");function u(m){return m}function g(m,v){for(var y=0;y<m.length;++y)v[y]=255&m.charCodeAt(y);return v}e("setimmediate"),i.newBlob=function(m,v){i.checkSupport("blob");try{return new Blob([m],{type:v})}catch{try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(m),y.getBlob(v)}catch{throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(m,v,y){var w=[],C=0,D=m.length;if(D<=y)return String.fromCharCode.apply(null,m);for(;C<D;)v==="array"||v==="nodebuffer"?w.push(String.fromCharCode.apply(null,m.slice(C,Math.min(C+y,D)))):w.push(String.fromCharCode.apply(null,m.subarray(C,Math.min(C+y,D)))),C+=y;return w.join("")},stringifyByChar:function(m){for(var v="",y=0;y<m.length;y++)v+=String.fromCharCode(m[y]);return v},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&String.fromCharCode.apply(null,s.allocBuffer(1)).length===1}catch{return!1}}()}};function p(m){var v=65536,y=i.getTypeOf(m),w=!0;if(y==="uint8array"?w=d.applyCanBeUsed.uint8array:y==="nodebuffer"&&(w=d.applyCanBeUsed.nodebuffer),w)for(;1<v;)try{return d.stringifyByChunk(m,y,v)}catch{v=Math.floor(v/2)}return d.stringifyByChar(m)}function c(m,v){for(var y=0;y<m.length;y++)v[y]=m[y];return v}i.applyFromCharCode=p;var b={};b.string={string:u,array:function(m){return g(m,new Array(m.length))},arraybuffer:function(m){return b.string.uint8array(m).buffer},uint8array:function(m){return g(m,new Uint8Array(m.length))},nodebuffer:function(m){return g(m,s.allocBuffer(m.length))}},b.array={string:p,array:u,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return s.newBufferFrom(m)}},b.arraybuffer={string:function(m){return p(new Uint8Array(m))},array:function(m){return c(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:u,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return s.newBufferFrom(new Uint8Array(m))}},b.uint8array={string:p,array:function(m){return c(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:u,nodebuffer:function(m){return s.newBufferFrom(m)}},b.nodebuffer={string:p,array:function(m){return c(m,new Array(m.length))},arraybuffer:function(m){return b.nodebuffer.uint8array(m).buffer},uint8array:function(m){return c(m,new Uint8Array(m.length))},nodebuffer:u},i.transformTo=function(m,v){if(v=v||"",!m)return v;i.checkSupport(m);var y=i.getTypeOf(v);return b[y][m](v)},i.resolve=function(m){for(var v=m.split("/"),y=[],w=0;w<v.length;w++){var C=v[w];C==="."||C===""&&w!==0&&w!==v.length-1||(C===".."?y.pop():y.push(C))}return y.join("/")},i.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":r.nodebuffer&&s.isBuffer(m)?"nodebuffer":r.uint8array&&m instanceof Uint8Array?"uint8array":r.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(m){if(!r[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(m){var v,y,w="";for(y=0;y<(m||"").length;y++)w+="\\x"+((v=m.charCodeAt(y))<16?"0":"")+v.toString(16).toUpperCase();return w},i.delay=function(m,v,y){setImmediate(function(){m.apply(y||null,v||[])})},i.inherits=function(m,v){function y(){}y.prototype=v.prototype,m.prototype=new y},i.extend=function(){var m,v,y={};for(m=0;m<arguments.length;m++)for(v in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],v)&&y[v]===void 0&&(y[v]=arguments[m][v]);return y},i.prepareContent=function(m,v,y,w,C){return l.Promise.resolve(v).then(function(D){return r.blob&&(D instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(D))!==-1)&&typeof FileReader<"u"?new l.Promise(function(x,B){var S=new FileReader;S.onload=function(z){x(z.target.result)},S.onerror=function(z){B(z.target.error)},S.readAsArrayBuffer(D)}):D}).then(function(D){var x=i.getTypeOf(D);return x?(x==="arraybuffer"?D=i.transformTo("uint8array",D):x==="string"&&(C?D=o.decode(D):y&&w!==!0&&(D=function(B){return g(B,r.uint8array?new Uint8Array(B.length):new Array(B.length))}(D))),D):l.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,n,i){var r=e("./reader/readerFor"),o=e("./utils"),s=e("./signature"),l=e("./zipEntry"),u=e("./support");function g(d){this.files=[],this.loadOptions=d}g.prototype={checkSignature:function(d){if(!this.reader.readAndCheckSignature(d)){this.reader.index-=4;var p=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(p)+", expected "+o.pretty(d)+")")}},isSignature:function(d,p){var c=this.reader.index;this.reader.setIndex(d);var b=this.reader.readString(4)===p;return this.reader.setIndex(c),b},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var d=this.reader.readData(this.zipCommentLength),p=u.uint8array?"uint8array":"array",c=o.transformTo(p,d);this.zipComment=this.loadOptions.decodeFileName(c)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var d,p,c,b=this.zip64EndOfCentralSize-44;0<b;)d=this.reader.readInt(2),p=this.reader.readInt(4),c=this.reader.readData(p),this.zip64ExtensibleData[d]={id:d,length:p,value:c}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var d,p;for(d=0;d<this.files.length;d++)p=this.files[d],this.reader.setIndex(p.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),p.readLocalPart(this.reader),p.handleUTF8(),p.processAttributes()},readCentralDir:function(){var d;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(d=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(d);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var d=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(d<0)throw this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(d);var p=d;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(d=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(d),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var c=this.centralDirOffset+this.centralDirSize;this.zip64&&(c+=20,c+=12+this.zip64EndOfCentralSize);var b=p-c;if(0<b)this.isSignature(p,s.CENTRAL_FILE_HEADER)||(this.reader.zero=b);else if(b<0)throw new Error("Corrupted zip: missing "+Math.abs(b)+" bytes.")},prepareReader:function(d){this.reader=r(d)},load:function(d){this.prepareReader(d),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},n.exports=g},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,n,i){var r=e("./reader/readerFor"),o=e("./utils"),s=e("./compressedObject"),l=e("./crc32"),u=e("./utf8"),g=e("./compressions"),d=e("./support");function p(c,b){this.options=c,this.loadOptions=b}p.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(c){var b,m;if(c.skip(22),this.fileNameLength=c.readInt(2),m=c.readInt(2),this.fileName=c.readData(this.fileNameLength),c.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((b=function(v){for(var y in g)if(Object.prototype.hasOwnProperty.call(g,y)&&g[y].magic===v)return g[y];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,b,c.readData(this.compressedSize))},readCentralPart:function(c){this.versionMadeBy=c.readInt(2),c.skip(2),this.bitFlag=c.readInt(2),this.compressionMethod=c.readString(2),this.date=c.readDate(),this.crc32=c.readInt(4),this.compressedSize=c.readInt(4),this.uncompressedSize=c.readInt(4);var b=c.readInt(2);if(this.extraFieldsLength=c.readInt(2),this.fileCommentLength=c.readInt(2),this.diskNumberStart=c.readInt(2),this.internalFileAttributes=c.readInt(2),this.externalFileAttributes=c.readInt(4),this.localHeaderOffset=c.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");c.skip(b),this.readExtraFields(c),this.parseZIP64ExtraField(c),this.fileComment=c.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var c=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),c==0&&(this.dosPermissions=63&this.externalFileAttributes),c==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var c=r(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=c.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=c.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=c.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=c.readInt(4))}},readExtraFields:function(c){var b,m,v,y=c.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});c.index+4<y;)b=c.readInt(2),m=c.readInt(2),v=c.readData(m),this.extraFields[b]={id:b,length:m,value:v};c.setIndex(y)},handleUTF8:function(){var c=d.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var b=this.findExtraFieldUnicodePath();if(b!==null)this.fileNameStr=b;else{var m=o.transformTo(c,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var v=this.findExtraFieldUnicodeComment();if(v!==null)this.fileCommentStr=v;else{var y=o.transformTo(c,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var c=this.extraFields[28789];if(c){var b=r(c.value);return b.readInt(1)!==1||l(this.fileName)!==b.readInt(4)?null:u.utf8decode(b.readData(c.length-5))}return null},findExtraFieldUnicodeComment:function(){var c=this.extraFields[25461];if(c){var b=r(c.value);return b.readInt(1)!==1||l(this.fileComment)!==b.readInt(4)?null:u.utf8decode(b.readData(c.length-5))}return null}},n.exports=p},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,n,i){function r(b,m,v){this.name=b,this.dir=v.dir,this.date=v.date,this.comment=v.comment,this.unixPermissions=v.unixPermissions,this.dosPermissions=v.dosPermissions,this._data=m,this._dataBinary=v.binary,this.options={compression:v.compression,compressionOptions:v.compressionOptions}}var o=e("./stream/StreamHelper"),s=e("./stream/DataWorker"),l=e("./utf8"),u=e("./compressedObject"),g=e("./stream/GenericWorker");r.prototype={internalStream:function(b){var m=null,v="string";try{if(!b)throw new Error("No output type specified.");var y=(v=b.toLowerCase())==="string"||v==="text";v!=="binarystring"&&v!=="text"||(v="string"),m=this._decompressWorker();var w=!this._dataBinary;w&&!y&&(m=m.pipe(new l.Utf8EncodeWorker)),!w&&y&&(m=m.pipe(new l.Utf8DecodeWorker))}catch(C){(m=new g("error")).error(C)}return new o(m,v,"")},async:function(b,m){return this.internalStream(b).accumulate(m)},nodeStream:function(b,m){return this.internalStream(b||"nodebuffer").toNodejsStream(m)},_compressWorker:function(b,m){if(this._data instanceof u&&this._data.compression.magic===b.magic)return this._data.getCompressedWorker();var v=this._decompressWorker();return this._dataBinary||(v=v.pipe(new l.Utf8EncodeWorker)),u.createWorkerFrom(v,b,m)},_decompressWorker:function(){return this._data instanceof u?this._data.getContentWorker():this._data instanceof g?this._data:new s(this._data)}};for(var d=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],p=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},c=0;c<d.length;c++)r.prototype[d[c]]=p;n.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,n,i){(function(r){var o,s,l=r.MutationObserver||r.WebKitMutationObserver;if(l){var u=0,g=new l(b),d=r.document.createTextNode("");g.observe(d,{characterData:!0}),o=function(){d.data=u=++u%2}}else if(r.setImmediate||r.MessageChannel===void 0)o="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var m=r.document.createElement("script");m.onreadystatechange=function(){b(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},r.document.documentElement.appendChild(m)}:function(){setTimeout(b,0)};else{var p=new r.MessageChannel;p.port1.onmessage=b,o=function(){p.port2.postMessage(0)}}var c=[];function b(){var m,v;s=!0;for(var y=c.length;y;){for(v=c,c=[],m=-1;++m<y;)v[m]();y=c.length}s=!1}n.exports=function(m){c.push(m)!==1||s||o()}}).call(this,typeof mt<"u"?mt:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,n,i){var r=e("immediate");function o(){}var s={},l=["REJECTED"],u=["FULFILLED"],g=["PENDING"];function d(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=g,this.queue=[],this.outcome=void 0,y!==o&&m(this,y)}function p(y,w,C){this.promise=y,typeof w=="function"&&(this.onFulfilled=w,this.callFulfilled=this.otherCallFulfilled),typeof C=="function"&&(this.onRejected=C,this.callRejected=this.otherCallRejected)}function c(y,w,C){r(function(){var D;try{D=w(C)}catch(x){return s.reject(y,x)}D===y?s.reject(y,new TypeError("Cannot resolve promise with itself")):s.resolve(y,D)})}function b(y){var w=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof w=="function")return function(){w.apply(y,arguments)}}function m(y,w){var C=!1;function D(S){C||(C=!0,s.reject(y,S))}function x(S){C||(C=!0,s.resolve(y,S))}var B=v(function(){w(x,D)});B.status==="error"&&D(B.value)}function v(y,w){var C={};try{C.value=y(w),C.status="success"}catch(D){C.status="error",C.value=D}return C}(n.exports=d).prototype.finally=function(y){if(typeof y!="function")return this;var w=this.constructor;return this.then(function(C){return w.resolve(y()).then(function(){return C})},function(C){return w.resolve(y()).then(function(){throw C})})},d.prototype.catch=function(y){return this.then(null,y)},d.prototype.then=function(y,w){if(typeof y!="function"&&this.state===u||typeof w!="function"&&this.state===l)return this;var C=new this.constructor(o);return this.state!==g?c(C,this.state===u?y:w,this.outcome):this.queue.push(new p(C,y,w)),C},p.prototype.callFulfilled=function(y){s.resolve(this.promise,y)},p.prototype.otherCallFulfilled=function(y){c(this.promise,this.onFulfilled,y)},p.prototype.callRejected=function(y){s.reject(this.promise,y)},p.prototype.otherCallRejected=function(y){c(this.promise,this.onRejected,y)},s.resolve=function(y,w){var C=v(b,w);if(C.status==="error")return s.reject(y,C.value);var D=C.value;if(D)m(y,D);else{y.state=u,y.outcome=w;for(var x=-1,B=y.queue.length;++x<B;)y.queue[x].callFulfilled(w)}return y},s.reject=function(y,w){y.state=l,y.outcome=w;for(var C=-1,D=y.queue.length;++C<D;)y.queue[C].callRejected(w);return y},d.resolve=function(y){return y instanceof this?y:s.resolve(new this(o),y)},d.reject=function(y){var w=new this(o);return s.reject(w,y)},d.all=function(y){var w=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=y.length,D=!1;if(!C)return this.resolve([]);for(var x=new Array(C),B=0,S=-1,z=new this(o);++S<C;)T(y[S],S);return z;function T(Z,ne){w.resolve(Z).then(function(F){x[ne]=F,++B!==C||D||(D=!0,s.resolve(z,x))},function(F){D||(D=!0,s.reject(z,F))})}},d.race=function(y){var w=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=y.length,D=!1;if(!C)return this.resolve([]);for(var x=-1,B=new this(o);++x<C;)S=y[x],w.resolve(S).then(function(z){D||(D=!0,s.resolve(B,z))},function(z){D||(D=!0,s.reject(B,z))});var S;return B}},{immediate:36}],38:[function(e,n,i){var r={};(0,e("./lib/utils/common").assign)(r,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),n.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,n,i){var r=e("./zlib/deflate"),o=e("./utils/common"),s=e("./utils/strings"),l=e("./zlib/messages"),u=e("./zlib/zstream"),g=Object.prototype.toString,d=0,p=-1,c=0,b=8;function m(y){if(!(this instanceof m))return new m(y);this.options=o.assign({level:p,method:b,chunkSize:16384,windowBits:15,memLevel:8,strategy:c,to:""},y||{});var w=this.options;w.raw&&0<w.windowBits?w.windowBits=-w.windowBits:w.gzip&&0<w.windowBits&&w.windowBits<16&&(w.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var C=r.deflateInit2(this.strm,w.level,w.method,w.windowBits,w.memLevel,w.strategy);if(C!==d)throw new Error(l[C]);if(w.header&&r.deflateSetHeader(this.strm,w.header),w.dictionary){var D;if(D=typeof w.dictionary=="string"?s.string2buf(w.dictionary):g.call(w.dictionary)==="[object ArrayBuffer]"?new Uint8Array(w.dictionary):w.dictionary,(C=r.deflateSetDictionary(this.strm,D))!==d)throw new Error(l[C]);this._dict_set=!0}}function v(y,w){var C=new m(w);if(C.push(y,!0),C.err)throw C.msg||l[C.err];return C.result}m.prototype.push=function(y,w){var C,D,x=this.strm,B=this.options.chunkSize;if(this.ended)return!1;D=w===~~w?w:w===!0?4:0,typeof y=="string"?x.input=s.string2buf(y):g.call(y)==="[object ArrayBuffer]"?x.input=new Uint8Array(y):x.input=y,x.next_in=0,x.avail_in=x.input.length;do{if(x.avail_out===0&&(x.output=new o.Buf8(B),x.next_out=0,x.avail_out=B),(C=r.deflate(x,D))!==1&&C!==d)return this.onEnd(C),!(this.ended=!0);x.avail_out!==0&&(x.avail_in!==0||D!==4&&D!==2)||(this.options.to==="string"?this.onData(s.buf2binstring(o.shrinkBuf(x.output,x.next_out))):this.onData(o.shrinkBuf(x.output,x.next_out)))}while((0<x.avail_in||x.avail_out===0)&&C!==1);return D===4?(C=r.deflateEnd(this.strm),this.onEnd(C),this.ended=!0,C===d):D!==2||(this.onEnd(d),!(x.avail_out=0))},m.prototype.onData=function(y){this.chunks.push(y)},m.prototype.onEnd=function(y){y===d&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},i.Deflate=m,i.deflate=v,i.deflateRaw=function(y,w){return(w=w||{}).raw=!0,v(y,w)},i.gzip=function(y,w){return(w=w||{}).gzip=!0,v(y,w)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,n,i){var r=e("./zlib/inflate"),o=e("./utils/common"),s=e("./utils/strings"),l=e("./zlib/constants"),u=e("./zlib/messages"),g=e("./zlib/zstream"),d=e("./zlib/gzheader"),p=Object.prototype.toString;function c(m){if(!(this instanceof c))return new c(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var v=this.options;v.raw&&0<=v.windowBits&&v.windowBits<16&&(v.windowBits=-v.windowBits,v.windowBits===0&&(v.windowBits=-15)),!(0<=v.windowBits&&v.windowBits<16)||m&&m.windowBits||(v.windowBits+=32),15<v.windowBits&&v.windowBits<48&&!(15&v.windowBits)&&(v.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new g,this.strm.avail_out=0;var y=r.inflateInit2(this.strm,v.windowBits);if(y!==l.Z_OK)throw new Error(u[y]);this.header=new d,r.inflateGetHeader(this.strm,this.header)}function b(m,v){var y=new c(v);if(y.push(m,!0),y.err)throw y.msg||u[y.err];return y.result}c.prototype.push=function(m,v){var y,w,C,D,x,B,S=this.strm,z=this.options.chunkSize,T=this.options.dictionary,Z=!1;if(this.ended)return!1;w=v===~~v?v:v===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof m=="string"?S.input=s.binstring2buf(m):p.call(m)==="[object ArrayBuffer]"?S.input=new Uint8Array(m):S.input=m,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new o.Buf8(z),S.next_out=0,S.avail_out=z),(y=r.inflate(S,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&T&&(B=typeof T=="string"?s.string2buf(T):p.call(T)==="[object ArrayBuffer]"?new Uint8Array(T):T,y=r.inflateSetDictionary(this.strm,B)),y===l.Z_BUF_ERROR&&Z===!0&&(y=l.Z_OK,Z=!1),y!==l.Z_STREAM_END&&y!==l.Z_OK)return this.onEnd(y),!(this.ended=!0);S.next_out&&(S.avail_out!==0&&y!==l.Z_STREAM_END&&(S.avail_in!==0||w!==l.Z_FINISH&&w!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(C=s.utf8border(S.output,S.next_out),D=S.next_out-C,x=s.buf2string(S.output,C),S.next_out=D,S.avail_out=z-D,D&&o.arraySet(S.output,S.output,C,D,0),this.onData(x)):this.onData(o.shrinkBuf(S.output,S.next_out)))),S.avail_in===0&&S.avail_out===0&&(Z=!0)}while((0<S.avail_in||S.avail_out===0)&&y!==l.Z_STREAM_END);return y===l.Z_STREAM_END&&(w=l.Z_FINISH),w===l.Z_FINISH?(y=r.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===l.Z_OK):w!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(S.avail_out=0))},c.prototype.onData=function(m){this.chunks.push(m)},c.prototype.onEnd=function(m){m===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},i.Inflate=c,i.inflate=b,i.inflateRaw=function(m,v){return(v=v||{}).raw=!0,b(m,v)},i.ungzip=b},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,n,i){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(l){for(var u=Array.prototype.slice.call(arguments,1);u.length;){var g=u.shift();if(g){if(typeof g!="object")throw new TypeError(g+"must be non-object");for(var d in g)g.hasOwnProperty(d)&&(l[d]=g[d])}}return l},i.shrinkBuf=function(l,u){return l.length===u?l:l.subarray?l.subarray(0,u):(l.length=u,l)};var o={arraySet:function(l,u,g,d,p){if(u.subarray&&l.subarray)l.set(u.subarray(g,g+d),p);else for(var c=0;c<d;c++)l[p+c]=u[g+c]},flattenChunks:function(l){var u,g,d,p,c,b;for(u=d=0,g=l.length;u<g;u++)d+=l[u].length;for(b=new Uint8Array(d),u=p=0,g=l.length;u<g;u++)c=l[u],b.set(c,p),p+=c.length;return b}},s={arraySet:function(l,u,g,d,p){for(var c=0;c<d;c++)l[p+c]=u[g+c]},flattenChunks:function(l){return[].concat.apply([],l)}};i.setTyped=function(l){l?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,s))},i.setTyped(r)},{}],42:[function(e,n,i){var r=e("./common"),o=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{s=!1}for(var l=new r.Buf8(256),u=0;u<256;u++)l[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;function g(d,p){if(p<65537&&(d.subarray&&s||!d.subarray&&o))return String.fromCharCode.apply(null,r.shrinkBuf(d,p));for(var c="",b=0;b<p;b++)c+=String.fromCharCode(d[b]);return c}l[254]=l[254]=1,i.string2buf=function(d){var p,c,b,m,v,y=d.length,w=0;for(m=0;m<y;m++)(64512&(c=d.charCodeAt(m)))==55296&&m+1<y&&(64512&(b=d.charCodeAt(m+1)))==56320&&(c=65536+(c-55296<<10)+(b-56320),m++),w+=c<128?1:c<2048?2:c<65536?3:4;for(p=new r.Buf8(w),m=v=0;v<w;m++)(64512&(c=d.charCodeAt(m)))==55296&&m+1<y&&(64512&(b=d.charCodeAt(m+1)))==56320&&(c=65536+(c-55296<<10)+(b-56320),m++),c<128?p[v++]=c:(c<2048?p[v++]=192|c>>>6:(c<65536?p[v++]=224|c>>>12:(p[v++]=240|c>>>18,p[v++]=128|c>>>12&63),p[v++]=128|c>>>6&63),p[v++]=128|63&c);return p},i.buf2binstring=function(d){return g(d,d.length)},i.binstring2buf=function(d){for(var p=new r.Buf8(d.length),c=0,b=p.length;c<b;c++)p[c]=d.charCodeAt(c);return p},i.buf2string=function(d,p){var c,b,m,v,y=p||d.length,w=new Array(2*y);for(c=b=0;c<y;)if((m=d[c++])<128)w[b++]=m;else if(4<(v=l[m]))w[b++]=65533,c+=v-1;else{for(m&=v===2?31:v===3?15:7;1<v&&c<y;)m=m<<6|63&d[c++],v--;1<v?w[b++]=65533:m<65536?w[b++]=m:(m-=65536,w[b++]=55296|m>>10&1023,w[b++]=56320|1023&m)}return g(w,b)},i.utf8border=function(d,p){var c;for((p=p||d.length)>d.length&&(p=d.length),c=p-1;0<=c&&(192&d[c])==128;)c--;return c<0||c===0?p:c+l[d[c]]>p?c:p}},{"./common":41}],43:[function(e,n,i){n.exports=function(r,o,s,l){for(var u=65535&r|0,g=r>>>16&65535|0,d=0;s!==0;){for(s-=d=2e3<s?2e3:s;g=g+(u=u+o[l++]|0)|0,--d;);u%=65521,g%=65521}return u|g<<16|0}},{}],44:[function(e,n,i){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,n,i){var r=function(){for(var o,s=[],l=0;l<256;l++){o=l;for(var u=0;u<8;u++)o=1&o?3988292384^o>>>1:o>>>1;s[l]=o}return s}();n.exports=function(o,s,l,u){var g=r,d=u+l;o^=-1;for(var p=u;p<d;p++)o=o>>>8^g[255&(o^s[p])];return-1^o}},{}],46:[function(e,n,i){var r,o=e("../utils/common"),s=e("./trees"),l=e("./adler32"),u=e("./crc32"),g=e("./messages"),d=0,p=4,c=0,b=-2,m=-1,v=4,y=2,w=8,C=9,D=286,x=30,B=19,S=2*D+1,z=15,T=3,Z=258,ne=Z+T+1,F=42,j=113,h=1,L=2,J=3,U=4;function ee(f,V){return f.msg=g[V],V}function W(f){return(f<<1)-(4<f?9:0)}function ie(f){for(var V=f.length;0<=--V;)f[V]=0}function M(f){var V=f.state,N=V.pending;N>f.avail_out&&(N=f.avail_out),N!==0&&(o.arraySet(f.output,V.pending_buf,V.pending_out,N,f.next_out),f.next_out+=N,V.pending_out+=N,f.total_out+=N,f.avail_out-=N,V.pending-=N,V.pending===0&&(V.pending_out=0))}function P(f,V){s._tr_flush_block(f,0<=f.block_start?f.block_start:-1,f.strstart-f.block_start,V),f.block_start=f.strstart,M(f.strm)}function oe(f,V){f.pending_buf[f.pending++]=V}function te(f,V){f.pending_buf[f.pending++]=V>>>8&255,f.pending_buf[f.pending++]=255&V}function Y(f,V){var N,E,k=f.max_chain_length,_=f.strstart,I=f.prev_length,O=f.nice_match,A=f.strstart>f.w_size-ne?f.strstart-(f.w_size-ne):0,$=f.window,G=f.w_mask,H=f.prev,Q=f.strstart+Z,se=$[_+I-1],re=$[_+I];f.prev_length>=f.good_match&&(k>>=2),O>f.lookahead&&(O=f.lookahead);do if($[(N=V)+I]===re&&$[N+I-1]===se&&$[N]===$[_]&&$[++N]===$[_+1]){_+=2,N++;do;while($[++_]===$[++N]&&$[++_]===$[++N]&&$[++_]===$[++N]&&$[++_]===$[++N]&&$[++_]===$[++N]&&$[++_]===$[++N]&&$[++_]===$[++N]&&$[++_]===$[++N]&&_<Q);if(E=Z-(Q-_),_=Q-Z,I<E){if(f.match_start=V,O<=(I=E))break;se=$[_+I-1],re=$[_+I]}}while((V=H[V&G])>A&&--k!=0);return I<=f.lookahead?I:f.lookahead}function ye(f){var V,N,E,k,_,I,O,A,$,G,H=f.w_size;do{if(k=f.window_size-f.lookahead-f.strstart,f.strstart>=H+(H-ne)){for(o.arraySet(f.window,f.window,H,H,0),f.match_start-=H,f.strstart-=H,f.block_start-=H,V=N=f.hash_size;E=f.head[--V],f.head[V]=H<=E?E-H:0,--N;);for(V=N=H;E=f.prev[--V],f.prev[V]=H<=E?E-H:0,--N;);k+=H}if(f.strm.avail_in===0)break;if(I=f.strm,O=f.window,A=f.strstart+f.lookahead,$=k,G=void 0,G=I.avail_in,$<G&&(G=$),N=G===0?0:(I.avail_in-=G,o.arraySet(O,I.input,I.next_in,G,A),I.state.wrap===1?I.adler=l(I.adler,O,G,A):I.state.wrap===2&&(I.adler=u(I.adler,O,G,A)),I.next_in+=G,I.total_in+=G,G),f.lookahead+=N,f.lookahead+f.insert>=T)for(_=f.strstart-f.insert,f.ins_h=f.window[_],f.ins_h=(f.ins_h<<f.hash_shift^f.window[_+1])&f.hash_mask;f.insert&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[_+T-1])&f.hash_mask,f.prev[_&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=_,_++,f.insert--,!(f.lookahead+f.insert<T)););}while(f.lookahead<ne&&f.strm.avail_in!==0)}function ve(f,V){for(var N,E;;){if(f.lookahead<ne){if(ye(f),f.lookahead<ne&&V===d)return h;if(f.lookahead===0)break}if(N=0,f.lookahead>=T&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+T-1])&f.hash_mask,N=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),N!==0&&f.strstart-N<=f.w_size-ne&&(f.match_length=Y(f,N)),f.match_length>=T)if(E=s._tr_tally(f,f.strstart-f.match_start,f.match_length-T),f.lookahead-=f.match_length,f.match_length<=f.max_lazy_match&&f.lookahead>=T){for(f.match_length--;f.strstart++,f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+T-1])&f.hash_mask,N=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart,--f.match_length!=0;);f.strstart++}else f.strstart+=f.match_length,f.match_length=0,f.ins_h=f.window[f.strstart],f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+1])&f.hash_mask;else E=s._tr_tally(f,0,f.window[f.strstart]),f.lookahead--,f.strstart++;if(E&&(P(f,!1),f.strm.avail_out===0))return h}return f.insert=f.strstart<T-1?f.strstart:T-1,V===p?(P(f,!0),f.strm.avail_out===0?J:U):f.last_lit&&(P(f,!1),f.strm.avail_out===0)?h:L}function he(f,V){for(var N,E,k;;){if(f.lookahead<ne){if(ye(f),f.lookahead<ne&&V===d)return h;if(f.lookahead===0)break}if(N=0,f.lookahead>=T&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+T-1])&f.hash_mask,N=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),f.prev_length=f.match_length,f.prev_match=f.match_start,f.match_length=T-1,N!==0&&f.prev_length<f.max_lazy_match&&f.strstart-N<=f.w_size-ne&&(f.match_length=Y(f,N),f.match_length<=5&&(f.strategy===1||f.match_length===T&&4096<f.strstart-f.match_start)&&(f.match_length=T-1)),f.prev_length>=T&&f.match_length<=f.prev_length){for(k=f.strstart+f.lookahead-T,E=s._tr_tally(f,f.strstart-1-f.prev_match,f.prev_length-T),f.lookahead-=f.prev_length-1,f.prev_length-=2;++f.strstart<=k&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+T-1])&f.hash_mask,N=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),--f.prev_length!=0;);if(f.match_available=0,f.match_length=T-1,f.strstart++,E&&(P(f,!1),f.strm.avail_out===0))return h}else if(f.match_available){if((E=s._tr_tally(f,0,f.window[f.strstart-1]))&&P(f,!1),f.strstart++,f.lookahead--,f.strm.avail_out===0)return h}else f.match_available=1,f.strstart++,f.lookahead--}return f.match_available&&(E=s._tr_tally(f,0,f.window[f.strstart-1]),f.match_available=0),f.insert=f.strstart<T-1?f.strstart:T-1,V===p?(P(f,!0),f.strm.avail_out===0?J:U):f.last_lit&&(P(f,!1),f.strm.avail_out===0)?h:L}function ge(f,V,N,E,k){this.good_length=f,this.max_lazy=V,this.nice_length=N,this.max_chain=E,this.func=k}function Fe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=w,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*S),this.dyn_dtree=new o.Buf16(2*(2*x+1)),this.bl_tree=new o.Buf16(2*(2*B+1)),ie(this.dyn_ltree),ie(this.dyn_dtree),ie(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(z+1),this.heap=new o.Buf16(2*D+1),ie(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*D+1),ie(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function xe(f){var V;return f&&f.state?(f.total_in=f.total_out=0,f.data_type=y,(V=f.state).pending=0,V.pending_out=0,V.wrap<0&&(V.wrap=-V.wrap),V.status=V.wrap?F:j,f.adler=V.wrap===2?0:1,V.last_flush=d,s._tr_init(V),c):ee(f,b)}function Oe(f){var V=xe(f);return V===c&&function(N){N.window_size=2*N.w_size,ie(N.head),N.max_lazy_match=r[N.level].max_lazy,N.good_match=r[N.level].good_length,N.nice_match=r[N.level].nice_length,N.max_chain_length=r[N.level].max_chain,N.strstart=0,N.block_start=0,N.lookahead=0,N.insert=0,N.match_length=N.prev_length=T-1,N.match_available=0,N.ins_h=0}(f.state),V}function Ie(f,V,N,E,k,_){if(!f)return b;var I=1;if(V===m&&(V=6),E<0?(I=0,E=-E):15<E&&(I=2,E-=16),k<1||C<k||N!==w||E<8||15<E||V<0||9<V||_<0||v<_)return ee(f,b);E===8&&(E=9);var O=new Fe;return(f.state=O).strm=f,O.wrap=I,O.gzhead=null,O.w_bits=E,O.w_size=1<<O.w_bits,O.w_mask=O.w_size-1,O.hash_bits=k+7,O.hash_size=1<<O.hash_bits,O.hash_mask=O.hash_size-1,O.hash_shift=~~((O.hash_bits+T-1)/T),O.window=new o.Buf8(2*O.w_size),O.head=new o.Buf16(O.hash_size),O.prev=new o.Buf16(O.w_size),O.lit_bufsize=1<<k+6,O.pending_buf_size=4*O.lit_bufsize,O.pending_buf=new o.Buf8(O.pending_buf_size),O.d_buf=1*O.lit_bufsize,O.l_buf=3*O.lit_bufsize,O.level=V,O.strategy=_,O.method=N,Oe(f)}r=[new ge(0,0,0,0,function(f,V){var N=65535;for(N>f.pending_buf_size-5&&(N=f.pending_buf_size-5);;){if(f.lookahead<=1){if(ye(f),f.lookahead===0&&V===d)return h;if(f.lookahead===0)break}f.strstart+=f.lookahead,f.lookahead=0;var E=f.block_start+N;if((f.strstart===0||f.strstart>=E)&&(f.lookahead=f.strstart-E,f.strstart=E,P(f,!1),f.strm.avail_out===0)||f.strstart-f.block_start>=f.w_size-ne&&(P(f,!1),f.strm.avail_out===0))return h}return f.insert=0,V===p?(P(f,!0),f.strm.avail_out===0?J:U):(f.strstart>f.block_start&&(P(f,!1),f.strm.avail_out),h)}),new ge(4,4,8,4,ve),new ge(4,5,16,8,ve),new ge(4,6,32,32,ve),new ge(4,4,16,16,he),new ge(8,16,32,32,he),new ge(8,16,128,128,he),new ge(8,32,128,256,he),new ge(32,128,258,1024,he),new ge(32,258,258,4096,he)],i.deflateInit=function(f,V){return Ie(f,V,w,15,8,0)},i.deflateInit2=Ie,i.deflateReset=Oe,i.deflateResetKeep=xe,i.deflateSetHeader=function(f,V){return f&&f.state?f.state.wrap!==2?b:(f.state.gzhead=V,c):b},i.deflate=function(f,V){var N,E,k,_;if(!f||!f.state||5<V||V<0)return f?ee(f,b):b;if(E=f.state,!f.output||!f.input&&f.avail_in!==0||E.status===666&&V!==p)return ee(f,f.avail_out===0?-5:b);if(E.strm=f,N=E.last_flush,E.last_flush=V,E.status===F)if(E.wrap===2)f.adler=0,oe(E,31),oe(E,139),oe(E,8),E.gzhead?(oe(E,(E.gzhead.text?1:0)+(E.gzhead.hcrc?2:0)+(E.gzhead.extra?4:0)+(E.gzhead.name?8:0)+(E.gzhead.comment?16:0)),oe(E,255&E.gzhead.time),oe(E,E.gzhead.time>>8&255),oe(E,E.gzhead.time>>16&255),oe(E,E.gzhead.time>>24&255),oe(E,E.level===9?2:2<=E.strategy||E.level<2?4:0),oe(E,255&E.gzhead.os),E.gzhead.extra&&E.gzhead.extra.length&&(oe(E,255&E.gzhead.extra.length),oe(E,E.gzhead.extra.length>>8&255)),E.gzhead.hcrc&&(f.adler=u(f.adler,E.pending_buf,E.pending,0)),E.gzindex=0,E.status=69):(oe(E,0),oe(E,0),oe(E,0),oe(E,0),oe(E,0),oe(E,E.level===9?2:2<=E.strategy||E.level<2?4:0),oe(E,3),E.status=j);else{var I=w+(E.w_bits-8<<4)<<8;I|=(2<=E.strategy||E.level<2?0:E.level<6?1:E.level===6?2:3)<<6,E.strstart!==0&&(I|=32),I+=31-I%31,E.status=j,te(E,I),E.strstart!==0&&(te(E,f.adler>>>16),te(E,65535&f.adler)),f.adler=1}if(E.status===69)if(E.gzhead.extra){for(k=E.pending;E.gzindex<(65535&E.gzhead.extra.length)&&(E.pending!==E.pending_buf_size||(E.gzhead.hcrc&&E.pending>k&&(f.adler=u(f.adler,E.pending_buf,E.pending-k,k)),M(f),k=E.pending,E.pending!==E.pending_buf_size));)oe(E,255&E.gzhead.extra[E.gzindex]),E.gzindex++;E.gzhead.hcrc&&E.pending>k&&(f.adler=u(f.adler,E.pending_buf,E.pending-k,k)),E.gzindex===E.gzhead.extra.length&&(E.gzindex=0,E.status=73)}else E.status=73;if(E.status===73)if(E.gzhead.name){k=E.pending;do{if(E.pending===E.pending_buf_size&&(E.gzhead.hcrc&&E.pending>k&&(f.adler=u(f.adler,E.pending_buf,E.pending-k,k)),M(f),k=E.pending,E.pending===E.pending_buf_size)){_=1;break}_=E.gzindex<E.gzhead.name.length?255&E.gzhead.name.charCodeAt(E.gzindex++):0,oe(E,_)}while(_!==0);E.gzhead.hcrc&&E.pending>k&&(f.adler=u(f.adler,E.pending_buf,E.pending-k,k)),_===0&&(E.gzindex=0,E.status=91)}else E.status=91;if(E.status===91)if(E.gzhead.comment){k=E.pending;do{if(E.pending===E.pending_buf_size&&(E.gzhead.hcrc&&E.pending>k&&(f.adler=u(f.adler,E.pending_buf,E.pending-k,k)),M(f),k=E.pending,E.pending===E.pending_buf_size)){_=1;break}_=E.gzindex<E.gzhead.comment.length?255&E.gzhead.comment.charCodeAt(E.gzindex++):0,oe(E,_)}while(_!==0);E.gzhead.hcrc&&E.pending>k&&(f.adler=u(f.adler,E.pending_buf,E.pending-k,k)),_===0&&(E.status=103)}else E.status=103;if(E.status===103&&(E.gzhead.hcrc?(E.pending+2>E.pending_buf_size&&M(f),E.pending+2<=E.pending_buf_size&&(oe(E,255&f.adler),oe(E,f.adler>>8&255),f.adler=0,E.status=j)):E.status=j),E.pending!==0){if(M(f),f.avail_out===0)return E.last_flush=-1,c}else if(f.avail_in===0&&W(V)<=W(N)&&V!==p)return ee(f,-5);if(E.status===666&&f.avail_in!==0)return ee(f,-5);if(f.avail_in!==0||E.lookahead!==0||V!==d&&E.status!==666){var O=E.strategy===2?function(A,$){for(var G;;){if(A.lookahead===0&&(ye(A),A.lookahead===0)){if($===d)return h;break}if(A.match_length=0,G=s._tr_tally(A,0,A.window[A.strstart]),A.lookahead--,A.strstart++,G&&(P(A,!1),A.strm.avail_out===0))return h}return A.insert=0,$===p?(P(A,!0),A.strm.avail_out===0?J:U):A.last_lit&&(P(A,!1),A.strm.avail_out===0)?h:L}(E,V):E.strategy===3?function(A,$){for(var G,H,Q,se,re=A.window;;){if(A.lookahead<=Z){if(ye(A),A.lookahead<=Z&&$===d)return h;if(A.lookahead===0)break}if(A.match_length=0,A.lookahead>=T&&0<A.strstart&&(H=re[Q=A.strstart-1])===re[++Q]&&H===re[++Q]&&H===re[++Q]){se=A.strstart+Z;do;while(H===re[++Q]&&H===re[++Q]&&H===re[++Q]&&H===re[++Q]&&H===re[++Q]&&H===re[++Q]&&H===re[++Q]&&H===re[++Q]&&Q<se);A.match_length=Z-(se-Q),A.match_length>A.lookahead&&(A.match_length=A.lookahead)}if(A.match_length>=T?(G=s._tr_tally(A,1,A.match_length-T),A.lookahead-=A.match_length,A.strstart+=A.match_length,A.match_length=0):(G=s._tr_tally(A,0,A.window[A.strstart]),A.lookahead--,A.strstart++),G&&(P(A,!1),A.strm.avail_out===0))return h}return A.insert=0,$===p?(P(A,!0),A.strm.avail_out===0?J:U):A.last_lit&&(P(A,!1),A.strm.avail_out===0)?h:L}(E,V):r[E.level].func(E,V);if(O!==J&&O!==U||(E.status=666),O===h||O===J)return f.avail_out===0&&(E.last_flush=-1),c;if(O===L&&(V===1?s._tr_align(E):V!==5&&(s._tr_stored_block(E,0,0,!1),V===3&&(ie(E.head),E.lookahead===0&&(E.strstart=0,E.block_start=0,E.insert=0))),M(f),f.avail_out===0))return E.last_flush=-1,c}return V!==p?c:E.wrap<=0?1:(E.wrap===2?(oe(E,255&f.adler),oe(E,f.adler>>8&255),oe(E,f.adler>>16&255),oe(E,f.adler>>24&255),oe(E,255&f.total_in),oe(E,f.total_in>>8&255),oe(E,f.total_in>>16&255),oe(E,f.total_in>>24&255)):(te(E,f.adler>>>16),te(E,65535&f.adler)),M(f),0<E.wrap&&(E.wrap=-E.wrap),E.pending!==0?c:1)},i.deflateEnd=function(f){var V;return f&&f.state?(V=f.state.status)!==F&&V!==69&&V!==73&&V!==91&&V!==103&&V!==j&&V!==666?ee(f,b):(f.state=null,V===j?ee(f,-3):c):b},i.deflateSetDictionary=function(f,V){var N,E,k,_,I,O,A,$,G=V.length;if(!f||!f.state||(_=(N=f.state).wrap)===2||_===1&&N.status!==F||N.lookahead)return b;for(_===1&&(f.adler=l(f.adler,V,G,0)),N.wrap=0,G>=N.w_size&&(_===0&&(ie(N.head),N.strstart=0,N.block_start=0,N.insert=0),$=new o.Buf8(N.w_size),o.arraySet($,V,G-N.w_size,N.w_size,0),V=$,G=N.w_size),I=f.avail_in,O=f.next_in,A=f.input,f.avail_in=G,f.next_in=0,f.input=V,ye(N);N.lookahead>=T;){for(E=N.strstart,k=N.lookahead-(T-1);N.ins_h=(N.ins_h<<N.hash_shift^N.window[E+T-1])&N.hash_mask,N.prev[E&N.w_mask]=N.head[N.ins_h],N.head[N.ins_h]=E,E++,--k;);N.strstart=E,N.lookahead=T-1,ye(N)}return N.strstart+=N.lookahead,N.block_start=N.strstart,N.insert=N.lookahead,N.lookahead=0,N.match_length=N.prev_length=T-1,N.match_available=0,f.next_in=O,f.input=A,f.avail_in=I,N.wrap=_,c},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,n,i){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,n,i){n.exports=function(r,o){var s,l,u,g,d,p,c,b,m,v,y,w,C,D,x,B,S,z,T,Z,ne,F,j,h,L;s=r.state,l=r.next_in,h=r.input,u=l+(r.avail_in-5),g=r.next_out,L=r.output,d=g-(o-r.avail_out),p=g+(r.avail_out-257),c=s.dmax,b=s.wsize,m=s.whave,v=s.wnext,y=s.window,w=s.hold,C=s.bits,D=s.lencode,x=s.distcode,B=(1<<s.lenbits)-1,S=(1<<s.distbits)-1;e:do{C<15&&(w+=h[l++]<<C,C+=8,w+=h[l++]<<C,C+=8),z=D[w&B];t:for(;;){if(w>>>=T=z>>>24,C-=T,(T=z>>>16&255)===0)L[g++]=65535&z;else{if(!(16&T)){if(!(64&T)){z=D[(65535&z)+(w&(1<<T)-1)];continue t}if(32&T){s.mode=12;break e}r.msg="invalid literal/length code",s.mode=30;break e}Z=65535&z,(T&=15)&&(C<T&&(w+=h[l++]<<C,C+=8),Z+=w&(1<<T)-1,w>>>=T,C-=T),C<15&&(w+=h[l++]<<C,C+=8,w+=h[l++]<<C,C+=8),z=x[w&S];n:for(;;){if(w>>>=T=z>>>24,C-=T,!(16&(T=z>>>16&255))){if(!(64&T)){z=x[(65535&z)+(w&(1<<T)-1)];continue n}r.msg="invalid distance code",s.mode=30;break e}if(ne=65535&z,C<(T&=15)&&(w+=h[l++]<<C,(C+=8)<T&&(w+=h[l++]<<C,C+=8)),c<(ne+=w&(1<<T)-1)){r.msg="invalid distance too far back",s.mode=30;break e}if(w>>>=T,C-=T,(T=g-d)<ne){if(m<(T=ne-T)&&s.sane){r.msg="invalid distance too far back",s.mode=30;break e}if(j=y,(F=0)===v){if(F+=b-T,T<Z){for(Z-=T;L[g++]=y[F++],--T;);F=g-ne,j=L}}else if(v<T){if(F+=b+v-T,(T-=v)<Z){for(Z-=T;L[g++]=y[F++],--T;);if(F=0,v<Z){for(Z-=T=v;L[g++]=y[F++],--T;);F=g-ne,j=L}}}else if(F+=v-T,T<Z){for(Z-=T;L[g++]=y[F++],--T;);F=g-ne,j=L}for(;2<Z;)L[g++]=j[F++],L[g++]=j[F++],L[g++]=j[F++],Z-=3;Z&&(L[g++]=j[F++],1<Z&&(L[g++]=j[F++]))}else{for(F=g-ne;L[g++]=L[F++],L[g++]=L[F++],L[g++]=L[F++],2<(Z-=3););Z&&(L[g++]=L[F++],1<Z&&(L[g++]=L[F++]))}break}}break}}while(l<u&&g<p);l-=Z=C>>3,w&=(1<<(C-=Z<<3))-1,r.next_in=l,r.next_out=g,r.avail_in=l<u?u-l+5:5-(l-u),r.avail_out=g<p?p-g+257:257-(g-p),s.hold=w,s.bits=C}},{}],49:[function(e,n,i){var r=e("../utils/common"),o=e("./adler32"),s=e("./crc32"),l=e("./inffast"),u=e("./inftrees"),g=1,d=2,p=0,c=-2,b=1,m=852,v=592;function y(F){return(F>>>24&255)+(F>>>8&65280)+((65280&F)<<8)+((255&F)<<24)}function w(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function C(F){var j;return F&&F.state?(j=F.state,F.total_in=F.total_out=j.total=0,F.msg="",j.wrap&&(F.adler=1&j.wrap),j.mode=b,j.last=0,j.havedict=0,j.dmax=32768,j.head=null,j.hold=0,j.bits=0,j.lencode=j.lendyn=new r.Buf32(m),j.distcode=j.distdyn=new r.Buf32(v),j.sane=1,j.back=-1,p):c}function D(F){var j;return F&&F.state?((j=F.state).wsize=0,j.whave=0,j.wnext=0,C(F)):c}function x(F,j){var h,L;return F&&F.state?(L=F.state,j<0?(h=0,j=-j):(h=1+(j>>4),j<48&&(j&=15)),j&&(j<8||15<j)?c:(L.window!==null&&L.wbits!==j&&(L.window=null),L.wrap=h,L.wbits=j,D(F))):c}function B(F,j){var h,L;return F?(L=new w,(F.state=L).window=null,(h=x(F,j))!==p&&(F.state=null),h):c}var S,z,T=!0;function Z(F){if(T){var j;for(S=new r.Buf32(512),z=new r.Buf32(32),j=0;j<144;)F.lens[j++]=8;for(;j<256;)F.lens[j++]=9;for(;j<280;)F.lens[j++]=7;for(;j<288;)F.lens[j++]=8;for(u(g,F.lens,0,288,S,0,F.work,{bits:9}),j=0;j<32;)F.lens[j++]=5;u(d,F.lens,0,32,z,0,F.work,{bits:5}),T=!1}F.lencode=S,F.lenbits=9,F.distcode=z,F.distbits=5}function ne(F,j,h,L){var J,U=F.state;return U.window===null&&(U.wsize=1<<U.wbits,U.wnext=0,U.whave=0,U.window=new r.Buf8(U.wsize)),L>=U.wsize?(r.arraySet(U.window,j,h-U.wsize,U.wsize,0),U.wnext=0,U.whave=U.wsize):(L<(J=U.wsize-U.wnext)&&(J=L),r.arraySet(U.window,j,h-L,J,U.wnext),(L-=J)?(r.arraySet(U.window,j,h-L,L,0),U.wnext=L,U.whave=U.wsize):(U.wnext+=J,U.wnext===U.wsize&&(U.wnext=0),U.whave<U.wsize&&(U.whave+=J))),0}i.inflateReset=D,i.inflateReset2=x,i.inflateResetKeep=C,i.inflateInit=function(F){return B(F,15)},i.inflateInit2=B,i.inflate=function(F,j){var h,L,J,U,ee,W,ie,M,P,oe,te,Y,ye,ve,he,ge,Fe,xe,Oe,Ie,f,V,N,E,k=0,_=new r.Buf8(4),I=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!F||!F.state||!F.output||!F.input&&F.avail_in!==0)return c;(h=F.state).mode===12&&(h.mode=13),ee=F.next_out,J=F.output,ie=F.avail_out,U=F.next_in,L=F.input,W=F.avail_in,M=h.hold,P=h.bits,oe=W,te=ie,V=p;e:for(;;)switch(h.mode){case b:if(h.wrap===0){h.mode=13;break}for(;P<16;){if(W===0)break e;W--,M+=L[U++]<<P,P+=8}if(2&h.wrap&&M===35615){_[h.check=0]=255&M,_[1]=M>>>8&255,h.check=s(h.check,_,2,0),P=M=0,h.mode=2;break}if(h.flags=0,h.head&&(h.head.done=!1),!(1&h.wrap)||(((255&M)<<8)+(M>>8))%31){F.msg="incorrect header check",h.mode=30;break}if((15&M)!=8){F.msg="unknown compression method",h.mode=30;break}if(P-=4,f=8+(15&(M>>>=4)),h.wbits===0)h.wbits=f;else if(f>h.wbits){F.msg="invalid window size",h.mode=30;break}h.dmax=1<<f,F.adler=h.check=1,h.mode=512&M?10:12,P=M=0;break;case 2:for(;P<16;){if(W===0)break e;W--,M+=L[U++]<<P,P+=8}if(h.flags=M,(255&h.flags)!=8){F.msg="unknown compression method",h.mode=30;break}if(57344&h.flags){F.msg="unknown header flags set",h.mode=30;break}h.head&&(h.head.text=M>>8&1),512&h.flags&&(_[0]=255&M,_[1]=M>>>8&255,h.check=s(h.check,_,2,0)),P=M=0,h.mode=3;case 3:for(;P<32;){if(W===0)break e;W--,M+=L[U++]<<P,P+=8}h.head&&(h.head.time=M),512&h.flags&&(_[0]=255&M,_[1]=M>>>8&255,_[2]=M>>>16&255,_[3]=M>>>24&255,h.check=s(h.check,_,4,0)),P=M=0,h.mode=4;case 4:for(;P<16;){if(W===0)break e;W--,M+=L[U++]<<P,P+=8}h.head&&(h.head.xflags=255&M,h.head.os=M>>8),512&h.flags&&(_[0]=255&M,_[1]=M>>>8&255,h.check=s(h.check,_,2,0)),P=M=0,h.mode=5;case 5:if(1024&h.flags){for(;P<16;){if(W===0)break e;W--,M+=L[U++]<<P,P+=8}h.length=M,h.head&&(h.head.extra_len=M),512&h.flags&&(_[0]=255&M,_[1]=M>>>8&255,h.check=s(h.check,_,2,0)),P=M=0}else h.head&&(h.head.extra=null);h.mode=6;case 6:if(1024&h.flags&&(W<(Y=h.length)&&(Y=W),Y&&(h.head&&(f=h.head.extra_len-h.length,h.head.extra||(h.head.extra=new Array(h.head.extra_len)),r.arraySet(h.head.extra,L,U,Y,f)),512&h.flags&&(h.check=s(h.check,L,Y,U)),W-=Y,U+=Y,h.length-=Y),h.length))break e;h.length=0,h.mode=7;case 7:if(2048&h.flags){if(W===0)break e;for(Y=0;f=L[U+Y++],h.head&&f&&h.length<65536&&(h.head.name+=String.fromCharCode(f)),f&&Y<W;);if(512&h.flags&&(h.check=s(h.check,L,Y,U)),W-=Y,U+=Y,f)break e}else h.head&&(h.head.name=null);h.length=0,h.mode=8;case 8:if(4096&h.flags){if(W===0)break e;for(Y=0;f=L[U+Y++],h.head&&f&&h.length<65536&&(h.head.comment+=String.fromCharCode(f)),f&&Y<W;);if(512&h.flags&&(h.check=s(h.check,L,Y,U)),W-=Y,U+=Y,f)break e}else h.head&&(h.head.comment=null);h.mode=9;case 9:if(512&h.flags){for(;P<16;){if(W===0)break e;W--,M+=L[U++]<<P,P+=8}if(M!==(65535&h.check)){F.msg="header crc mismatch",h.mode=30;break}P=M=0}h.head&&(h.head.hcrc=h.flags>>9&1,h.head.done=!0),F.adler=h.check=0,h.mode=12;break;case 10:for(;P<32;){if(W===0)break e;W--,M+=L[U++]<<P,P+=8}F.adler=h.check=y(M),P=M=0,h.mode=11;case 11:if(h.havedict===0)return F.next_out=ee,F.avail_out=ie,F.next_in=U,F.avail_in=W,h.hold=M,h.bits=P,2;F.adler=h.check=1,h.mode=12;case 12:if(j===5||j===6)break e;case 13:if(h.last){M>>>=7&P,P-=7&P,h.mode=27;break}for(;P<3;){if(W===0)break e;W--,M+=L[U++]<<P,P+=8}switch(h.last=1&M,P-=1,3&(M>>>=1)){case 0:h.mode=14;break;case 1:if(Z(h),h.mode=20,j!==6)break;M>>>=2,P-=2;break e;case 2:h.mode=17;break;case 3:F.msg="invalid block type",h.mode=30}M>>>=2,P-=2;break;case 14:for(M>>>=7&P,P-=7&P;P<32;){if(W===0)break e;W--,M+=L[U++]<<P,P+=8}if((65535&M)!=(M>>>16^65535)){F.msg="invalid stored block lengths",h.mode=30;break}if(h.length=65535&M,P=M=0,h.mode=15,j===6)break e;case 15:h.mode=16;case 16:if(Y=h.length){if(W<Y&&(Y=W),ie<Y&&(Y=ie),Y===0)break e;r.arraySet(J,L,U,Y,ee),W-=Y,U+=Y,ie-=Y,ee+=Y,h.length-=Y;break}h.mode=12;break;case 17:for(;P<14;){if(W===0)break e;W--,M+=L[U++]<<P,P+=8}if(h.nlen=257+(31&M),M>>>=5,P-=5,h.ndist=1+(31&M),M>>>=5,P-=5,h.ncode=4+(15&M),M>>>=4,P-=4,286<h.nlen||30<h.ndist){F.msg="too many length or distance symbols",h.mode=30;break}h.have=0,h.mode=18;case 18:for(;h.have<h.ncode;){for(;P<3;){if(W===0)break e;W--,M+=L[U++]<<P,P+=8}h.lens[I[h.have++]]=7&M,M>>>=3,P-=3}for(;h.have<19;)h.lens[I[h.have++]]=0;if(h.lencode=h.lendyn,h.lenbits=7,N={bits:h.lenbits},V=u(0,h.lens,0,19,h.lencode,0,h.work,N),h.lenbits=N.bits,V){F.msg="invalid code lengths set",h.mode=30;break}h.have=0,h.mode=19;case 19:for(;h.have<h.nlen+h.ndist;){for(;ge=(k=h.lencode[M&(1<<h.lenbits)-1])>>>16&255,Fe=65535&k,!((he=k>>>24)<=P);){if(W===0)break e;W--,M+=L[U++]<<P,P+=8}if(Fe<16)M>>>=he,P-=he,h.lens[h.have++]=Fe;else{if(Fe===16){for(E=he+2;P<E;){if(W===0)break e;W--,M+=L[U++]<<P,P+=8}if(M>>>=he,P-=he,h.have===0){F.msg="invalid bit length repeat",h.mode=30;break}f=h.lens[h.have-1],Y=3+(3&M),M>>>=2,P-=2}else if(Fe===17){for(E=he+3;P<E;){if(W===0)break e;W--,M+=L[U++]<<P,P+=8}P-=he,f=0,Y=3+(7&(M>>>=he)),M>>>=3,P-=3}else{for(E=he+7;P<E;){if(W===0)break e;W--,M+=L[U++]<<P,P+=8}P-=he,f=0,Y=11+(127&(M>>>=he)),M>>>=7,P-=7}if(h.have+Y>h.nlen+h.ndist){F.msg="invalid bit length repeat",h.mode=30;break}for(;Y--;)h.lens[h.have++]=f}}if(h.mode===30)break;if(h.lens[256]===0){F.msg="invalid code -- missing end-of-block",h.mode=30;break}if(h.lenbits=9,N={bits:h.lenbits},V=u(g,h.lens,0,h.nlen,h.lencode,0,h.work,N),h.lenbits=N.bits,V){F.msg="invalid literal/lengths set",h.mode=30;break}if(h.distbits=6,h.distcode=h.distdyn,N={bits:h.distbits},V=u(d,h.lens,h.nlen,h.ndist,h.distcode,0,h.work,N),h.distbits=N.bits,V){F.msg="invalid distances set",h.mode=30;break}if(h.mode=20,j===6)break e;case 20:h.mode=21;case 21:if(6<=W&&258<=ie){F.next_out=ee,F.avail_out=ie,F.next_in=U,F.avail_in=W,h.hold=M,h.bits=P,l(F,te),ee=F.next_out,J=F.output,ie=F.avail_out,U=F.next_in,L=F.input,W=F.avail_in,M=h.hold,P=h.bits,h.mode===12&&(h.back=-1);break}for(h.back=0;ge=(k=h.lencode[M&(1<<h.lenbits)-1])>>>16&255,Fe=65535&k,!((he=k>>>24)<=P);){if(W===0)break e;W--,M+=L[U++]<<P,P+=8}if(ge&&!(240&ge)){for(xe=he,Oe=ge,Ie=Fe;ge=(k=h.lencode[Ie+((M&(1<<xe+Oe)-1)>>xe)])>>>16&255,Fe=65535&k,!(xe+(he=k>>>24)<=P);){if(W===0)break e;W--,M+=L[U++]<<P,P+=8}M>>>=xe,P-=xe,h.back+=xe}if(M>>>=he,P-=he,h.back+=he,h.length=Fe,ge===0){h.mode=26;break}if(32&ge){h.back=-1,h.mode=12;break}if(64&ge){F.msg="invalid literal/length code",h.mode=30;break}h.extra=15&ge,h.mode=22;case 22:if(h.extra){for(E=h.extra;P<E;){if(W===0)break e;W--,M+=L[U++]<<P,P+=8}h.length+=M&(1<<h.extra)-1,M>>>=h.extra,P-=h.extra,h.back+=h.extra}h.was=h.length,h.mode=23;case 23:for(;ge=(k=h.distcode[M&(1<<h.distbits)-1])>>>16&255,Fe=65535&k,!((he=k>>>24)<=P);){if(W===0)break e;W--,M+=L[U++]<<P,P+=8}if(!(240&ge)){for(xe=he,Oe=ge,Ie=Fe;ge=(k=h.distcode[Ie+((M&(1<<xe+Oe)-1)>>xe)])>>>16&255,Fe=65535&k,!(xe+(he=k>>>24)<=P);){if(W===0)break e;W--,M+=L[U++]<<P,P+=8}M>>>=xe,P-=xe,h.back+=xe}if(M>>>=he,P-=he,h.back+=he,64&ge){F.msg="invalid distance code",h.mode=30;break}h.offset=Fe,h.extra=15&ge,h.mode=24;case 24:if(h.extra){for(E=h.extra;P<E;){if(W===0)break e;W--,M+=L[U++]<<P,P+=8}h.offset+=M&(1<<h.extra)-1,M>>>=h.extra,P-=h.extra,h.back+=h.extra}if(h.offset>h.dmax){F.msg="invalid distance too far back",h.mode=30;break}h.mode=25;case 25:if(ie===0)break e;if(Y=te-ie,h.offset>Y){if((Y=h.offset-Y)>h.whave&&h.sane){F.msg="invalid distance too far back",h.mode=30;break}ye=Y>h.wnext?(Y-=h.wnext,h.wsize-Y):h.wnext-Y,Y>h.length&&(Y=h.length),ve=h.window}else ve=J,ye=ee-h.offset,Y=h.length;for(ie<Y&&(Y=ie),ie-=Y,h.length-=Y;J[ee++]=ve[ye++],--Y;);h.length===0&&(h.mode=21);break;case 26:if(ie===0)break e;J[ee++]=h.length,ie--,h.mode=21;break;case 27:if(h.wrap){for(;P<32;){if(W===0)break e;W--,M|=L[U++]<<P,P+=8}if(te-=ie,F.total_out+=te,h.total+=te,te&&(F.adler=h.check=h.flags?s(h.check,J,te,ee-te):o(h.check,J,te,ee-te)),te=ie,(h.flags?M:y(M))!==h.check){F.msg="incorrect data check",h.mode=30;break}P=M=0}h.mode=28;case 28:if(h.wrap&&h.flags){for(;P<32;){if(W===0)break e;W--,M+=L[U++]<<P,P+=8}if(M!==(4294967295&h.total)){F.msg="incorrect length check",h.mode=30;break}P=M=0}h.mode=29;case 29:V=1;break e;case 30:V=-3;break e;case 31:return-4;case 32:default:return c}return F.next_out=ee,F.avail_out=ie,F.next_in=U,F.avail_in=W,h.hold=M,h.bits=P,(h.wsize||te!==F.avail_out&&h.mode<30&&(h.mode<27||j!==4))&&ne(F,F.output,F.next_out,te-F.avail_out)?(h.mode=31,-4):(oe-=F.avail_in,te-=F.avail_out,F.total_in+=oe,F.total_out+=te,h.total+=te,h.wrap&&te&&(F.adler=h.check=h.flags?s(h.check,J,te,F.next_out-te):o(h.check,J,te,F.next_out-te)),F.data_type=h.bits+(h.last?64:0)+(h.mode===12?128:0)+(h.mode===20||h.mode===15?256:0),(oe==0&&te===0||j===4)&&V===p&&(V=-5),V)},i.inflateEnd=function(F){if(!F||!F.state)return c;var j=F.state;return j.window&&(j.window=null),F.state=null,p},i.inflateGetHeader=function(F,j){var h;return F&&F.state&&2&(h=F.state).wrap?((h.head=j).done=!1,p):c},i.inflateSetDictionary=function(F,j){var h,L=j.length;return F&&F.state?(h=F.state).wrap!==0&&h.mode!==11?c:h.mode===11&&o(1,j,L,0)!==h.check?-3:ne(F,j,L,L)?(h.mode=31,-4):(h.havedict=1,p):c},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,n,i){var r=e("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(g,d,p,c,b,m,v,y){var w,C,D,x,B,S,z,T,Z,ne=y.bits,F=0,j=0,h=0,L=0,J=0,U=0,ee=0,W=0,ie=0,M=0,P=null,oe=0,te=new r.Buf16(16),Y=new r.Buf16(16),ye=null,ve=0;for(F=0;F<=15;F++)te[F]=0;for(j=0;j<c;j++)te[d[p+j]]++;for(J=ne,L=15;1<=L&&te[L]===0;L--);if(L<J&&(J=L),L===0)return b[m++]=20971520,b[m++]=20971520,y.bits=1,0;for(h=1;h<L&&te[h]===0;h++);for(J<h&&(J=h),F=W=1;F<=15;F++)if(W<<=1,(W-=te[F])<0)return-1;if(0<W&&(g===0||L!==1))return-1;for(Y[1]=0,F=1;F<15;F++)Y[F+1]=Y[F]+te[F];for(j=0;j<c;j++)d[p+j]!==0&&(v[Y[d[p+j]]++]=j);if(S=g===0?(P=ye=v,19):g===1?(P=o,oe-=257,ye=s,ve-=257,256):(P=l,ye=u,-1),F=h,B=m,ee=j=M=0,D=-1,x=(ie=1<<(U=J))-1,g===1&&852<ie||g===2&&592<ie)return 1;for(;;){for(z=F-ee,Z=v[j]<S?(T=0,v[j]):v[j]>S?(T=ye[ve+v[j]],P[oe+v[j]]):(T=96,0),w=1<<F-ee,h=C=1<<U;b[B+(M>>ee)+(C-=w)]=z<<24|T<<16|Z|0,C!==0;);for(w=1<<F-1;M&w;)w>>=1;if(w!==0?(M&=w-1,M+=w):M=0,j++,--te[F]==0){if(F===L)break;F=d[p+v[j]]}if(J<F&&(M&x)!==D){for(ee===0&&(ee=J),B+=h,W=1<<(U=F-ee);U+ee<L&&!((W-=te[U+ee])<=0);)U++,W<<=1;if(ie+=1<<U,g===1&&852<ie||g===2&&592<ie)return 1;b[D=M&x]=J<<24|U<<16|B-m|0}}return M!==0&&(b[B+M]=F-ee<<24|64<<16|0),y.bits=J,0}},{"../utils/common":41}],51:[function(e,n,i){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,n,i){var r=e("../utils/common"),o=0,s=1;function l(k){for(var _=k.length;0<=--_;)k[_]=0}var u=0,g=29,d=256,p=d+1+g,c=30,b=19,m=2*p+1,v=15,y=16,w=7,C=256,D=16,x=17,B=18,S=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],z=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ne=new Array(2*(p+2));l(ne);var F=new Array(2*c);l(F);var j=new Array(512);l(j);var h=new Array(256);l(h);var L=new Array(g);l(L);var J,U,ee,W=new Array(c);function ie(k,_,I,O,A){this.static_tree=k,this.extra_bits=_,this.extra_base=I,this.elems=O,this.max_length=A,this.has_stree=k&&k.length}function M(k,_){this.dyn_tree=k,this.max_code=0,this.stat_desc=_}function P(k){return k<256?j[k]:j[256+(k>>>7)]}function oe(k,_){k.pending_buf[k.pending++]=255&_,k.pending_buf[k.pending++]=_>>>8&255}function te(k,_,I){k.bi_valid>y-I?(k.bi_buf|=_<<k.bi_valid&65535,oe(k,k.bi_buf),k.bi_buf=_>>y-k.bi_valid,k.bi_valid+=I-y):(k.bi_buf|=_<<k.bi_valid&65535,k.bi_valid+=I)}function Y(k,_,I){te(k,I[2*_],I[2*_+1])}function ye(k,_){for(var I=0;I|=1&k,k>>>=1,I<<=1,0<--_;);return I>>>1}function ve(k,_,I){var O,A,$=new Array(v+1),G=0;for(O=1;O<=v;O++)$[O]=G=G+I[O-1]<<1;for(A=0;A<=_;A++){var H=k[2*A+1];H!==0&&(k[2*A]=ye($[H]++,H))}}function he(k){var _;for(_=0;_<p;_++)k.dyn_ltree[2*_]=0;for(_=0;_<c;_++)k.dyn_dtree[2*_]=0;for(_=0;_<b;_++)k.bl_tree[2*_]=0;k.dyn_ltree[2*C]=1,k.opt_len=k.static_len=0,k.last_lit=k.matches=0}function ge(k){8<k.bi_valid?oe(k,k.bi_buf):0<k.bi_valid&&(k.pending_buf[k.pending++]=k.bi_buf),k.bi_buf=0,k.bi_valid=0}function Fe(k,_,I,O){var A=2*_,$=2*I;return k[A]<k[$]||k[A]===k[$]&&O[_]<=O[I]}function xe(k,_,I){for(var O=k.heap[I],A=I<<1;A<=k.heap_len&&(A<k.heap_len&&Fe(_,k.heap[A+1],k.heap[A],k.depth)&&A++,!Fe(_,O,k.heap[A],k.depth));)k.heap[I]=k.heap[A],I=A,A<<=1;k.heap[I]=O}function Oe(k,_,I){var O,A,$,G,H=0;if(k.last_lit!==0)for(;O=k.pending_buf[k.d_buf+2*H]<<8|k.pending_buf[k.d_buf+2*H+1],A=k.pending_buf[k.l_buf+H],H++,O===0?Y(k,A,_):(Y(k,($=h[A])+d+1,_),(G=S[$])!==0&&te(k,A-=L[$],G),Y(k,$=P(--O),I),(G=z[$])!==0&&te(k,O-=W[$],G)),H<k.last_lit;);Y(k,C,_)}function Ie(k,_){var I,O,A,$=_.dyn_tree,G=_.stat_desc.static_tree,H=_.stat_desc.has_stree,Q=_.stat_desc.elems,se=-1;for(k.heap_len=0,k.heap_max=m,I=0;I<Q;I++)$[2*I]!==0?(k.heap[++k.heap_len]=se=I,k.depth[I]=0):$[2*I+1]=0;for(;k.heap_len<2;)$[2*(A=k.heap[++k.heap_len]=se<2?++se:0)]=1,k.depth[A]=0,k.opt_len--,H&&(k.static_len-=G[2*A+1]);for(_.max_code=se,I=k.heap_len>>1;1<=I;I--)xe(k,$,I);for(A=Q;I=k.heap[1],k.heap[1]=k.heap[k.heap_len--],xe(k,$,1),O=k.heap[1],k.heap[--k.heap_max]=I,k.heap[--k.heap_max]=O,$[2*A]=$[2*I]+$[2*O],k.depth[A]=(k.depth[I]>=k.depth[O]?k.depth[I]:k.depth[O])+1,$[2*I+1]=$[2*O+1]=A,k.heap[1]=A++,xe(k,$,1),2<=k.heap_len;);k.heap[--k.heap_max]=k.heap[1],function(re,ae){var Ee,pe,fe,de,we,$e,Le=ae.dyn_tree,Ne=ae.max_code,_e=ae.stat_desc.static_tree,Ke=ae.stat_desc.has_stree,He=ae.stat_desc.extra_bits,Se=ae.stat_desc.extra_base,Me=ae.stat_desc.max_length,Ze=0;for(de=0;de<=v;de++)re.bl_count[de]=0;for(Le[2*re.heap[re.heap_max]+1]=0,Ee=re.heap_max+1;Ee<m;Ee++)Me<(de=Le[2*Le[2*(pe=re.heap[Ee])+1]+1]+1)&&(de=Me,Ze++),Le[2*pe+1]=de,Ne<pe||(re.bl_count[de]++,we=0,Se<=pe&&(we=He[pe-Se]),$e=Le[2*pe],re.opt_len+=$e*(de+we),Ke&&(re.static_len+=$e*(_e[2*pe+1]+we)));if(Ze!==0){do{for(de=Me-1;re.bl_count[de]===0;)de--;re.bl_count[de]--,re.bl_count[de+1]+=2,re.bl_count[Me]--,Ze-=2}while(0<Ze);for(de=Me;de!==0;de--)for(pe=re.bl_count[de];pe!==0;)Ne<(fe=re.heap[--Ee])||(Le[2*fe+1]!==de&&(re.opt_len+=(de-Le[2*fe+1])*Le[2*fe],Le[2*fe+1]=de),pe--)}}(k,_),ve($,se,k.bl_count)}function f(k,_,I){var O,A,$=-1,G=_[1],H=0,Q=7,se=4;for(G===0&&(Q=138,se=3),_[2*(I+1)+1]=65535,O=0;O<=I;O++)A=G,G=_[2*(O+1)+1],++H<Q&&A===G||(H<se?k.bl_tree[2*A]+=H:A!==0?(A!==$&&k.bl_tree[2*A]++,k.bl_tree[2*D]++):H<=10?k.bl_tree[2*x]++:k.bl_tree[2*B]++,$=A,se=(H=0)===G?(Q=138,3):A===G?(Q=6,3):(Q=7,4))}function V(k,_,I){var O,A,$=-1,G=_[1],H=0,Q=7,se=4;for(G===0&&(Q=138,se=3),O=0;O<=I;O++)if(A=G,G=_[2*(O+1)+1],!(++H<Q&&A===G)){if(H<se)for(;Y(k,A,k.bl_tree),--H!=0;);else A!==0?(A!==$&&(Y(k,A,k.bl_tree),H--),Y(k,D,k.bl_tree),te(k,H-3,2)):H<=10?(Y(k,x,k.bl_tree),te(k,H-3,3)):(Y(k,B,k.bl_tree),te(k,H-11,7));$=A,se=(H=0)===G?(Q=138,3):A===G?(Q=6,3):(Q=7,4)}}l(W);var N=!1;function E(k,_,I,O){te(k,(u<<1)+(O?1:0),3),function(A,$,G,H){ge(A),oe(A,G),oe(A,~G),r.arraySet(A.pending_buf,A.window,$,G,A.pending),A.pending+=G}(k,_,I)}i._tr_init=function(k){N||(function(){var _,I,O,A,$,G=new Array(v+1);for(A=O=0;A<g-1;A++)for(L[A]=O,_=0;_<1<<S[A];_++)h[O++]=A;for(h[O-1]=A,A=$=0;A<16;A++)for(W[A]=$,_=0;_<1<<z[A];_++)j[$++]=A;for($>>=7;A<c;A++)for(W[A]=$<<7,_=0;_<1<<z[A]-7;_++)j[256+$++]=A;for(I=0;I<=v;I++)G[I]=0;for(_=0;_<=143;)ne[2*_+1]=8,_++,G[8]++;for(;_<=255;)ne[2*_+1]=9,_++,G[9]++;for(;_<=279;)ne[2*_+1]=7,_++,G[7]++;for(;_<=287;)ne[2*_+1]=8,_++,G[8]++;for(ve(ne,p+1,G),_=0;_<c;_++)F[2*_+1]=5,F[2*_]=ye(_,5);J=new ie(ne,S,d+1,p,v),U=new ie(F,z,0,c,v),ee=new ie(new Array(0),T,0,b,w)}(),N=!0),k.l_desc=new M(k.dyn_ltree,J),k.d_desc=new M(k.dyn_dtree,U),k.bl_desc=new M(k.bl_tree,ee),k.bi_buf=0,k.bi_valid=0,he(k)},i._tr_stored_block=E,i._tr_flush_block=function(k,_,I,O){var A,$,G=0;0<k.level?(k.strm.data_type===2&&(k.strm.data_type=function(H){var Q,se=4093624447;for(Q=0;Q<=31;Q++,se>>>=1)if(1&se&&H.dyn_ltree[2*Q]!==0)return o;if(H.dyn_ltree[18]!==0||H.dyn_ltree[20]!==0||H.dyn_ltree[26]!==0)return s;for(Q=32;Q<d;Q++)if(H.dyn_ltree[2*Q]!==0)return s;return o}(k)),Ie(k,k.l_desc),Ie(k,k.d_desc),G=function(H){var Q;for(f(H,H.dyn_ltree,H.l_desc.max_code),f(H,H.dyn_dtree,H.d_desc.max_code),Ie(H,H.bl_desc),Q=b-1;3<=Q&&H.bl_tree[2*Z[Q]+1]===0;Q--);return H.opt_len+=3*(Q+1)+5+5+4,Q}(k),A=k.opt_len+3+7>>>3,($=k.static_len+3+7>>>3)<=A&&(A=$)):A=$=I+5,I+4<=A&&_!==-1?E(k,_,I,O):k.strategy===4||$===A?(te(k,2+(O?1:0),3),Oe(k,ne,F)):(te(k,4+(O?1:0),3),function(H,Q,se,re){var ae;for(te(H,Q-257,5),te(H,se-1,5),te(H,re-4,4),ae=0;ae<re;ae++)te(H,H.bl_tree[2*Z[ae]+1],3);V(H,H.dyn_ltree,Q-1),V(H,H.dyn_dtree,se-1)}(k,k.l_desc.max_code+1,k.d_desc.max_code+1,G+1),Oe(k,k.dyn_ltree,k.dyn_dtree)),he(k),O&&ge(k)},i._tr_tally=function(k,_,I){return k.pending_buf[k.d_buf+2*k.last_lit]=_>>>8&255,k.pending_buf[k.d_buf+2*k.last_lit+1]=255&_,k.pending_buf[k.l_buf+k.last_lit]=255&I,k.last_lit++,_===0?k.dyn_ltree[2*I]++:(k.matches++,_--,k.dyn_ltree[2*(h[I]+d+1)]++,k.dyn_dtree[2*P(_)]++),k.last_lit===k.lit_bufsize-1},i._tr_align=function(k){te(k,2,3),Y(k,C,ne),function(_){_.bi_valid===16?(oe(_,_.bi_buf),_.bi_buf=0,_.bi_valid=0):8<=_.bi_valid&&(_.pending_buf[_.pending++]=255&_.bi_buf,_.bi_buf>>=8,_.bi_valid-=8)}(k)}},{"../utils/common":41}],53:[function(e,n,i){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,n,i){(function(r){(function(o,s){if(!o.setImmediate){var l,u,g,d,p=1,c={},b=!1,m=o.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(o);v=v&&v.setTimeout?v:o,l={}.toString.call(o.process)==="[object process]"?function(D){process.nextTick(function(){w(D)})}:function(){if(o.postMessage&&!o.importScripts){var D=!0,x=o.onmessage;return o.onmessage=function(){D=!1},o.postMessage("","*"),o.onmessage=x,D}}()?(d="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",C,!1):o.attachEvent("onmessage",C),function(D){o.postMessage(d+D,"*")}):o.MessageChannel?((g=new MessageChannel).port1.onmessage=function(D){w(D.data)},function(D){g.port2.postMessage(D)}):m&&"onreadystatechange"in m.createElement("script")?(u=m.documentElement,function(D){var x=m.createElement("script");x.onreadystatechange=function(){w(D),x.onreadystatechange=null,u.removeChild(x),x=null},u.appendChild(x)}):function(D){setTimeout(w,0,D)},v.setImmediate=function(D){typeof D!="function"&&(D=new Function(""+D));for(var x=new Array(arguments.length-1),B=0;B<x.length;B++)x[B]=arguments[B+1];var S={callback:D,args:x};return c[p]=S,l(p),p++},v.clearImmediate=y}function y(D){delete c[D]}function w(D){if(b)setTimeout(w,0,D);else{var x=c[D];if(x){b=!0;try{(function(B){var S=B.callback,z=B.args;switch(z.length){case 0:S();break;case 1:S(z[0]);break;case 2:S(z[0],z[1]);break;case 3:S(z[0],z[1],z[2]);break;default:S.apply(s,z)}})(x)}finally{y(D),b=!1}}}}function C(D){D.source===o&&typeof D.data=="string"&&D.data.indexOf(d)===0&&w(+D.data.slice(d.length))}})(typeof self>"u"?r===void 0?this:r:self)}).call(this,typeof mt<"u"?mt:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(pn);var An=pn.exports;const mn=Sn(An),Bn=Object.freeze(Object.defineProperty({__proto__:null,default:mn},Symbol.toStringTag,{value:"Module"}));function Te(){}function Tn(a,t){for(const e in t)a[e]=t[e];return a}function zn(a){return!!a&&(typeof a=="object"||typeof a=="function")&&typeof a.then=="function"}function gn(a){return a()}function Wt(){return Object.create(null)}function Be(a){a.forEach(gn)}function bn(a){return typeof a=="function"}function rt(a,t){return a!=a?t==t:a!==t||a&&typeof a=="object"||typeof a=="function"}function In(a){return Object.keys(a).length===0}function Lt(a,t,e,n){if(a){const i=yn(a,t,e,n);return a[0](i)}}function yn(a,t,e,n){return a[1]&&n?Tn(e.ctx.slice(),a[1](n(t))):e.ctx}function Pt(a,t,e,n){if(a[2]&&n){const i=a[2](n(e));if(t.dirty===void 0)return i;if(typeof i=="object"){const r=[],o=Math.max(t.dirty.length,i.length);for(let s=0;s<o;s+=1)r[s]=t.dirty[s]|i[s];return r}return t.dirty|i}return t.dirty}function Ot(a,t,e,n,i,r){if(i){const o=yn(t,e,n,r);a.p(o,i)}}function Mt(a){if(a.ctx.length>32){const t=[],e=a.ctx.length/32;for(let n=0;n<e;n++)t[n]=-1;return t}return-1}function q(a,t){a.appendChild(t)}function ce(a,t,e){a.insertBefore(t,e||null)}function le(a){a.parentNode&&a.parentNode.removeChild(a)}function Ct(a,t){for(let e=0;e<a.length;e+=1)a[e]&&a[e].d(t)}function X(a){return document.createElement(a)}function nt(a){return document.createElementNS("http://www.w3.org/2000/svg",a)}function be(a){return document.createTextNode(a)}function ue(){return be(" ")}function it(){return be("")}function me(a,t,e,n){return a.addEventListener(t,e,n),()=>a.removeEventListener(t,e,n)}function R(a,t,e){e==null?a.removeAttribute(t):a.getAttribute(t)!==e&&a.setAttribute(t,e)}function Bt(a){return a===""?null:+a}function Ln(a){return Array.from(a.childNodes)}function Ae(a,t){t=""+t,a.data!==t&&(a.data=t)}function Ue(a,t){a.value=t??""}function Qe(a,t,e,n){e==null?a.style.removeProperty(t):a.style.setProperty(t,e,"")}function $t(a,t,e){for(let n=0;n<a.options.length;n+=1){const i=a.options[n];if(i.__value===t){i.selected=!0;return}}(!e||t!==void 0)&&(a.selectedIndex=-1)}function Pn(a){const t=a.querySelector(":checked");return t&&t.__value}function ke(a,t,e){a.classList.toggle(t,!!e)}function On(a,t,{bubbles:e=!1,cancelable:n=!1}={}){return new CustomEvent(a,{detail:t,bubbles:e,cancelable:n})}let dt;function qe(a){dt=a}function Ft(){if(!dt)throw new Error("Function called outside component initialization");return dt}function vn(a){Ft().$$.on_mount.push(a)}function Mn(a){Ft().$$.on_destroy.push(a)}function _n(){const a=Ft();return(t,e,{cancelable:n=!1}={})=>{const i=a.$$.callbacks[t];if(i){const r=On(t,e,{cancelable:n});return i.slice().forEach(o=>{o.call(a,r)}),!r.defaultPrevented}return!0}}const Je=[],ft=[];let tt=[];const Tt=[],Rn=Promise.resolve();let zt=!1;function Un(){zt||(zt=!0,Rn.then(Rt))}function wt(a){tt.push(a)}function jn(a){Tt.push(a)}const St=new Set;let Ye=0;function Rt(){if(Ye!==0)return;const a=dt;do{try{for(;Ye<Je.length;){const t=Je[Ye];Ye++,qe(t),Nn(t.$$)}}catch(t){throw Je.length=0,Ye=0,t}for(qe(null),Je.length=0,Ye=0;ft.length;)ft.pop()();for(let t=0;t<tt.length;t+=1){const e=tt[t];St.has(e)||(St.add(e),e())}tt.length=0}while(Je.length);for(;Tt.length;)Tt.pop()();zt=!1,St.clear(),qe(a)}function Nn(a){if(a.fragment!==null){a.update(),Be(a.before_update);const t=a.dirty;a.dirty=[-1],a.fragment&&a.fragment.p(a.ctx,t),a.after_update.forEach(wt)}}function qn(a){const t=[],e=[];tt.forEach(n=>a.indexOf(n)===-1?t.push(n):e.push(n)),e.forEach(n=>n()),tt=t}const yt=new Set;let Ge;function Ut(){Ge={r:0,c:[],p:Ge}}function jt(){Ge.r||Be(Ge.c),Ge=Ge.p}function Pe(a,t){a&&a.i&&(yt.delete(a),a.i(t))}function Re(a,t,e,n){if(a&&a.o){if(yt.has(a))return;yt.add(a),Ge.c.push(()=>{yt.delete(a),n&&(e&&a.d(1),n())}),a.o(t)}else n&&n()}function bt(a,t){const e=t.token={};function n(i,r,o,s){if(t.token!==e)return;t.resolved=s;let l=t.ctx;o!==void 0&&(l=l.slice(),l[o]=s);const u=i&&(t.current=i)(l);let g=!1;t.block&&(t.blocks?t.blocks.forEach((d,p)=>{p!==r&&d&&(Ut(),Re(d,1,1,()=>{t.blocks[p]===d&&(t.blocks[p]=null)}),jt())}):t.block.d(1),u.c(),Pe(u,1),u.m(t.mount(),t.anchor),g=!0),t.block=u,t.blocks&&(t.blocks[r]=u),g&&Rt()}if(zn(a)){const i=Ft();if(a.then(r=>{qe(i),n(t.then,1,t.value,r),qe(null)},r=>{if(qe(i),n(t.catch,2,t.error,r),qe(null),!t.hasCatch)throw r}),t.current!==t.pending)return n(t.pending,0),!0}else{if(t.current!==t.then)return n(t.then,1,t.value,a),!0;t.resolved=a}}function Ht(a,t,e){const n=t.slice(),{resolved:i}=a;a.current===a.then&&(n[a.value]=i),a.current===a.catch&&(n[a.error]=i),a.block.p(n,e)}function je(a){return(a==null?void 0:a.length)!==void 0?a:Array.from(a)}function Wn(a,t){Re(a,1,1,()=>{t.delete(a.key)})}function $n(a,t,e,n,i,r,o,s,l,u,g,d){let p=a.length,c=r.length,b=p;const m={};for(;b--;)m[a[b].key]=b;const v=[],y=new Map,w=new Map,C=[];for(b=c;b--;){const S=d(i,r,b),z=e(S);let T=o.get(z);T?C.push(()=>T.p(S,t)):(T=u(z,S),T.c()),y.set(z,v[b]=T),z in m&&w.set(z,Math.abs(b-m[z]))}const D=new Set,x=new Set;function B(S){Pe(S,1),S.m(s,g),o.set(S.key,S),g=S.first,c--}for(;p&&c;){const S=v[c-1],z=a[p-1],T=S.key,Z=z.key;S===z?(g=S.first,p--,c--):y.has(Z)?!o.has(T)||D.has(T)?B(S):x.has(Z)?p--:w.get(T)>w.get(Z)?(x.add(T),B(S)):(D.add(Z),p--):(l(z,o),p--)}for(;p--;){const S=a[p];y.has(S.key)||l(S,o)}for(;c;)B(v[c-1]);return Be(C),v}function Hn(a,t,e){const n=a.$$.props[t];n!==void 0&&(a.$$.bound[n]=e,e(a.$$.ctx[n]))}function kt(a){a&&a.c()}function ht(a,t,e){const{fragment:n,after_update:i}=a.$$;n&&n.m(t,e),wt(()=>{const r=a.$$.on_mount.map(gn).filter(bn);a.$$.on_destroy?a.$$.on_destroy.push(...r):Be(r),a.$$.on_mount=[]}),i.forEach(wt)}function pt(a,t){const e=a.$$;e.fragment!==null&&(qn(e.after_update),Be(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[])}function Zn(a,t){a.$$.dirty[0]===-1&&(Je.push(a),Un(),a.$$.dirty.fill(0)),a.$$.dirty[t/31|0]|=1<<t%31}function ot(a,t,e,n,i,r,o=null,s=[-1]){const l=dt;qe(a);const u=a.$$={fragment:null,ctx:[],props:r,update:Te,not_equal:i,bound:Wt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:Wt(),dirty:s,skip_bound:!1,root:t.target||l.$$.root};o&&o(u.root);let g=!1;if(u.ctx=e?e(a,t.props||{},(d,p,...c)=>{const b=c.length?c[0]:p;return u.ctx&&i(u.ctx[d],u.ctx[d]=b)&&(!u.skip_bound&&u.bound[d]&&u.bound[d](b),g&&Zn(a,d)),p}):[],u.update(),g=!0,Be(u.before_update),u.fragment=n?n(u.ctx):!1,t.target){if(t.hydrate){const d=Ln(t.target);u.fragment&&u.fragment.l(d),d.forEach(le)}else u.fragment&&u.fragment.c();t.intro&&Pe(a.$$.fragment),ht(a,t.target,t.anchor),Rt()}qe(l)}class st{constructor(){Ce(this,"$$");Ce(this,"$$set")}$destroy(){pt(this,1),this.$destroy=Te}$on(t,e){if(!bn(e))return Te;const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const i=n.indexOf(e);i!==-1&&n.splice(i,1)}}$set(t){this.$$set&&!In(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const Vn="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Vn);async function We(a,t){let e=await K.fetchSyncPost(a,t);return e.code===0?e.data:null}async function wn(a){return We("/api/filetree/getHPathByID",{id:a})}async function Gn(a,t,e,n,i){return We("/api/block/insertBlock",{dataType:a,data:t,nextID:e,previousID:n,parentID:i})}async function kn(a){return We("/api/query/sql",{stmt:a})}async function It(a){let t={path:a},e="/api/file/getFile";return new Promise((n,i)=>{K.fetchPost(e,t,r=>{n(r)})})}const ut=async a=>{let e=await fetch("/api/file/getFile",{method:"POST",body:JSON.stringify({path:a})});return e.ok?await e.blob():null};async function Ve(a,t,e){let n=new FormData;return n.append("path",a),n.append("isDir",t.toString()),n.append("modTime",Math.floor(Date.now()/1e3).toString()),n.append("file",e),We("/api/file/putFile",n)}async function vt(a){return We("/api/file/removeFile",{path:a})}async function _t(a){return We("/api/file/readDir",{path:a})}async function xn(){return We("/api/system/version",{})}async function Kn(){return We("/api/system/getConf",{})}const et=Object.freeze(Object.defineProperty({__proto__:null,getConf:Kn,getFile:It,getFileBlob:ut,getHPathByID:wn,insertBlock:Gn,putFile:Ve,readDir:_t,removeFile:vt,request:We,sql:kn,version:xn},Symbol.toStringTag,{value:"Module"}));function Yn(a){var W;let t,e,n,i,r,o,s,l=((W=a[0])==null?void 0:W.appId)+"",u,g,d,p,c,b,m,v,y,w,C,D,x,B,S,z,T,Z,ne,F,j,h,L,J,U,ee;return{c(){t=X("div"),e=X("div"),e.textContent="appId:",n=ue(),i=X("div"),r=ue(),o=X("div"),s=be("$"),u=be(l),g=ue(),d=X("div"),p=ue(),c=X("div"),b=ue(),m=X("div"),m.textContent="API demo:",v=ue(),y=X("div"),w=ue(),C=X("div"),D=be("System current time: "),x=X("span"),B=be(a[1]),S=ue(),z=X("div"),T=ue(),Z=X("div"),ne=ue(),F=X("div"),j=be("Protyle demo: id = "),h=be(a[3]),L=ue(),J=X("div"),U=ue(),ee=X("div"),R(i,"class","fn__hr"),R(o,"class","plugin-sample__time"),R(d,"class","fn__hr"),R(c,"class","fn__hr"),R(y,"class","fn__hr"),R(x,"id","time"),R(C,"class","plugin-sample__time"),R(z,"class","fn__hr"),R(Z,"class","fn__hr"),R(J,"class","fn__hr"),R(ee,"id","protyle"),Qe(ee,"height","360px"),R(t,"class","b3-dialog__content")},m(ie,M){ce(ie,t,M),q(t,e),q(t,n),q(t,i),q(t,r),q(t,o),q(o,s),q(o,u),q(t,g),q(t,d),q(t,p),q(t,c),q(t,b),q(t,m),q(t,v),q(t,y),q(t,w),q(t,C),q(C,D),q(C,x),q(x,B),q(t,S),q(t,z),q(t,T),q(t,Z),q(t,ne),q(t,F),q(F,j),q(F,h),q(t,L),q(t,J),q(t,U),q(t,ee),a[4](ee)},p(ie,[M]){var P;M&1&&l!==(l=((P=ie[0])==null?void 0:P.appId)+"")&&Ae(u,l),M&2&&Ae(B,ie[1]),M&8&&Ae(h,ie[3])},i:Te,o:Te,d(ie){ie&&le(t),a[4](null)}}}function Xn(a,t,e){let{app:n}=t,i="",r,o,s="";vn(async()=>{await xn(),K.fetchPost("/api/system/currentTime",{},g=>{e(1,i=new Date(g.data).toString())}),o=await l()}),Mn(()=>{o.destroy()});async function l(){let d=await kn("SELECT * FROM blocks ORDER BY RANDOM () LIMIT 1;");return e(3,s=d[0].id),new K.Protyle(n,r,{blockId:s})}function u(g){ft[g?"unshift":"push"](()=>{r=g,e(2,r)})}return a.$$set=g=>{"app"in g&&e(0,n=g.app)},[n,i,r,s,u]}class Zt extends st{constructor(t){super(),ot(this,t,Xn,Yn,rt,{app:0})}}function Vt(a,t,e){const n=a.slice();return n[0]=t[e][0],n[18]=t[e][1],n}function Jn(a){let t,e,n,i,r,o,s;return{c(){t=X("div"),e=X("input"),R(e,"id","fontSize"),R(e,"min",n=a[5].min),R(e,"max",i=a[5].max),R(e,"step",r=a[5].step),R(e,"type","range"),R(e,"style",a[8]),ke(e,"b3-slider",!0),ke(e,"fn__size200",a[7]),R(t,"class","b3-tooltips b3-tooltips__n"),R(t,"aria-label",a[0])},m(l,u){ce(l,t,u),q(t,e),Ue(e,a[0]),o||(s=[me(e,"change",a[16]),me(e,"input",a[16]),me(e,"change",a[10])],o=!0)},p(l,u){u&32&&n!==(n=l[5].min)&&R(e,"min",n),u&32&&i!==(i=l[5].max)&&R(e,"max",i),u&32&&r!==(r=l[5].step)&&R(e,"step",r),u&256&&R(e,"style",l[8]),u&17&&Ue(e,l[0]),u&128&&ke(e,"fn__size200",l[7]),u&17&&R(t,"aria-label",l[0])},d(l){l&&le(t),o=!1,Be(s)}}}function Qn(a){let t,e,n,i=je(Object.entries(a[4])),r=[];for(let o=0;o<i.length;o+=1)r[o]=Gt(Vt(a,i,o));return{c(){t=X("select");for(let o=0;o<r.length;o+=1)r[o].c();R(t,"id","iconPosition"),R(t,"style",a[8]),a[0]===void 0&&wt(()=>a[15].call(t)),ke(t,"b3-select",!0),ke(t,"fn__flex-center",!0),ke(t,"fn__size200",a[7])},m(o,s){ce(o,t,s);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(t,null);$t(t,a[0],!0),e||(n=[me(t,"change",a[15]),me(t,"change",a[10])],e=!0)},p(o,s){if(s&16){i=je(Object.entries(o[4]));let l;for(l=0;l<i.length;l+=1){const u=Vt(o,i,l);r[l]?r[l].p(u,s):(r[l]=Gt(u),r[l].c(),r[l].m(t,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=i.length}s&256&&R(t,"style",o[8]),s&17&&$t(t,o[0]),s&128&&ke(t,"fn__size200",o[7])},d(o){o&&le(t),Ct(r,o),e=!1,Be(n)}}}function er(a){let t,e=a[6].label+"",n,i,r;return{c(){t=X("button"),n=be(e),R(t,"id",a[2]),R(t,"style",a[8]),ke(t,"b3-button",!0),ke(t,"b3-button--outline",!0),ke(t,"fn__flex-center",!0),ke(t,"fn__size200",a[7])},m(o,s){ce(o,t,s),q(t,n),i||(r=me(t,"click",a[9]),i=!0)},p(o,s){s&64&&e!==(e=o[6].label+"")&&Ae(n,e),s&4&&R(t,"id",o[2]),s&256&&R(t,"style",o[8]),s&128&&ke(t,"fn__size200",o[7])},d(o){o&&le(t),i=!1,r()}}}function tr(a){let t,e,n;return{c(){t=X("input"),R(t,"id",a[2]),R(t,"type","number"),R(t,"style",a[8]),ke(t,"b3-text-field",!0),ke(t,"fn__flex-center",!0),ke(t,"fn__size200",a[7])},m(i,r){ce(i,t,r),Ue(t,a[0]),e||(n=[me(t,"input",a[14]),me(t,"change",a[10])],e=!0)},p(i,r){r&4&&R(t,"id",i[2]),r&256&&R(t,"style",i[8]),r&17&&Bt(t.value)!==i[0]&&Ue(t,i[0]),r&128&&ke(t,"fn__size200",i[7])},d(i){i&&le(t),e=!1,Be(n)}}}function nr(a){let t,e,n,i;return{c(){t=X("textarea"),R(t,"class","b3-text-field fn__block"),R(t,"style",e=`resize: vertical; height: 10em; white-space: nowrap; ${a[8]}`)},m(r,o){ce(r,t,o),Ue(t,a[0]),n||(i=[me(t,"input",a[13]),me(t,"change",a[10])],n=!0)},p(r,o){o&256&&e!==(e=`resize: vertical; height: 10em; white-space: nowrap; ${r[8]}`)&&R(t,"style",e),o&17&&Ue(t,r[0])},d(r){r&&le(t),n=!1,Be(i)}}}function rr(a){let t,e,n;return{c(){t=X("input"),R(t,"id",a[2]),R(t,"placeholder",a[3]),R(t,"style",a[8]),ke(t,"b3-text-field",!0),ke(t,"fn__flex-center",!0),ke(t,"fn__size200",a[7])},m(i,r){ce(i,t,r),Ue(t,a[0]),e||(n=[me(t,"input",a[12]),me(t,"change",a[10])],e=!0)},p(i,r){r&4&&R(t,"id",i[2]),r&8&&R(t,"placeholder",i[3]),r&256&&R(t,"style",i[8]),r&17&&t.value!==i[0]&&Ue(t,i[0]),r&128&&ke(t,"fn__size200",i[7])},d(i){i&&le(t),e=!1,Be(n)}}}function ir(a){let t,e,n;return{c(){t=X("input"),R(t,"class","b3-switch fn__flex-center"),R(t,"id",a[2]),R(t,"type","checkbox"),R(t,"style",a[8])},m(i,r){ce(i,t,r),t.checked=a[0],e||(n=[me(t,"change",a[11]),me(t,"change",a[10])],e=!0)},p(i,r){r&4&&R(t,"id",i[2]),r&256&&R(t,"style",i[8]),r&17&&(t.checked=i[0])},d(i){i&&le(t),e=!1,Be(n)}}}function Gt(a){let t,e=a[18]+"",n,i;return{c(){t=X("option"),n=be(e),t.__value=i=a[0],Ue(t,t.__value)},m(r,o){ce(r,t,o),q(t,n)},p(r,o){o&16&&e!==(e=r[18]+"")&&Ae(n,e),o&16&&i!==(i=r[0])&&(t.__value=i,Ue(t,t.__value))},d(r){r&&le(t)}}}function or(a){let t;function e(r,o){if(r[1]==="checkbox")return ir;if(r[1]==="textinput")return rr;if(r[1]==="textarea")return nr;if(r[1]==="number")return tr;if(r[1]==="button")return er;if(r[1]==="select")return Qn;if(r[1]=="slider")return Jn}let n=e(a),i=n&&n(a);return{c(){i&&i.c(),t=it()},m(r,o){i&&i.m(r,o),ce(r,t,o)},p(r,[o]){n===(n=e(r))&&i?i.p(r,o):(i&&i.d(1),i=n&&n(r),i&&(i.c(),i.m(t.parentNode,t)))},i:Te,o:Te,d(r){r&&le(t),i&&i.d(r)}}}function sr(a,t,e){let{type:n}=t,{key:i}=t,{value:r}=t,{placeholder:o=""}=t,{options:s={}}=t,{slider:l={min:0,max:100,step:1}}=t,{button:u={label:r,callback:()=>{}}}=t,{fnSize:g=!0}=t,{style:d=""}=t;const p=_n();function c(){u==null||u.callback(),p("click",{key:i})}function b(){p("changed",{key:i,value:r})}function m(){r=this.checked,e(0,r),e(4,s)}function v(){r=this.value,e(0,r),e(4,s)}function y(){r=this.value,e(0,r),e(4,s)}function w(){r=Bt(this.value),e(0,r),e(4,s)}function C(){r=Pn(this),e(0,r),e(4,s)}function D(){r=Bt(this.value),e(0,r),e(4,s)}return a.$$set=x=>{"type"in x&&e(1,n=x.type),"key"in x&&e(2,i=x.key),"value"in x&&e(0,r=x.value),"placeholder"in x&&e(3,o=x.placeholder),"options"in x&&e(4,s=x.options),"slider"in x&&e(5,l=x.slider),"button"in x&&e(6,u=x.button),"fnSize"in x&&e(7,g=x.fnSize),"style"in x&&e(8,d=x.style)},[r,n,i,o,s,l,u,g,d,c,b,m,v,y,w,C,D]}class ar extends st{constructor(t){super(),ot(this,t,sr,or,rt,{type:1,key:2,value:0,placeholder:3,options:4,slider:5,button:6,fnSize:7,style:8})}}function lr(a){let t,e,n,i,r,o,s,l,u,g;const d=a[4].default,p=Lt(d,a,a[3],null);return{c(){t=X("div"),e=X("div"),n=X("span"),i=be(a[0]),r=ue(),o=X("div"),s=ue(),l=X("span"),u=ue(),p&&p.c(),R(n,"class","title svelte-ikiu6h"),R(o,"class","b3-label__text"),R(e,"class","fn__flex-1"),R(l,"class","fn__space"),R(t,"class","item-wrap fn__flex b3-label config__item svelte-ikiu6h")},m(c,b){ce(c,t,b),q(t,e),q(e,n),q(n,i),q(e,r),q(e,o),o.innerHTML=a[1],q(t,s),q(t,l),q(t,u),p&&p.m(t,null),g=!0},p(c,b){(!g||b&1)&&Ae(i,c[0]),(!g||b&2)&&(o.innerHTML=c[1]),p&&p.p&&(!g||b&8)&&Ot(p,d,c,c[3],g?Pt(d,c[3],b,null):Mt(c[3]),null)},i(c){g||(Pe(p,c),g=!0)},o(c){Re(p,c),g=!1},d(c){c&&le(t),p&&p.d(c)}}}function cr(a){let t,e,n,i,r,o,s,l,u,g,d;const p=a[4].default,c=Lt(p,a,a[3],null);return{c(){t=X("div"),e=X("div"),n=X("span"),i=be(a[0]),r=ue(),o=X("div"),s=ue(),l=X("div"),u=ue(),g=X("div"),c&&c.c(),R(n,"class","title svelte-ikiu6h"),R(o,"class","b3-label__text"),R(l,"class","fn__hr"),Qe(g,"display","flex"),Qe(g,"flex-direction","column"),Qe(g,"gap","5px"),Qe(g,"position","relative"),R(e,"class","fn__block"),R(t,"class","item-wrap b3-label svelte-ikiu6h"),R(t,"data-key","CustomCSS")},m(b,m){ce(b,t,m),q(t,e),q(e,n),q(n,i),q(e,r),q(e,o),o.innerHTML=a[1],q(e,s),q(e,l),q(e,u),q(e,g),c&&c.m(g,null),d=!0},p(b,m){(!d||m&1)&&Ae(i,b[0]),(!d||m&2)&&(o.innerHTML=b[1]),c&&c.p&&(!d||m&8)&&Ot(c,p,b,b[3],d?Pt(p,b[3],m,null):Mt(b[3]),null)},i(b){d||(Pe(c,b),d=!0)},o(b){Re(c,b),d=!1},d(b){b&&le(t),c&&c.d(b)}}}function ur(a){let t,e,n,i;const r=[cr,lr],o=[];function s(l,u){return l[2]==="row"?0:1}return t=s(a),e=o[t]=r[t](a),{c(){e.c(),n=it()},m(l,u){o[t].m(l,u),ce(l,n,u),i=!0},p(l,[u]){let g=t;t=s(l),t===g?o[t].p(l,u):(Ut(),Re(o[g],1,1,()=>{o[g]=null}),jt(),e=o[t],e?e.p(l,u):(e=o[t]=r[t](l),e.c()),Pe(e,1),e.m(n.parentNode,n))},i(l){i||(Pe(e),i=!0)},o(l){Re(e),i=!1},d(l){l&&le(n),o[t].d(l)}}}function dr(a,t,e){let{$$slots:n={},$$scope:i}=t,{title:r}=t,{description:o}=t,{direction:s="column"}=t;return a.$$set=l=>{"title"in l&&e(0,r=l.title),"description"in l&&e(1,o=l.description),"direction"in l&&e(2,s=l.direction),"$$scope"in l&&e(3,i=l.$$scope)},[r,o,s,i,n]}class fr extends st{constructor(t){super(),ot(this,t,dr,ur,rt,{title:0,description:1,direction:2})}}const En={Wrap:fr,Input:ar};function Kt(a,t,e){const n=a.slice();return n[10]=t[e],n[11]=t,n[12]=e,n}function hr(a){var s,l,u,g;let t,e,n,i;function r(d){a[7](d,a[10])}let o={type:a[10].type,key:a[10].key,placeholder:(s=a[10])==null?void 0:s.placeholder,options:(l=a[10])==null?void 0:l.options,slider:(u=a[10])==null?void 0:u.slider,button:(g=a[10])==null?void 0:g.button};return a[10].value!==void 0&&(o.value=a[10].value),t=new En.Input({props:o}),ft.push(()=>Hn(t,"value",r)),t.$on("click",a[3]),t.$on("changed",a[4]),{c(){kt(t.$$.fragment),n=ue()},m(d,p){ht(t,d,p),ce(d,n,p),i=!0},p(d,p){var b,m,v,y;a=d;const c={};p&1&&(c.type=a[10].type),p&1&&(c.key=a[10].key),p&1&&(c.placeholder=(b=a[10])==null?void 0:b.placeholder),p&1&&(c.options=(m=a[10])==null?void 0:m.options),p&1&&(c.slider=(v=a[10])==null?void 0:v.slider),p&1&&(c.button=(y=a[10])==null?void 0:y.button),!e&&p&1&&(e=!0,c.value=a[10].value,jn(()=>e=!1)),t.$set(c)},i(d){i||(Pe(t.$$.fragment,d),i=!0)},o(d){Re(t.$$.fragment,d),i=!1},d(d){d&&le(n),pt(t,d)}}}function Yt(a,t){var r;let e,n,i;return n=new En.Wrap({props:{title:t[10].title,description:t[10].description,direction:(r=t[10])==null?void 0:r.direction,$$slots:{default:[hr]},$$scope:{ctx:t}}}),{key:a,first:null,c(){e=it(),kt(n.$$.fragment),this.first=e},m(o,s){ce(o,e,s),ht(n,o,s),i=!0},p(o,s){var u;t=o;const l={};s&1&&(l.title=t[10].title),s&1&&(l.description=t[10].description),s&1&&(l.direction=(u=t[10])==null?void 0:u.direction),s&257&&(l.$$scope={dirty:s,ctx:t}),n.$set(l)},i(o){i||(Pe(n.$$.fragment,o),i=!0)},o(o){Re(n.$$.fragment,o),i=!1},d(o){o&&le(e),pt(n,o)}}}function pr(a){let t,e,n=[],i=new Map,r,o;const s=a[6].default,l=Lt(s,a,a[8],null);let u=je(a[0]);const g=d=>d[10].key;for(let d=0;d<u.length;d+=1){let p=Kt(a,u,d),c=g(p);i.set(c,n[d]=Yt(c,p))}return{c(){t=X("div"),l&&l.c(),e=ue();for(let d=0;d<n.length;d+=1)n[d].c();R(t,"class",r="config__tab-container "+a[2]),R(t,"data-name",a[1])},m(d,p){ce(d,t,p),l&&l.m(t,null),q(t,e);for(let c=0;c<n.length;c+=1)n[c]&&n[c].m(t,null);o=!0},p(d,[p]){l&&l.p&&(!o||p&256)&&Ot(l,s,d,d[8],o?Pt(s,d[8],p,null):Mt(d[8]),null),p&25&&(u=je(d[0]),Ut(),n=$n(n,p,g,1,d,u,i,t,Wn,Yt,null,Kt),jt()),(!o||p&4&&r!==(r="config__tab-container "+d[2]))&&R(t,"class",r),(!o||p&2)&&R(t,"data-name",d[1])},i(d){if(!o){Pe(l,d);for(let p=0;p<u.length;p+=1)Pe(n[p]);o=!0}},o(d){Re(l,d);for(let p=0;p<n.length;p+=1)Re(n[p]);o=!1},d(d){d&&le(t),l&&l.d(d);for(let p=0;p<n.length;p+=1)n[p].d()}}}function mr(a,t,e){let n,{$$slots:i={},$$scope:r}=t,{group:o}=t,{settingItems:s}=t,{display:l=!0}=t;const u=_n();function g({detail:c}){u("click",{key:c.key})}function d({detail:c}){u("changed",{group:o,...c})}function p(c,b){a.$$.not_equal(b.value,c)&&(b.value=c,e(0,s))}return a.$$set=c=>{"group"in c&&e(1,o=c.group),"settingItems"in c&&e(0,s=c.settingItems),"display"in c&&e(5,l=c.display),"$$scope"in c&&e(8,r=c.$$scope)},a.$$.update=()=>{a.$$.dirty&32&&e(2,n=l?"":"fn__none")},[s,o,n,g,d,l,i,p,r]}class Xt extends st{constructor(t){super(),ot(this,t,mr,pr,rt,{group:1,settingItems:0,display:5})}}function Jt(a,t,e){const n=a.slice();return n[6]=t[e],n}function Qt(a){let t,e,n,i,r;function o(){return a[5](a[6])}return{c(){t=X("li"),e=X("span"),e.textContent=`${a[6]}`,n=ue(),R(e,"class","b3-list-item__text"),R(t,"data-name","editor"),R(t,"class","b3-list-item svelte-1fh5pey"),ke(t,"b3-list-item--focus",a[6]===a[0])},m(s,l){ce(s,t,l),q(t,e),q(t,n),i||(r=[me(t,"click",o),me(t,"keydown",yr)],i=!0)},p(s,l){a=s,l&3&&ke(t,"b3-list-item--focus",a[6]===a[0])},d(s){s&&le(t),i=!1,Be(r)}}}function gr(a){let t;return{c(){t=X("div"),t.textContent="💡 This is our default settings.",R(t,"class","fn__flex b3-label")},m(e,n){ce(e,t,n)},p:Te,d(e){e&&le(t)}}}function br(a){let t,e,n,i,r,o,s,l,u=je(a[1]),g=[];for(let d=0;d<u.length;d+=1)g[d]=Qt(Jt(a,u,d));return r=new Xt({props:{group:a[1][0],settingItems:a[2],display:a[0]===a[1][0],$$slots:{default:[gr]},$$scope:{ctx:a}}}),r.$on("changed",a[4]),r.$on("click",vr),s=new Xt({props:{group:a[1][1],settingItems:a[3],display:a[0]===a[1][1]}}),s.$on("changed",a[4]),s.$on("click",_r),{c(){t=X("div"),e=X("ul");for(let d=0;d<g.length;d+=1)g[d].c();n=ue(),i=X("div"),kt(r.$$.fragment),o=ue(),kt(s.$$.fragment),R(e,"class","b3-tab-bar b3-list b3-list--background svelte-1fh5pey"),R(i,"class","config__tab-wrap"),R(t,"class","fn__flex-1 fn__flex config__panel svelte-1fh5pey")},m(d,p){ce(d,t,p),q(t,e);for(let c=0;c<g.length;c+=1)g[c]&&g[c].m(e,null);q(t,n),q(t,i),ht(r,i,null),q(i,o),ht(s,i,null),l=!0},p(d,[p]){if(p&3){u=je(d[1]);let m;for(m=0;m<u.length;m+=1){const v=Jt(d,u,m);g[m]?g[m].p(v,p):(g[m]=Qt(v),g[m].c(),g[m].m(e,null))}for(;m<g.length;m+=1)g[m].d(1);g.length=u.length}const c={};p&1&&(c.display=d[0]===d[1][0]),p&512&&(c.$$scope={dirty:p,ctx:d}),r.$set(c);const b={};p&1&&(b.display=d[0]===d[1][1]),s.$set(b)},i(d){l||(Pe(r.$$.fragment,d),Pe(s.$$.fragment,d),l=!0)},o(d){Re(r.$$.fragment,d),Re(s.$$.fragment,d),l=!1},d(d){d&&le(t),Ct(g,d),pt(r),pt(s)}}}const yr=()=>{},vr=()=>{},_r=()=>{};function wr(a,t,e){let n=["🌈 Group 1","✨ Group 2"],i=n[0];return[i,n,[{type:"checkbox",title:"checkbox",description:"checkbox",key:"a",value:!0},{type:"textinput",title:"text",description:"This is a text",key:"b",value:"This is a text",placeholder:"placeholder"},{type:"textarea",title:"textarea",description:"This is a textarea",key:"b2",value:"This is a textarea",placeholder:"placeholder",direction:"row"},{type:"select",title:"select",description:"select",key:"c",value:"x",options:{x:"x",y:"y",z:"z"}}],[{type:"button",title:"button",description:"This is a button",key:"e",value:"Click Button",button:{label:"Click Me",callback:()=>{K.showMessage("Hello, world!")}}},{type:"slider",title:"slider",description:"slider",key:"d",value:50,slider:{min:0,max:100,step:1}}],({detail:u})=>{u.group,n[0]},u=>{e(0,i=u)}]}class kr extends st{constructor(t){super(),ot(this,t,wr,br,rt,{})}}class De{static generateFileName(t){const e=new Date().toISOString().replace(/[-:T]/g,"").slice(0,15),n=this.generateUUID8(),i=t.includes(".")?t.split(".").pop():"",r=t.includes(".")?t.split(".").slice(0,-1).join("."):t;return i?`${r}-${e}-${n}.${i}`:`${r}-${e}-${n}`}static extractOriginalName(t){const e=t.match(/^(.+)-\d{15}\.?-[a-f0-9]{8}(\..+)?$/);return e?e[1]+(e[2]||""):t}static async generateKey(t){const n=new TextEncoder().encode(t),i=await crypto.subtle.digest("SHA-256",n);return crypto.subtle.importKey("raw",i,{name:this.ALGORITHM},!1,["encrypt","decrypt"])}static generateUUID8(){const t=new Uint8Array(4);return crypto.getRandomValues(t),Array.from(t,e=>e.toString(16).padStart(2,"0")).join("")}static async encryptData(t,e){const n=await this.generateKey(e),i=crypto.getRandomValues(new Uint8Array(this.IV_LENGTH)),r=await crypto.subtle.encrypt({name:this.ALGORITHM,iv:i},n,t),o=new Uint8Array(i.length+r.byteLength);return o.set(i,0),o.set(new Uint8Array(r),i.length),o.buffer}static async decryptData(t,e){if(t.byteLength<this.IV_LENGTH)throw new Error(`加密数据长度不足，至少需要 ${this.IV_LENGTH} 字节的 IV`);const n=await this.generateKey(e),i=new Uint8Array(t.slice(0,this.IV_LENGTH));if(i.length!==this.IV_LENGTH)throw new Error(`IV 长度错误：期望 ${this.IV_LENGTH} 字节，实际 ${i.length} 字节`);const r=t.slice(this.IV_LENGTH);try{return await crypto.subtle.decrypt({name:this.ALGORITHM,iv:i},n,r)}catch(o){throw o}}static getFileTypeIcon(t){const e=t.toLowerCase().split(".").pop()||"";return["pdf"].includes(e)?"iconPDF":["doc","docx"].includes(e)?"iconEdit":["xls","xlsx"].includes(e)?"iconTable":["ppt","pptx"].includes(e)?"iconPreview":["html","htm"].includes(e)?"iconHTML5":["js","ts","jsx","tsx"].includes(e)||["css","scss","sass","less"].includes(e)||["py","java","c","cpp","php","rb","go","rs"].includes(e)?"iconCode":["txt","log"].includes(e)?"iconFile":["md","markdown"].includes(e)?"iconMarkdown":["json","xml","yaml","yml","toml","ini","cfg"].includes(e)?"iconSettings":["jpg","jpeg","png","gif","bmp","svg","webp","ico"].includes(e)?"iconImage":["mp4","avi","mov","wmv","flv","mkv","webm","m4v"].includes(e)?"iconVideo":["mp3","wav","flac","aac","ogg","wma","m4a"].includes(e)?"iconPlay":["zip","rar","7z","tar","gz","bz2","xz"].includes(e)?"iconFolder":["db","sqlite","sql"].includes(e)?"iconSQL":"iconFile"}static isEditableFile(t){const e=t.toLowerCase().split(".").pop()||"";return["txt","md","json","xml","html","css","js","ts","py","java","c","cpp"].includes(e)}}Ce(De,"ALGORITHM","AES-CBC"),Ce(De,"IV_LENGTH",16);const Xe=Object.freeze(Object.defineProperty({__proto__:null,CryptoUtils:De},Symbol.toStringTag,{value:"Module"}));class Cn{constructor(t){Ce(this,"plugin");Ce(this,"tempDir","data/assets/crypt/temp");Ce(this,"cryptedDir","data/assets/crypt/crypted");Ce(this,"previewDir","data/assets/crypt/preview");Ce(this,"filesInfoPath","data/assets/crypt/crypted/files.json");this.plugin=t}async loadFilesInfo(){try{const t=await It(this.filesInfoPath);if(!t||typeof t=="object"&&"code"in t&&t.code===404){await this.ensureDirectoryExists(this.cryptedDir);const e={};return await this.saveFilesInfo(e),e}if(typeof t=="string")try{return JSON.parse(t)}catch{return{}}return typeof t=="object"?t:{}}catch{try{await this.ensureDirectoryExists(this.cryptedDir);const e={};return await this.saveFilesInfo(e),e}catch{return{}}}}async saveFilesInfo(t){try{const e=JSON.stringify(t,null,2),n=new Blob([e],{type:"application/json"});await Ve(this.filesInfoPath,!1,n)}catch(e){throw e}}async getDataDirPath(){return""}resolveAssetPath(t){return t.replace(/\\/g,"/")}async ensureDirectoryExists(t){try{await Ve(t,!0,null)}catch{}}async initDirectories(){await this.ensureDirectoryExists(this.tempDir),await this.ensureDirectoryExists(this.cryptedDir),await this.ensureDirectoryExists(this.previewDir)}async saveEncryptedFile(t,e){await this.ensureDirectoryExists(this.tempDir);const n=await t.arrayBuffer(),i=await De.encryptData(n,e),r=De.generateFileName(t.name),o=`${this.tempDir}/${r}`,s=new Blob([new Uint8Array(i)]);return await Ve(o,!1,s),{originalName:t.name,storedName:r,filePath:o,size:t.size,createTime:Date.now(),isTemp:!0}}async getTempFiles(){try{const t=await _t(this.tempDir),e=[];if(Array.isArray(t)){for(const n of t)if(!n.isDir){const i=`${this.tempDir}/${n.name}`;let r=0;try{const o=await ut(i);o&&(r=o.size)}catch{}e.push({originalName:De.extractOriginalName(n.name),storedName:n.name,filePath:i,size:r,createTime:Date.now(),isTemp:!0})}}return e.sort((n,i)=>i.createTime-n.createTime)}catch{return[]}}async getCryptedFiles(){try{const t=await this.loadFilesInfo(),e=await _t(this.cryptedDir),n=[];if(Array.isArray(e)){for(const i of e)if(!i.isDir&&!i.name.endsWith(".meta")&&i.name!=="files.json"){const r=`${this.cryptedDir}/${i.name}`;let o=0;try{const l=await ut(r);l&&(o=l.size)}catch{}const s=t[i.name];n.push({originalName:(s==null?void 0:s.originalName)||De.extractOriginalName(i.name),storedName:i.name,filePath:r,size:(s==null?void 0:s.size)||o,createTime:(s==null?void 0:s.createTime)||Date.now(),isTemp:!1,blockId:s==null?void 0:s.blockId})}}return n.sort((i,r)=>r.createTime-i.createTime)}catch{return[]}}async updateFileBlockId(t,e){try{const n=await this.loadFilesInfo();if(!n[t]){const i=`${this.cryptedDir}/${t}`;try{await It(i);const r=De.extractOriginalName(t);n[t]={originalName:r,size:0,createTime:Date.now(),lastModified:Date.now()}}catch{n[t]={originalName:De.extractOriginalName(t),size:0,createTime:Date.now(),lastModified:Date.now()}}}n[t].blockId=e,n[t].lastModified=Date.now(),await this.saveFilesInfo(n)}catch(n){throw n}}async moveToEncrypted(t){await this.ensureDirectoryExists(this.cryptedDir);const e=`${this.tempDir}/${t}`,n=`${this.cryptedDir}/${t}`,i=await ut(e);if(!i)throw new Error(`无法读取临时文件: ${e}`);return await Ve(n,!1,i),await this.addFileToStorage(t,i.size),await vt(e),n}async addFileToStorage(t,e){try{const n=await this.loadFilesInfo(),i=De.extractOriginalName(t);n[t]={originalName:i,size:e,createTime:Date.now(),lastModified:Date.now()},await this.saveFilesInfo(n)}catch{}}async deleteFile(t){await vt(t);const e=t.split("/").pop();e&&t.includes(this.cryptedDir)&&await this.removeFileFromStorage(e)}async removeFileFromStorage(t){try{const e=await this.loadFilesInfo();e[t]&&(delete e[t],await this.saveFilesInfo(e))}catch{}}async clearPreviewDirectory(){try{const t=await _t(this.previewDir);if(Array.isArray(t)){for(const e of t)if(!e.isDir){const n=`${this.previewDir}/${e.name}`;await vt(n)}}}catch{}}async copyToPreviewAndDecrypt(t,e){try{await this.ensureDirectoryExists(this.previewDir),await this.clearPreviewDirectory();const n=this.resolveAssetPath(t),i=await ut(n);if(!i)throw new Error(`文件不存在: ${n}`);const r=await i.arrayBuffer(),o=t.split("/").pop()||"unknown",s=De.extractOriginalName(o);if(!s||s.trim()==="")return{data:new ArrayBuffer(0),originalName:"unknown_file.txt"};const l=`${this.previewDir}/${o}`,u=new Blob([r]);await Ve(l,!1,u);let g;try{g=await De.decryptData(r,e)}catch(c){throw c instanceof Error?c.name==="OperationError"?new Error("密码错误或文件已损坏，请检查密码是否正确"):new Error(`解密失败: ${c.message}`):new Error("解密过程中发生未知错误")}const d=`${this.previewDir}/${s}`,p=new Blob([g]);return await Ve(d,!1,p),{data:g,originalName:s}}catch(n){throw n}}async readDecryptedFile(t,e){try{const n=this.resolveAssetPath(t),{getFileBlob:i}=await Promise.resolve().then(()=>et),r=await i(n);if(!r)throw new Error(`无法读取文件: ${n}`);const o=await r.arrayBuffer();if(!o||o.byteLength===0)throw new Error(`文件数据为空: ${n}`);return De.decryptData(o,e)}catch(n){throw new Error(`读取解密文件失败: ${n.message||n}`)}}getFileUrl(t){const e=this.resolveAssetPath(t);return`${window.location.origin}/api/file/getFile?path=${encodeURIComponent(e)}`}}const At=Object.freeze(Object.defineProperty({__proto__:null,FileManager:Cn},Symbol.toStringTag,{value:"Module"}));function en(a,t,e){const n=a.slice();return n[52]=t[e],n}function tn(a,t,e){const n=a.slice();return n[52]=t[e],n}function xr(a){let t,e,n,i,r,o,s,l,u,g,d,p,c,b,m,v,y,w,C,D=a[3]&&nn(),x=a[0].length>0&&rn(a),B=a[1].length>0&&sn(a),S=a[0].length===0&&a[1].length===0&&!a[3]&&ln();return{c(){t=X("div"),e=X("div"),n=nt("svg"),i=nt("path"),r=ue(),o=X("p"),o.textContent="拖拽文件到此处或点击选择文件",s=ue(),l=X("button"),u=be("选择文件"),d=ue(),p=X("input"),c=ue(),D&&D.c(),b=ue(),x&&x.c(),m=ue(),B&&B.c(),v=ue(),S&&S.c(),y=it(),R(i,"d","M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"),R(n,"class","upload-icon svelte-esqoc8"),R(n,"viewBox","0 0 24 24"),R(l,"class","upload-btn svelte-esqoc8"),l.disabled=g=a[3]||!a[2],R(e,"class","upload-content svelte-esqoc8"),R(p,"type","file"),p.multiple=!0,Qe(p,"display","none"),R(t,"class","upload-area svelte-esqoc8"),ke(t,"drag-over",a[4])},m(z,T){ce(z,t,T),q(t,e),q(e,n),q(n,i),q(e,r),q(e,o),q(e,s),q(e,l),q(l,u),q(t,d),q(t,p),a[28](p),ce(z,c,T),D&&D.m(z,T),ce(z,b,T),x&&x.m(z,T),ce(z,m,T),B&&B.m(z,T),ce(z,v,T),S&&S.m(z,T),ce(z,y,T),w||(C=[me(l,"click",a[27]),me(p,"change",a[25]),me(t,"drop",a[13]),me(t,"dragover",a[14]),me(t,"dragleave",a[15])],w=!0)},p(z,T){T[0]&12&&g!==(g=z[3]||!z[2])&&(l.disabled=g),T[0]&16&&ke(t,"drag-over",z[4]),z[3]?D||(D=nn(),D.c(),D.m(b.parentNode,b)):D&&(D.d(1),D=null),z[0].length>0?x?x.p(z,T):(x=rn(z),x.c(),x.m(m.parentNode,m)):x&&(x.d(1),x=null),z[1].length>0?B?B.p(z,T):(B=sn(z),B.c(),B.m(v.parentNode,v)):B&&(B.d(1),B=null),z[0].length===0&&z[1].length===0&&!z[3]?S||(S=ln(),S.c(),S.m(y.parentNode,y)):S&&(S.d(1),S=null)},d(z){z&&(le(t),le(c),le(b),le(m),le(v),le(y)),a[28](null),D&&D.d(z),x&&x.d(z),B&&B.d(z),S&&S.d(z),w=!1,Be(C)}}}function Er(a){let t,e,n,i,r,o,s,l,u,g,d,p=a[9]==="epub"&&cn(a);return{c(){t=X("div"),e=X("div"),n=X("div"),i=X("button"),i.textContent="← 返回",r=ue(),o=X("span"),o.textContent="文件预览",s=ue(),p&&p.c(),l=ue(),u=X("div"),R(i,"class","return-btn svelte-esqoc8"),R(o,"class","preview-title svelte-esqoc8"),R(n,"class","preview-header-left svelte-esqoc8"),R(e,"class","preview-header svelte-esqoc8"),R(u,"class","preview-content svelte-esqoc8"),R(t,"class","preview-container svelte-esqoc8")},m(c,b){ce(c,t,b),q(t,e),q(e,n),q(n,i),q(n,r),q(n,o),q(e,s),p&&p.m(e,null),q(t,l),q(t,u),u.innerHTML=a[7],g||(d=me(i,"click",a[23]),g=!0)},p(c,b){c[9]==="epub"?p?p.p(c,b):(p=cn(c),p.c(),p.m(e,null)):p&&(p.d(1),p=null),b[0]&128&&(u.innerHTML=c[7])},d(c){c&&le(t),p&&p.d(),g=!1,d()}}}function nn(a){let t;return{c(){t=X("div"),t.textContent="处理中...",R(t,"class","loading svelte-esqoc8")},m(e,n){ce(e,t,n)},d(e){e&&le(t)}}}function rn(a){let t,e,n,i=a[0].length+"",r,o,s,l,u=je(a[0]),g=[];for(let d=0;d<u.length;d+=1)g[d]=on(tn(a,u,d));return{c(){t=X("div"),e=X("h3"),n=be("临时文件 ("),r=be(i),o=be(")"),s=ue(),l=X("div");for(let d=0;d<g.length;d+=1)g[d].c();R(e,"class","svelte-esqoc8"),R(l,"class","file-list svelte-esqoc8"),R(t,"class","file-section svelte-esqoc8")},m(d,p){ce(d,t,p),q(t,e),q(e,n),q(e,r),q(e,o),q(t,s),q(t,l);for(let c=0;c<g.length;c+=1)g[c]&&g[c].m(l,null)},p(d,p){if(p[0]&1&&i!==(i=d[0].length+"")&&Ae(r,i),p[0]&4390913){u=je(d[0]);let c;for(c=0;c<u.length;c+=1){const b=tn(d,u,c);g[c]?g[c].p(b,p):(g[c]=on(b),g[c].c(),g[c].m(l,null))}for(;c<g.length;c+=1)g[c].d(1);g.length=u.length}},d(d){d&&le(t),Ct(g,d)}}}function on(a){let t,e,n,i,r,o,s,l,u=a[52].originalName+"",g,d,p,c=xt(a[52].size)+"",b,m,v=Et(a[52].createTime)+"",y,w,C,D,x,B,S,z,T,Z,ne;function F(){return a[29](a[52])}function j(){return a[30](a[52])}function h(){return a[31](a[52])}return{c(){t=X("div"),e=X("div"),n=nt("svg"),i=nt("use"),o=ue(),s=X("div"),l=X("div"),g=be(u),d=ue(),p=X("div"),b=be(c),m=be(" • "),y=be(v),w=ue(),C=X("div"),D=X("button"),D.textContent="预览",x=ue(),B=X("button"),B.textContent="插到此处",S=ue(),z=X("button"),z.textContent="删除",T=ue(),R(i,"href",r="#"+De.getFileTypeIcon(a[52].originalName)),R(n,"class","file-icon svelte-esqoc8"),R(n,"viewBox","0 0 24 24"),R(l,"class","file-name svelte-esqoc8"),R(p,"class","file-meta svelte-esqoc8"),R(s,"class","file-details svelte-esqoc8"),R(e,"class","file-info svelte-esqoc8"),R(D,"class","action-btn preview svelte-esqoc8"),R(D,"title","预览"),R(B,"class","action-btn insert svelte-esqoc8"),R(B,"title","插到此处"),R(z,"class","action-btn delete svelte-esqoc8"),R(z,"title","删除"),R(C,"class","file-actions svelte-esqoc8"),R(t,"class","file-item svelte-esqoc8")},m(L,J){ce(L,t,J),q(t,e),q(e,n),q(n,i),q(e,o),q(e,s),q(s,l),q(l,g),q(s,d),q(s,p),q(p,b),q(p,m),q(p,y),q(t,w),q(t,C),q(C,D),q(C,x),q(C,B),q(C,S),q(C,z),q(t,T),Z||(ne=[me(D,"click",F),me(B,"click",j),me(z,"click",h)],Z=!0)},p(L,J){a=L,J[0]&1&&r!==(r="#"+De.getFileTypeIcon(a[52].originalName))&&R(i,"href",r),J[0]&1&&u!==(u=a[52].originalName+"")&&Ae(g,u),J[0]&1&&c!==(c=xt(a[52].size)+"")&&Ae(b,c),J[0]&1&&v!==(v=Et(a[52].createTime)+"")&&Ae(y,v)},d(L){L&&le(t),Z=!1,Be(ne)}}}function sn(a){let t,e,n,i,r=a[1].length+"",o,s,l,u;function g(v,y){return v[5]?Cr:Fr}let d=g(a),p=d(a);function c(v,y){return v[5]?Sr:Dr}let b=c(a),m=b(a);return{c(){t=X("div"),e=X("div"),n=X("h3"),i=be("已加密文件 ("),o=be(r),s=be(")"),l=ue(),p.c(),u=ue(),m.c(),R(n,"class","svelte-esqoc8"),R(e,"class","section-header svelte-esqoc8"),R(t,"class","file-section svelte-esqoc8")},m(v,y){ce(v,t,y),q(t,e),q(e,n),q(n,i),q(n,o),q(n,s),q(e,l),p.m(e,null),q(t,u),m.m(t,null)},p(v,y){y[0]&2&&r!==(r=v[1].length+"")&&Ae(o,r),d===(d=g(v))&&p?p.p(v,y):(p.d(1),p=d(v),p&&(p.c(),p.m(e,null))),b===(b=c(v))&&m?m.p(v,y):(m.d(1),m=b(v),m&&(m.c(),m.m(t,null)))},d(v){v&&le(t),p.d(),m.d()}}}function Cr(a){let t,e,n;return{c(){t=X("button"),t.textContent="隐藏",R(t,"class","view-btn hide-btn svelte-esqoc8"),R(t,"title","隐藏已加密文件")},m(i,r){ce(i,t,r),e||(n=me(t,"click",a[19]),e=!0)},p:Te,d(i){i&&le(t),e=!1,n()}}}function Fr(a){let t,e,n;return{c(){t=X("button"),t.textContent="查看",R(t,"class","view-btn svelte-esqoc8"),R(t,"title","查看已加密文件")},m(i,r){ce(i,t,r),e||(n=me(t,"click",a[18]),e=!0)},p:Te,d(i){i&&le(t),e=!1,n()}}}function Dr(a){let t;return{c(){t=X("div"),t.innerHTML='<p class="svelte-esqoc8">🔒 已加密文件列表已隐藏，点击&quot;查看&quot;按钮并输入密码以显示</p>',R(t,"class","encrypted-placeholder svelte-esqoc8")},m(e,n){ce(e,t,n)},p:Te,d(e){e&&le(t)}}}function Sr(a){let t,e=je(a[1]),n=[];for(let i=0;i<e.length;i+=1)n[i]=an(en(a,e,i));return{c(){t=X("div");for(let i=0;i<n.length;i+=1)n[i].c();R(t,"class","file-list svelte-esqoc8")},m(i,r){ce(i,t,r);for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(t,null)},p(i,r){if(r[0]&7411714){e=je(i[1]);let o;for(o=0;o<e.length;o+=1){const s=en(i,e,o);n[o]?n[o].p(s,r):(n[o]=an(s),n[o].c(),n[o].m(t,null))}for(;o<n.length;o+=1)n[o].d(1);n.length=e.length}},d(i){i&&le(t),Ct(n,i)}}}function Ar(a){let t=r()+"",e,n,i;function r(){return a[33](a[56])}return{c(){e=be(t),n=ue(),i=X("span"),i.textContent="未知位置",R(i,"class","doc-path-unknown svelte-esqoc8")},m(o,s){ce(o,e,s),ce(o,n,s),ce(o,i,s)},p(o,s){a=o,s[0]&2&&t!==(t=r()+"")&&Ae(e,t)},d(o){o&&(le(e),le(n),le(i))}}}function Br(a){let t;function e(r,o){return r[55]==="未知位置"?zr:Tr}let n=e(a),i=n(a);return{c(){i.c(),t=it()},m(r,o){i.m(r,o),ce(r,t,o)},p(r,o){n===(n=e(r))&&i?i.p(r,o):(i.d(1),i=n(r),i&&(i.c(),i.m(t.parentNode,t)))},d(r){r&&le(t),i.d(r)}}}function Tr(a){let t,e=a[55]+"",n,i,r;function o(){return a[32](a[52])}return{c(){t=X("span"),n=be(e),R(t,"class","doc-path-link svelte-esqoc8"),R(t,"title","点击跳转到文档")},m(s,l){ce(s,t,l),q(t,n),i||(r=me(t,"click",o),i=!0)},p(s,l){a=s,l[0]&2&&e!==(e=a[55]+"")&&Ae(n,e)},d(s){s&&le(t),i=!1,r()}}}function zr(a){let t;return{c(){t=X("span"),t.textContent="未知位置",R(t,"class","doc-path-unknown svelte-esqoc8")},m(e,n){ce(e,t,n)},p:Te,d(e){e&&le(t)}}}function Ir(a){let t;return{c(){t=be("未知位置")},m(e,n){ce(e,t,n)},p:Te,d(e){e&&le(t)}}}function Lr(a){let t,e,n,i,r;function o(){return a[38](a[52])}function s(){return a[39](a[52])}return{c(){t=X("button"),t.textContent="插入此处",e=ue(),n=X("button"),n.textContent="预览",R(t,"class","action-btn insert svelte-esqoc8"),R(t,"title","插入此处"),R(n,"class","action-btn preview svelte-esqoc8"),R(n,"title","预览")},m(l,u){ce(l,t,u),ce(l,e,u),ce(l,n,u),i||(r=[me(t,"click",o),me(n,"click",s)],i=!0)},p(l,u){a=l},d(l){l&&(le(t),le(e),le(n)),i=!1,Be(r)}}}function Pr(a){let t;function e(r,o){return r[55]==="未知位置"?Mr:Or}let n=e(a),i=n(a);return{c(){i.c(),t=it()},m(r,o){i.m(r,o),ce(r,t,o)},p(r,o){n===(n=e(r))&&i?i.p(r,o):(i.d(1),i=n(r),i&&(i.c(),i.m(t.parentNode,t)))},d(r){r&&le(t),i.d(r)}}}function Or(a){let t,e,n;function i(){return a[37](a[52])}return{c(){t=X("button"),t.textContent="预览",R(t,"class","action-btn preview svelte-esqoc8"),R(t,"title","预览")},m(r,o){ce(r,t,o),e||(n=me(t,"click",i),e=!0)},p(r,o){a=r},d(r){r&&le(t),e=!1,n()}}}function Mr(a){let t,e,n,i,r;function o(){return a[35](a[52])}function s(){return a[36](a[52])}return{c(){t=X("button"),t.textContent="插入此处",e=ue(),n=X("button"),n.textContent="预览",R(t,"class","action-btn insert svelte-esqoc8"),R(t,"title","插入此处"),R(n,"class","action-btn preview svelte-esqoc8"),R(n,"title","预览")},m(l,u){ce(l,t,u),ce(l,e,u),ce(l,n,u),i||(r=[me(t,"click",o),me(n,"click",s)],i=!0)},p(l,u){a=l},d(l){l&&(le(t),le(e),le(n)),i=!1,Be(r)}}}function Rr(a){let t,e,n;function i(){return a[34](a[52])}return{c(){t=X("button"),t.textContent="预览",R(t,"class","action-btn preview svelte-esqoc8"),R(t,"title","预览")},m(r,o){ce(r,t,o),e||(n=me(t,"click",i),e=!0)},p(r,o){a=r},d(r){r&&le(t),e=!1,n()}}}function an(a){let t,e,n,i,r,o,s,l,u,g,d=a[52].originalName+"",p,c,b,m=xt(a[52].size)+"",v,y,w=Et(a[52].createTime)+"",C,D,x,B,S,z,T,Z,ne,F,j,h={ctx:a,current:null,token:null,hasCatch:!0,pending:Ir,then:Br,catch:Ar,value:55,error:56};bt(x=a[11](a[52].blockId||""),h);let L={ctx:a,current:null,token:null,hasCatch:!0,pending:Rr,then:Pr,catch:Lr,value:55};bt(z=a[11](a[52].blockId||""),L);function J(){return a[40](a[52])}return{c(){t=X("div"),e=X("div"),n=nt("svg"),i=nt("use"),o=ue(),s=X("span"),s.textContent="🔐",l=ue(),u=X("div"),g=X("div"),p=be(d),c=ue(),b=X("div"),v=be(m),y=be(" • "),C=be(w),D=be(` • 
                                         `),h.block.c(),B=ue(),S=X("div"),L.block.c(),T=ue(),Z=X("button"),Z.textContent="删除",ne=ue(),R(i,"href",r="#"+De.getFileTypeIcon(a[52].originalName)),R(n,"class","file-icon svelte-esqoc8"),R(n,"viewBox","0 0 24 24"),R(s,"class","encrypt-badge svelte-esqoc8"),R(g,"class","file-name svelte-esqoc8"),R(b,"class","file-meta svelte-esqoc8"),R(u,"class","file-details svelte-esqoc8"),R(e,"class","file-info svelte-esqoc8"),R(Z,"class","action-btn delete svelte-esqoc8"),R(Z,"title","删除"),R(S,"class","file-actions svelte-esqoc8"),R(t,"class","file-item svelte-esqoc8")},m(U,ee){ce(U,t,ee),q(t,e),q(e,n),q(n,i),q(e,o),q(e,s),q(e,l),q(e,u),q(u,g),q(g,p),q(u,c),q(u,b),q(b,v),q(b,y),q(b,C),q(b,D),h.block.m(b,h.anchor=null),h.mount=()=>b,h.anchor=null,q(t,B),q(t,S),L.block.m(S,L.anchor=null),L.mount=()=>S,L.anchor=T,q(S,T),q(S,Z),q(t,ne),F||(j=me(Z,"click",J),F=!0)},p(U,ee){a=U,ee[0]&2&&r!==(r="#"+De.getFileTypeIcon(a[52].originalName))&&R(i,"href",r),ee[0]&2&&d!==(d=a[52].originalName+"")&&Ae(p,d),ee[0]&2&&m!==(m=xt(a[52].size)+"")&&Ae(v,m),ee[0]&2&&w!==(w=Et(a[52].createTime)+"")&&Ae(C,w),h.ctx=a,ee[0]&2&&x!==(x=a[11](a[52].blockId||""))&&bt(x,h)||Ht(h,a,ee),L.ctx=a,ee[0]&2&&z!==(z=a[11](a[52].blockId||""))&&bt(z,L)||Ht(L,a,ee)},d(U){U&&le(t),h.block.d(),h.token=null,h=null,L.block.d(),L.token=null,L=null,F=!1,j()}}}function ln(a){let t;return{c(){t=X("div"),t.innerHTML="<p>暂无文件，请上传文件开始使用</p>",R(t,"class","empty-state svelte-esqoc8")},m(e,n){ce(e,t,n)},d(e){e&&le(t)}}}function cn(a){let t,e,n;return{c(){t=X("div"),e=X("a"),n=be("下载文件"),R(e,"href",a[24]()),R(e,"download",a[8]),R(e,"class","epub-download-btn svelte-esqoc8"),R(t,"class","preview-header-right svelte-esqoc8")},m(i,r){ce(i,t,r),q(t,e),q(e,n)},p(i,r){r[0]&256&&R(e,"download",i[8])},d(i){i&&le(t)}}}function Ur(a){let t;function e(r,o){return r[6]?Er:xr}let n=e(a),i=n(a);return{c(){t=X("div"),i.c(),R(t,"class","file-manager svelte-esqoc8")},m(r,o){ce(r,t,o),i.m(t,null)},p(r,o){n===(n=e(r))&&i?i.p(r,o):(i.d(1),i=n(r),i&&(i.c(),i.m(t,null)))},i:Te,o:Te,d(r){r&&le(t),i.d()}}}function un(a){if(!a||typeof a!="string")return console.error("getContentType: 无效的文件名:",a),"other";try{const t=a.toLowerCase().split(".").pop()||"";return jr(t)}catch(t){return console.error("getContentType: 处理文件名时出错:",t,"fileName:",a),"other"}}function jr(a){return["txt","md","json","xml","csv","log","js","ts","html","css","py","java","cpp","c","h"].includes(a)?"text":["jpg","jpeg","png","gif","bmp","webp","svg"].includes(a)?"image":a==="pdf"?"pdf":a==="epub"?"epub":["mp3","wav","ogg","aac","m4a","flac"].includes(a)?"audio":["mp4","avi","mov","wmv","flv","webm","mkv"].includes(a)?"video":"other"}async function dn(a,t,e){switch(e){case"text":const n=new TextDecoder().decode(t);return`
                    <div style="padding: 20px; height: 100%; display: flex; flex-direction: column; font-family: monospace;">
                        <div style="margin-bottom: 15px; border-bottom: 1px solid var(--b3-border-color); padding-bottom: 10px;">
                            <h4 style="margin: 0; color: var(--b3-theme-on-background);">📝 ${a}</h4>
                        </div>
                        <div style="flex: 1; overflow: auto; background: var(--b3-theme-surface); padding: 15px; border-radius: 6px; border: 1px solid var(--b3-border-color);">
                            <pre style="margin: 0; white-space: pre-wrap; word-wrap: break-word; font-size: 14px; line-height: 1.5; color: var(--b3-theme-on-surface);">${n.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</pre>
                        </div>
                    </div>
                `;case"image":const i=new Blob([t]),r=URL.createObjectURL(i);return`
                    <div style="padding: 20px; height: 100%; display: flex; flex-direction: column; text-align: center;">
                        <div style="margin-bottom: 15px; border-bottom: 1px solid var(--b3-border-color); padding-bottom: 10px;">
                            <h4 style="margin: 0; color: var(--b3-theme-on-background);">🖼️ ${a}</h4>
                        </div>
                        <div style="flex: 1; display: flex; align-items: center; justify-content: center; overflow: auto;">
                            <img src="${r}" alt="${a}" style="max-width: 100%; max-height: 100%; object-fit: contain; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" />
                        </div>
                    </div>
                `;case"pdf":const o=new Blob([t],{type:"application/pdf"}),s=URL.createObjectURL(o);return`
                    <div style="padding: 20px; height: 100%; display: flex; flex-direction: column;">
                        <div style="margin-bottom: 15px; border-bottom: 1px solid var(--b3-border-color); padding-bottom: 10px;">
                            <h4 style="margin: 0; color: var(--b3-theme-on-background);">📄 ${a}</h4>
                        </div>
                        <div style="flex: 1; overflow: hidden;">
                            <iframe src="${s}" style="width: 100%; height: 70vh; border: none; border-radius: 6px;"></iframe>
                        </div>
                    </div>
                `;case"epub":const l=(t.byteLength/1024).toFixed(2);return`
                    <div style="padding: 20px; height: 100%; display: flex; flex-direction: column;">
                        <div style="margin-bottom: 15px; border-bottom: 1px solid var(--b3-border-color); padding-bottom: 10px;">
                            <h4 style="margin: 0; color: var(--b3-theme-on-background);">📄 ${a}</h4>
                        </div>
                        <div id="epubViewer" style="flex: 1; border: 1px solid var(--b3-border-color); border-radius: 4px; background: white; position: relative; overflow: hidden; height: 100vh; min-height: 600px;">
                            <iframe id="epubContent" style="width: 100%; height: 70vh; border: none; display: none;" sandbox="allow-same-origin allow-scripts"></iframe>
                            <div id="epubPlaceholder" style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--b3-theme-on-surface-variant);">
                                <div style="text-align: center;">
                                    <div style="font-size: 48px; margin-bottom: 20px;">📖</div>
                                    <p>正在加载 EPUB 文件...</p>
                                    <p style="font-size: 12px; margin-top: 10px; color: var(--b3-theme-on-surface-variant);">文件大小: ${l} KB</p>
                                </div>
                            </div>
                        </div>
                        <div id="epubControls" style="margin-top: 10px; text-align: center; display: none;">
                            <button id="prevBtn" style="padding: 6px 12px; margin-right: 10px; border: 1px solid var(--b3-border-color); background: var(--b3-theme-background); border-radius: 4px; cursor: pointer;">⬅️ 上一页</button>
                            <div id="pageInfo" style="margin: 0 15px; color: var(--b3-theme-on-surface); display: inline-flex; align-items: center; gap: 5px;">
                                <input id="pageInput" type="number" min="1" value="1" style="width: 50px; padding: 4px; border: 1px solid var(--b3-border-color); border-radius: 4px; text-align: center; background: var(--b3-theme-background); color: var(--b3-theme-on-surface);" />
                                <span>/</span>
                                <span id="totalPages">1</span>
                            </div>
                            <button id="nextBtn" style="padding: 6px 12px; margin-left: 10px; border: 1px solid var(--b3-border-color); background: var(--b3-theme-background); border-radius: 4px; cursor: pointer;">下一页 ➡️</button>
                        </div>
                    </div>
                `;case"audio":const u=new Blob([t]),g=URL.createObjectURL(u);return`
                    <div style="padding: 20px; height: 100%; display: flex; flex-direction: column; text-align: center;">
                        <div style="margin-bottom: 15px; border-bottom: 1px solid var(--b3-border-color); padding-bottom: 10px;">
                            <h4 style="margin: 0; color: var(--b3-theme-on-background);">🎵 ${a}</h4>
                        </div>
                        <div style="flex: 1; display: flex; align-items: center; justify-content: center;">
                            <audio controls style="width: 100%; max-width: 400px;">
                                <source src="${g}" type="audio/mpeg">
                                您的浏览器不支持音频播放。
                            </audio>
                        </div>
                    </div>
                `;case"video":const d=new Blob([t]),p=URL.createObjectURL(d);return`
                    <div style="padding: 20px; height: 100%; display: flex; flex-direction: column; text-align: center;">
                        <div style="margin-bottom: 15px; border-bottom: 1px solid var(--b3-border-color); padding-bottom: 10px;">
                            <h4 style="margin: 0; color: var(--b3-theme-on-background);">🎬 ${a}</h4>
                        </div>
                        <div style="flex: 1; display: flex; align-items: center; justify-content: center; overflow: auto;">
                            <video controls style="max-width: 100%; max-height: 100%; border-radius: 6px;">
                                <source src="${p}" type="video/mp4">
                                您的浏览器不支持视频播放。
                            </video>
                        </div>
                    </div>
                `;default:return`
                    <div style="padding: 20px; height: 100%; display: flex; flex-direction: column; text-align: center;">
                        <div style="margin-bottom: 15px; border-bottom: 1px solid var(--b3-border-color); padding-bottom: 10px;">
                            <h4 style="margin: 0; color: var(--b3-theme-on-background);">${a}</h4>
                        </div>
                        <div style="flex: 1; display: flex; align-items: center; justify-content: center;">
                            <div style="text-align: center; color: var(--b3-theme-on-surface-variant);">
                                <p>暂不支持预览此文件类型</p>
                                <p>文件大小: ${(t.byteLength/1024).toFixed(2)} KB</p>
                            </div>
                        </div>
                    </div>
                `}}function xt(a){if(a===0)return"0 B";const t=1024,e=["B","KB","MB","GB"],n=Math.floor(Math.log(a)/Math.log(t));return parseFloat((a/Math.pow(t,n)).toFixed(2))+" "+e[n]}function Et(a){return new Date(a).toLocaleString()}async function ct(a,t){var w,C,D,x;const e=await t.loadAsync(a),n=await((w=e.file("META-INF/container.xml"))==null?void 0:w.async("text"));if(!n)throw new Error("无效的EPUB文件：缺少container.xml");const i=new DOMParser,o=(C=i.parseFromString(n,"text/xml").querySelector("rootfile"))==null?void 0:C.getAttribute("full-path");if(!o)throw new Error("无法找到OPF文件路径");const s=await((D=e.file(o))==null?void 0:D.async("text"));if(!s)throw new Error("无法读取OPF文件");const l=i.parseFromString(s,"text/xml"),u=l.querySelectorAll("manifest item"),g=l.querySelectorAll("spine itemref"),d=new Map;u.forEach(B=>{const S=B.getAttribute("id"),z=B.getAttribute("href");S&&z&&d.set(S,z)});let p=null;const c=l.querySelector('meta[name="cover"]');if(c){const B=c.getAttribute("content");B&&d.has(B)&&(p=d.get(B))}if(!p){const B=l.querySelector('manifest item[properties*="cover-image"]');B&&(p=B.getAttribute("href"))}if(!p)for(const B of u){const S=(x=B.getAttribute("id"))==null?void 0:x.toLowerCase(),z=B.getAttribute("media-type");if(S&&z&&z.startsWith("image/")&&(S.includes("cover")||S.includes("front"))){p=B.getAttribute("href");break}}const b=[],m=o.substring(0,o.lastIndexOf("/")+1);if(p){const B=m+p;b.push({id:"cover",path:"cover",title:"封面",coverImagePath:B,isCover:!0})}let v=1;for(const B of g){const S=B.getAttribute("idref");if(S&&d.has(S)){const z=d.get(S);let T;z.startsWith("/")?T=z.substring(1):m&&!z.startsWith(m)?T=m+z:T=z,console.log(`章节 ${v}: idref=${S}, href=${z}, basePath=${m}, fullPath=${T}`);let Z=`第 ${v} 章`;try{const ne=e.file(T);if(ne){const F=await ne.async("text"),h=new DOMParser().parseFromString(F,"text/html");let L=null;const J=h.querySelector("title");if(J&&J.textContent.trim()&&(L=J.textContent.trim()),!L){const U=h.querySelectorAll("h1, h2, h3");for(const ee of U){const W=ee.textContent.trim();if(W&&W.length>0&&W.length<100){L=W;break}}}if(!L){const U=h.querySelectorAll("p, div");for(const ee of U){const W=ee.textContent.trim();if(W&&(W.includes("章")||W.includes("Chapter"))&&W.length<50){L=W;break}}}L&&(Z=L)}}catch(ne){console.warn(`提取章节标题失败: ${ne.message}`)}b.push({id:S,path:T,title:Z}),v++}}let y=null;try{const B=l.querySelector('manifest item[media-type="application/x-dtbncx+xml"]')||l.querySelector('manifest item[properties*="nav"]')||l.querySelector('manifest item[id*="toc"]')||l.querySelector('manifest item[id*="ncx"]');if(B){const S=B.getAttribute("href"),z=m+S,T=e.file(z);if(T){const Z=await T.async("text");y={path:z,content:Z,basePath:m}}}}catch(B){console.warn("解析目录失败:",B)}return{chapters:b,zipContent:e,basePath:m,coverImagePath:p?m+p:null,tocData:y}}async function Nr(a,t,e,n){const i=a.querySelectorAll("img");for(const r of i){const o=r.getAttribute("src");if(o&&!o.startsWith("http")&&!o.startsWith("data:"))try{let s=o;if(o.startsWith("/"))s=o.substring(1);else if(o.startsWith("../")){const u=n.substring(0,n.lastIndexOf("/"));s=u.substring(0,u.lastIndexOf("/")+1)+o.substring(3)}else s=n.substring(0,n.lastIndexOf("/")+1)+o;console.log("尝试加载图片:",o,"->",s);let l=t.file(s);if(!l){const u=o.split("/").pop(),g=[`images/${u}`,`Images/${u}`,`OEBPS/images/${u}`,`OEBPS/Images/${u}`,`text/images/${u}`,`content/images/${u}`,u];for(const d of g)if(l=t.file(d),l){console.log("在路径找到图片:",d);break}}if(l){const u=await l.async("arraybuffer"),g=s.toLowerCase().split(".").pop();let d="image/jpeg";switch(g){case"png":d="image/png";break;case"gif":d="image/gif";break;case"svg":d="image/svg+xml";break;case"webp":d="image/webp";break;case"bmp":d="image/bmp";break}const p=new Blob([u],{type:d}),c=URL.createObjectURL(p);r.setAttribute("src",c),r.style.maxWidth="100%",r.style.height="auto",r.style.display="block",r.style.margin="10px auto",console.log("图片加载成功:",o),r.onload=()=>{setTimeout(()=>{URL.revokeObjectURL(c)},6e4)}}else console.warn("找不到图片文件:",o,"尝试的路径:",s),r.style.border="1px dashed #ccc",r.style.padding="10px",r.alt=`图片未找到: ${o}`}catch(s){console.warn("处理图片失败:",o,s)}}}function qr(a,t,e){let{plugin:n}=t,i,r=[],o=[],s="",l=!1,u=!1,g=!1,d=!1,p="",c="",b="",m=null,v;async function y(_){if(console.log("getDocPathByBlockId 被调用，blockId:",_),!_)return console.log("blockId 为空，返回未知位置"),"未知位置";try{console.log("正在实时获取区块路径，blockId:",_);const I=await wn(_);console.log("getHPathByID 返回结果:",I);let O="未知位置";if(typeof I=="string")O=I||"未知位置";else if(I&&typeof I=="object"){const A=I;O=A.data||A.hPath||A.path||"未知位置"}return O}catch(I){return console.warn("获取文档路径失败:",I),"未知位置"}}async function w(_){if(!_){K.showMessage("无效的区块ID",3e3,"error");return}try{const I=await K.openTab({app:n.app,doc:{id:_}});console.log("成功跳转到区块:",_,I)}catch(I){console.error("跳转失败:",I),K.showMessage("跳转失败，请检查区块是否存在",3e3,"error")}}vn(()=>{const _=async()=>{i=new Cn(n),await i.initDirectories(),await C(),n.settingUtils&&e(2,s=n.settingUtils.get("encryptPassword")||"")},I=async O=>{console.log("filemanager.svelte: 收到 expandFilePreview 事件"),console.log("事件详情:",O),console.log("事件 detail:",O.detail);const{name:A,data:$}=O.detail;console.log("提取的 fileName:",A,"类型:",typeof A),console.log("提取的 data:",$,"类型:",typeof $);try{if(!A||typeof A!="string"){console.error("filemanager.svelte: 无效的文件名:",A),K.showMessage("无效的文件名",3e3,"error");return}g||e(5,g=!0),e(8,c=A),console.log("filemanager.svelte: 准备调用 getContentType，fileName:",A),e(9,b=un(A)),console.log("filemanager.svelte: getContentType 返回结果:",b),b==="epub"&&(m=$),e(7,p=await dn(A,$,b)),e(6,d=!0),b==="epub"&&setTimeout(()=>{M(A,$)},100),K.showMessage(`已在侧边栏展开预览: ${A}`,2e3,"info")}catch(G){console.error("侧边展开预览失败:",G),K.showMessage("侧边展开预览失败",3e3,"error")}};return _(),document.addEventListener("expandFilePreview",I),()=>{document.removeEventListener("expandFilePreview",I)}});async function C(){e(3,l=!0);try{e(0,r=await i.getTempFiles()),e(1,o=await i.getCryptedFiles())}catch(_){console.error("刷新文件列表失败:",_),K.showMessage("刷新文件列表失败",3e3,"error")}finally{e(3,l=!1)}}function D(){return n.settingUtils?(n.settingUtils.get("encryptPassword")||"").trim():""}async function x(_){const I=D();if(!I){K.showMessage("请先在插件设置中配置加密密码",3e3,"error");return}e(3,l=!0);try{for(const O of Array.from(_))await i.saveEncryptedFile(O,I);await C(),K.showMessage(`成功上传 ${_.length} 个文件`,3e3,"info")}catch(O){console.error("文件上传失败:",O),K.showMessage("文件上传失败",3e3,"error")}finally{e(3,l=!1)}}function B(_){var O;_.preventDefault(),e(4,u=!1);const I=(O=_.dataTransfer)==null?void 0:O.files;I&&I.length>0&&x(I)}function S(_){_.preventDefault(),e(4,u=!0)}function z(_){_.preventDefault(),e(4,u=!1)}async function T(_){if(confirm(`确定要删除文件 "${_.originalName}" 吗？`))try{await i.deleteFile(_.filePath),await C(),K.showMessage("文件删除成功",3e3,"info")}catch(I){console.error("删除文件失败:",I),K.showMessage("删除文件失败",3e3,"error")}}async function Z(_){try{e(3,l=!0);const I=await i.moveToEncrypted(_.storedName),O=await ne(_,I);O&&await i.updateFileBlockId(_.storedName,O),await C()}catch(I){console.error("移动文件失败:",I),K.showMessage("移动文件失败",3e3,"error")}finally{e(3,l=!1)}}async function ne(_,I){try{const O=`crypt://${encodeURIComponent(I)}`,A=`> 🔐 **Encrypted File**: [${_.originalName}](${O})`;console.log("Generated crypt link:",O),console.log("Block content:",A);try{const{insertBlock:$}=await Promise.resolve().then(()=>et);console.log("尝试获取当前活动编辑器...");let G=document.querySelector(".protyle:not(.fn__none) .protyle-wysiwyg");if(console.log("方法1 - protyle:",G),!G){const H=document.querySelector(".layout-tab-container .item--focus");G=H==null?void 0:H.querySelector(".protyle-wysiwyg"),console.log("方法2 - activeTab:",H,"protyle:",G)}if(G||(G=document.querySelector(".protyle-wysiwyg:not(.fn__none)"),console.log("方法3 - protyle:",G)),G){let H=null;const Q=G.querySelector("[data-node-id].protyle-wysiwyg--select")||G.querySelector("[data-node-id]");if(Q&&(H=Q.getAttribute("data-node-id"),console.log("找到父块ID:",H)),H){console.log("使用API插入块，parentId:",H);const se=await $("markdown",A,void 0,void 0,H);if(console.log("API插入结果:",se),se&&se.length>0&&se[0].doOperations){const re=se[0].doOperations.find(ae=>ae.action==="insert");if(re&&re.id)return re.id}}else console.log("未找到有效的父块ID")}else console.log("未找到活动的protyle编辑器");return await navigator.clipboard.writeText(A),K.showMessage(`文件块已复制到剪贴板: ${_.originalName}`,3e3,"info"),null}catch($){return console.warn("API插入失败，使用剪贴板方案:",$),await navigator.clipboard.writeText(A),K.showMessage(`文件块已复制到剪贴板: ${_.originalName}`,3e3,"info"),null}}catch(O){return console.error("嵌入加密文件链接失败:",O),K.showMessage(`嵌入失败: ${O.message||"未知错误"}`,3e3,"error"),null}}async function F(){const _=await j();if(_){const I=await D();if(_===I)e(5,g=!0),K.showMessage("密码验证成功",2e3,"info");else{const O=await j("密码错误，请重新输入：");O&&O===I&&(e(5,g=!0),K.showMessage("密码验证成功",2e3,"info"))}}}async function j(_){return new Promise(I=>{const O=_||"请输入文件解密密码:",A=_&&_.includes("错误"),$=new K.Dialog({title:"🔐 输入加密密码",content:`
                    <div style="padding: 20px;">
                        <div style="margin-bottom: 15px;">
                            <label for="cryptPassword" style="display: block; margin-bottom: 5px; font-weight: bold; color: ${A?"var(--b3-theme-error)":"var(--b3-theme-on-background)"};">${O}</label>
                            <input type="password" id="cryptPassword" placeholder="请输入密码" 
                                   style="width: 100%; padding: 8px; border: 1px solid ${A?"var(--b3-theme-error)":"var(--b3-border-color)"}; border-radius: 4px;" />
                        </div>
                        <div style="text-align: right; margin-top: 20px;">
                            <button id="cancelBtn" style="margin-right: 10px; padding: 6px 12px; border: 1px solid var(--b3-border-color); background: var(--b3-theme-background); border-radius: 4px;">取消</button>
                            <button id="confirmBtn" style="padding: 6px 12px; background: var(--b3-theme-primary); color: white; border: none; border-radius: 4px;">确认</button>
                        </div>
                    </div>
                `,width:"400px",destroyCallback:()=>{I(null)}}),G=$.element.querySelector("#cryptPassword"),H=$.element.querySelector("#confirmBtn"),Q=$.element.querySelector("#cancelBtn");setTimeout(()=>G==null?void 0:G.focus(),100),H==null||H.addEventListener("click",()=>{var re;const se=(re=G==null?void 0:G.value)==null?void 0:re.trim();se?($.destroy(),I(se)):G==null||G.focus()}),Q==null||Q.addEventListener("click",()=>{$.destroy(),I(null)}),G==null||G.addEventListener("keypress",se=>{se.key==="Enter"&&(H==null||H.click())})})}function h(){e(5,g=!1)}function L(_){K.showMessage("无法预览未知位置的文件，请先将文件插入到文档中",3e3,"error"),console.warn("尝试预览未知位置的文件:",_.originalName,"blockId:",_.blockId)}async function J(_){try{const I=await ne(_,_.filePath);I?(_.blockId=I,await i.updateFileBlockId(_.storedName,I),await C()):K.showMessage("文件链接已复制到剪贴板，请手动粘贴到文档中",3e3,"info")}catch(I){console.error("插入文件失败:",I),K.showMessage("插入文件失败，请重试",3e3,"error")}}async function U(_){const I=D();if(!I){K.showMessage("请先在插件设置中配置加密密码",3e3,"error");return}try{e(3,l=!0);const O=await i.copyToPreviewAndDecrypt(_.filePath,I);e(8,c=_.originalName),e(9,b=un(_.originalName)),b==="epub"&&(m=O.data),e(7,p=await dn(_.originalName,O.data,b)),e(6,d=!0),b==="epub"&&setTimeout(()=>{M(_.originalName,O.data)},100)}catch(O){console.error("预览文件失败:",O),K.showMessage("预览文件失败，请检查密码是否正确",3e3,"error")}finally{e(3,l=!1)}}function ee(){e(6,d=!1),e(7,p=""),e(8,c=""),e(9,b=""),m=null}function W(){if(m){const _=new Blob([m],{type:"application/epub+zip"});return URL.createObjectURL(_)}return""}function ie(_){const I=_.target;I.files&&I.files.length>0&&x(I.files)}async function M(_,I){try{const O=(await Promise.resolve().then(()=>Bn)).default,A=document.getElementById("epubContent"),$=document.getElementById("epubPlaceholder"),G=document.getElementById("epubControls"),H=document.getElementById("prevBtn"),Q=document.getElementById("nextBtn"),se=document.getElementById("pageInfo");if(!A||!$||!G){console.error("EPUB阅读器元素未找到");return}let re=0,ae=[];const Ee=await ct(I,O);if(ae=Ee.chapters,ae.length===0)throw new Error("未找到可读取的章节");re=0,P(Ee,re,A,$,G,H,Q,se),$.style.display="none",A.style.display="block",G.style.display="block",H==null||H.addEventListener("click",async()=>{if(re>0){re--;const fe=await ct(I,O);P(fe,re,A,$,G,H,Q,se)}}),Q==null||Q.addEventListener("click",async()=>{if(re<ae.length-1){re++;const fe=await ct(I,O);P(fe,re,A,$,G,H,Q,se)}});const pe=document.getElementById("pageInput");pe==null||pe.addEventListener("keypress",async fe=>{if(fe.key==="Enter"){const de=parseInt(pe.value);if(de>=1&&de<=ae.length){re=de-1;const we=await ct(I,O);P(we,re,A,$,G,H,Q,se)}else pe.value=(re+1).toString(),alert(`请输入有效的页码范围：1-${ae.length}`)}}),pe==null||pe.addEventListener("blur",async()=>{const fe=parseInt(pe.value);if(fe>=1&&fe<=ae.length&&fe!==re+1){re=fe-1;const de=await ct(I,O);P(de,re,A,$,G,H,Q,se)}else(fe<1||fe>ae.length)&&(pe.value=(re+1).toString())})}catch(O){console.error("EPUB自动加载失败:",O);const A=document.getElementById("epubPlaceholder");A&&(A.innerHTML=`
                    <div style="text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 20px;">❌</div>
                        <p>EPUB加载失败: ${O.message}</p>
                    </div>
                `)}}async function P(_,I,O,A,$,G,H,Q){var se,re;try{const ae=_.chapters[I];if(ae.isCover){await te(ae,O,A,$,G,H,Q,_,I);return}ae.path&&(ae.path.toLowerCase().includes("cover")||ae.id==="cover.xhtml")&&console.log("检测到封面页面，尝试特殊处理:",ae.path),A.style.display="block",O.style.display="none",console.log(`尝试读取章节文件: ${ae.path}`),console.log("ZIP文件中的所有文件:",Object.keys(_.zipContent.files));const Ee=[ae.path,ae.path.replace(/^.*\//,""),`OEBPS/${ae.path}`,`EPUB/${ae.path}`,ae.path.replace(/^OEBPS\//,""),ae.path.replace(/^EPUB\//,"")];let pe=null;for(const ze of Ee)if(pe=_.zipContent.file(ze),pe){console.log(`找到章节文件，使用路径: ${ze}`);break}if(!pe)throw new Error(`无法找到章节文件: ${ae.path}，尝试的路径: ${Ee.join(", ")}`);const fe=await pe.async("text");if(console.log(`章节内容长度: ${fe?fe.length:"null/undefined"}`),console.log(`章节内容前100字符: ${fe?fe.substring(0,100):"null/undefined"}`),!fe||fe.trim()==="")throw new Error(`无法读取章节内容或内容为空: ${ae.title}`);const we=new DOMParser().parseFromString(fe,"text/html");we.querySelectorAll("script").forEach(ze=>ze.remove()),we.querySelectorAll("style").forEach(ze=>ze.remove()),we.querySelectorAll("svg image").forEach(ze=>ze.remove());let _e="";we.body&&we.body.innerHTML?_e=we.body.innerHTML:we.documentElement&&we.documentElement.innerHTML?_e=we.documentElement.innerHTML:_e=fe,console.log(`提取的内容长度: ${_e?_e.length:"null/undefined"}`),console.log(`提取的内容前100字符: ${_e?_e.substring(0,100):"null/undefined"}`),(!_e||_e.trim()==="")&&(_e=fe,console.log("使用原始内容作为后备")),(!_e||_e.trim()===""||_e==="undefined")&&(console.warn("章节内容为空或无效，使用默认消息"),_e='<p style="text-align: center; color: #666; font-style: italic;">此章节暂无内容或内容加载失败</p>');const He=new DOMParser().parseFromString(_e,"text/html"),Se=He.body||He.documentElement;console.log("解析前content:",_e?_e.substring(0,200):"null/undefined"),console.log("解析后body2:",Se),console.log("body2.innerHTML:",Se?Se.innerHTML:"body2 is null"),await Nr(Se,_.zipContent,_.basePath,ae.path),console.log(`图片处理后DOM内容长度: ${Se.innerHTML?Se.innerHTML.length:"null/undefined"}`),console.log("图片处理后body2.innerHTML前200字符:",Se.innerHTML?Se.innerHTML.substring(0,200):"null/undefined");let Me=Se.innerHTML||_e||'<p style="text-align: center; color: #666; font-style: italic;">此章节暂无内容或内容加载失败</p>';console.log("最终显示内容:",Me?Me.substring(0,200):"null/undefined");const Ze=`
                 <!DOCTYPE html>
                 <html>
                 <head>
                     <meta charset="UTF-8">
                     <meta name="viewport" content="width=device-width, initial-scale=1.0">
                     <title>${ae.title}</title>
                     <style>
                         body {
                             margin: 0;
                             padding: 20px;
                             line-height: 1.8;
                             font-family: 'Georgia', 'Times New Roman', serif;
                             color: #333;
                             background: white;
                             min-height: 100vh;
                             box-sizing: border-box;
                             width: 100%;
                         }
                         h2 {
                             color: #333;
                             margin-bottom: 30px;
                             font-size: 1.5em;
                             border-bottom: 2px solid #007acc;
                             padding-bottom: 10px;
                         }
                         .content {
                             font-size: 16px;
                             line-height: 1.8;
                         }
                         img {
                             max-width: 100%;
                             height: auto;
                             display: block;
                             margin: 10px auto;
                         }
                     </style>
                 </head>
                 <body>
                     <h2>${ae.title}</h2>
                     <div class="content">${Me}</div>
                 </body>
                 </html>
             `,at=O;at.onload=()=>{var qt;const ze=at.contentDocument||((qt=at.contentWindow)==null?void 0:qt.document);ze&&(ze.open(),ze.write(Ze),ze.close(),oe(ze,_,O,A,$,G,H,Q))};const lt=at.contentDocument||((se=at.contentWindow)==null?void 0:se.document);lt&&(lt.open(),lt.write(Ze),lt.close(),oe(lt,_,O,A,$,G,H,Q)),A.style.display="none",O.style.display="block",$.style.display="block";const Dt=document.getElementById("pageInput"),Nt=document.getElementById("totalPages");Dt&&Nt&&(Dt.value=(I+1).toString(),Nt.textContent=_.chapters.length.toString(),Dt.max=_.chapters.length.toString()),G.disabled=I===0,H.disabled=I===_.chapters.length-1,G.onclick=()=>{I>0&&P(_,I-1,O,A,$,G,H,Q)},H.onclick=()=>{I<_.chapters.length-1&&P(_,I+1,O,A,$,G,H,Q)}}catch(ae){console.error("显示章节失败:",ae),A.style.display="none",O.style.display="block";const Ee=`
                 <!DOCTYPE html>
                 <html>
                 <head>
                     <meta charset="UTF-8">
                     <meta name="viewport" content="width=device-width, initial-scale=1.0">
                     <title>加载失败</title>
                     <style>
                         body {
                             margin: 0;
                             padding: 20px;
                             text-align: center;
                             color: #d32f2f;
                             font-family: 'Georgia', 'Times New Roman', serif;
                             background: white;
                         }
                         h3 {
                             margin-bottom: 20px;
                         }
                         p {
                             margin: 10px 0;
                         }
                     </style>
                 </head>
                 <body>
                     <h3>章节加载失败</h3>
                     <p>${ae.message}</p>
                     <p style="font-size: 12px; margin-top: 10px;">请尝试切换到其他章节</p>
                 </body>
                 </html>
             `,pe=O,fe=pe.contentDocument||((re=pe.contentWindow)==null?void 0:re.document);fe&&(fe.open(),fe.write(Ee),fe.close())}}function oe(_,I,O,A,$,G,H,Q){try{const se=_.querySelectorAll('nav[epub\\:type="toc"] a[href], nav[role="doc-toc"] a[href], #toc a[href]');se.forEach(re=>{const ae=re.getAttribute("href");ae&&ae.includes(".xhtml")&&(re.addEventListener("click",Ee=>{Ee.preventDefault();let pe=ae;ae.startsWith("../")?pe=I.basePath+ae.substring(3):ae.startsWith("/")||(pe=I.basePath+ae);const fe=pe.split("#")[0],de=I.chapters.findIndex(we=>we.path===fe||we.path.endsWith(fe)||fe.endsWith(we.path));de!==-1?(console.log(`目录跳转: ${ae} -> 章节 ${de+1}`),P(I,de,O,A,$,G,H,Q)):(console.warn("未找到目标章节:",fe),console.log("可用章节路径:",I.chapters.map(we=>we.path)))}),re.style.cursor="pointer",re.style.color="#007acc",re.style.textDecoration="underline")}),console.log(`设置了 ${se.length} 个目录链接的点击事件`)}catch(se){console.warn("设置目录导航失败:",se)}}async function te(_,I,O,A,$,G,H,Q,se){var re,ae;try{const Ee=Q.zipContent.file(_.coverImagePath);if(!Ee)throw new Error("无法找到封面图片文件");const pe=await Ee.async("arraybuffer"),fe=_.coverImagePath.toLowerCase().split(".").pop();let de="image/jpeg";switch(fe){case"png":de="image/png";break;case"gif":de="image/gif";break;case"svg":de="image/svg+xml";break;case"webp":de="image/webp";break;case"bmp":de="image/bmp";break}const we=new Blob([pe],{type:de}),$e=URL.createObjectURL(we),Le=`
                 <!DOCTYPE html>
                 <html>
                 <head>
                     <meta charset="UTF-8">
                     <meta name="viewport" content="width=device-width, initial-scale=1.0">
                     <title>${_.title}</title>
                     <style>
                         body {
                             margin: 0;
                             padding: 0;
                             height: 100vh;
                             display: flex;
                             flex-direction: column;
                             align-items: center;
                             justify-content: center;
                             background: white;
                             font-family: 'Georgia', 'Times New Roman', serif;
                         }
                         h2 {
                             color: #333;
                             margin-bottom: 20px;
                             text-align: center;
                         }
                         img {
                             max-width: 90%;
                             max-height: 70%;
                             object-fit: contain;
                             border-radius: 8px;
                             box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                         }
                     </style>
                 </head>
                 <body>
                     <h2>${_.title}</h2>
                     <img src="${$e}" alt="封面" 
                          onload="console.log('封面加载成功')" 
                          onerror="console.error('封面加载失败')" />
                 </body>
                 </html>
             `,Ne=I;Ne.onload=()=>{var Me;const Se=Ne.contentDocument||((Me=Ne.contentWindow)==null?void 0:Me.document);Se&&(Se.open(),Se.write(Le),Se.close())};const _e=Ne.contentDocument||((re=Ne.contentWindow)==null?void 0:re.document);_e&&(_e.open(),_e.write(Le),_e.close()),I.style.display="block",O.style.display="none",A.style.display="block";const Ke=document.getElementById("pageInput"),He=document.getElementById("totalPages");Ke&&He&&(Ke.value=(se+1).toString(),He.textContent=Q.chapters.length.toString(),Ke.max=Q.chapters.length.toString()),$.disabled=se===0,G.disabled=se===Q.chapters.length-1,$.onclick=()=>{se>0&&P(Q,se-1,I,O,A,$,G,H)},G.onclick=()=>{se<Q.chapters.length-1&&P(Q,se+1,I,O,A,$,G,H)},setTimeout(()=>{URL.revokeObjectURL($e)},3e4)}catch(Ee){console.error("显示封面失败:",Ee);const pe=`
                 <!DOCTYPE html>
                 <html>
                 <head>
                     <meta charset="UTF-8">
                     <meta name="viewport" content="width=device-width, initial-scale=1.0">
                     <title>加载失败</title>
                     <style>
                         body {
                             margin: 0;
                             padding: 20px;
                             text-align: center;
                             color: #d32f2f;
                             font-family: 'Georgia', 'Times New Roman', serif;
                             background: white;
                         }
                         h3 {
                             margin-bottom: 20px;
                         }
                         p {
                             margin: 10px 0;
                         }
                     </style>
                 </head>
                 <body>
                     <h3>封面加载失败</h3>
                     <p>${Ee.message}</p>
                 </body>
                 </html>
             `,fe=I,de=fe.contentDocument||((ae=fe.contentWindow)==null?void 0:ae.document);de&&(de.open(),de.write(pe),de.close())}}const Y=()=>v.click();function ye(_){ft[_?"unshift":"push"](()=>{v=_,e(10,v)})}const ve=_=>U(_),he=_=>Z(_),ge=_=>T(_),Fe=_=>w(_.blockId||""),xe=_=>(console.error("获取文档路径异常:",_),"未知位置"),Oe=_=>U(_),Ie=_=>J(_),f=_=>L(_),V=_=>U(_),N=_=>J(_),E=_=>L(_),k=_=>T(_);return a.$$set=_=>{"plugin"in _&&e(26,n=_.plugin)},[r,o,s,l,u,g,d,p,c,b,v,y,w,B,S,z,T,Z,F,h,L,J,U,ee,W,ie,n,Y,ye,ve,he,ge,Fe,xe,Oe,Ie,f,V,N,E,k]}class Wr extends st{constructor(t){super(),ot(this,t,qr,Ur,rt,{plugin:26},null,[-1,-1])}}const $r=a=>{let t;switch(a){case"checkbox":t=e=>e.checked;break;case"select":case"slider":case"textinput":case"textarea":case"password":t=e=>e.value;break;case"number":t=e=>parseInt(e.value);break;default:t=()=>null;break}return t},Hr=a=>{let t;switch(a){case"checkbox":t=(e,n)=>{e.checked=n};break;case"select":case"slider":case"textinput":case"textarea":case"number":case"password":t=(e,n)=>{e.value=n};break;default:t=()=>{};break}return t};class Zr{constructor(t){Ce(this,"plugin");Ce(this,"name");Ce(this,"file");Ce(this,"settings",new Map);Ce(this,"elements",new Map);this.name=t.name??"settings",this.plugin=t.plugin,this.file=this.name.endsWith(".json")?this.name:`${this.name}.json`,this.plugin.setting=new K.Setting({width:t.width,height:t.height,confirmCallback:()=>{for(let n of this.settings.keys())this.updateValueFromElement(n);let e=this.dump();t.callback!==void 0&&t.callback(e),this.plugin.data[this.name]=e,this.save(e)},destroyCallback:()=>{for(let e of this.settings.keys())this.updateElementFromValue(e)}})}async load(){let t=await this.plugin.loadData(this.file);if(t)for(let[e,n]of this.settings)n.value=(t==null?void 0:t[e])??n.value;return this.plugin.data[this.name]=this.dump(),t}async save(t){return t=t??this.dump(),await this.plugin.saveData(this.file,this.dump()),t}get(t){var e;return(e=this.settings.get(t))==null?void 0:e.value}set(t,e){let n=this.settings.get(t);n&&(n.value=e,this.updateElementFromValue(t))}async setAndSave(t,e){let n=this.settings.get(t);n&&(n.value=e,this.updateElementFromValue(t),await this.save())}take(t,e=!1){let n=this.settings.get(t),i=this.elements.get(t);if(i)return e&&this.updateValueFromElement(t),n.getEleVal(i)}async takeAndSave(t){let e=this.take(t,!0);return await this.save(),e}disable(t){let e=this.elements.get(t);e&&(e.disabled=!0)}enable(t){let e=this.elements.get(t);e&&(e.disabled=!1)}dump(){let t={};for(let[e,n]of this.settings)n.type!=="button"&&(t[e]=n.value);return t}addItem(t){if(this.settings.set(t.key,t),!(t.type==="custom"&&(t.createElement===void 0||t.getEleVal===void 0||t.setEleVal===void 0)))if(t.getEleVal===void 0&&(t.getEleVal=$r(t.type)),t.setEleVal===void 0&&(t.setEleVal=Hr(t.type)),t.createElement===void 0){let i=this.createDefaultElement(t);this.elements.set(t.key,i),this.plugin.setting.addItem({title:t.title,description:t==null?void 0:t.description,direction:t==null?void 0:t.direction,createActionElement:()=>(this.updateElementFromValue(t.key),this.getElement(t.key))})}else this.plugin.setting.addItem({title:t.title,description:t==null?void 0:t.description,direction:t==null?void 0:t.direction,createActionElement:()=>{let i=this.get(t.key),r=t.createElement(i);return this.elements.set(t.key,r),r}})}createDefaultElement(t){var i,r,o,s,l,u,g,d,p,c;let e;const n=b=>{b.key==="Enter"&&(b.preventDefault(),b.stopImmediatePropagation())};switch(t.type){case"checkbox":let b=document.createElement("input");b.type="checkbox",b.checked=t.value,b.className="b3-switch fn__flex-center",e=b,b.onchange=((i=t.action)==null?void 0:i.callback)??(()=>{});break;case"select":let m=document.createElement("select");m.className="b3-select fn__flex-center fn__size200";let v=(t==null?void 0:t.options)??{};for(let z in v){let T=document.createElement("option"),Z=v[z];T.value=z,T.text=Z,m.appendChild(T)}m.value=t.value,m.onchange=((r=t.action)==null?void 0:r.callback)??(()=>{}),e=m;break;case"slider":let y=document.createElement("input");y.type="range",y.className="b3-slider fn__size200 b3-tooltips b3-tooltips__n",y.ariaLabel=t.value,y.min=((o=t.slider)==null?void 0:o.min.toString())??"0",y.max=((s=t.slider)==null?void 0:s.max.toString())??"100",y.step=((l=t.slider)==null?void 0:l.step.toString())??"1",y.value=t.value,y.onchange=()=>{var z;y.ariaLabel=y.value,(z=t.action)==null||z.callback()},e=y;break;case"textinput":let w=document.createElement("input");w.className="b3-text-field fn__flex-center fn__size200",w.value=t.value,w.onchange=((u=t.action)==null?void 0:u.callback)??(()=>{}),e=w,w.addEventListener("keydown",n);break;case"password":let C=document.createElement("input");C.type="password",C.className="b3-text-field fn__flex-center fn__size200",C.value=t.value,C.onchange=((g=t.action)==null?void 0:g.callback)??(()=>{}),e=C,C.addEventListener("keydown",n);break;case"textarea":let D=document.createElement("textarea");D.className="b3-text-field fn__block",D.value=t.value,D.onchange=((d=t.action)==null?void 0:d.callback)??(()=>{}),e=D;break;case"number":let x=document.createElement("input");x.type="number",x.className="b3-text-field fn__flex-center fn__size200",x.value=t.value,e=x,x.addEventListener("keydown",n);break;case"button":let B=document.createElement("button");B.className="b3-button b3-button--outline fn__flex-center fn__size200",B.innerText=((p=t.button)==null?void 0:p.label)??"Button",B.onclick=((c=t.button)==null?void 0:c.callback)??(()=>{}),e=B;break;case"hint":let S=document.createElement("div");S.className="b3-label fn__flex-center",e=S;break}return e}getElement(t){return this.elements.get(t)}updateValueFromElement(t){let e=this.settings.get(t);if(e.type==="button")return;let n=this.elements.get(t);e.value=e.getEleVal(n)}updateElementFromValue(t){let e=this.settings.get(t);if(e.type==="button")return;let n=this.elements.get(t);e.setEleVal(n,e.value)}}const Vr=a=>{const t=new K.Dialog({title:a.title,content:'<div class="dialog-content" style="display: flex; height: 100%;"/>',width:a.width,height:a.height,destroyCallback:a.callback});return t.element.querySelector(".dialog-content").appendChild(a.ele),{dialog:t,close:t.destroy.bind(t)}},Gr=a=>{let t=document.createElement("div");t.style.display="contents";let e=a.constructor(t);const{dialog:n,close:i}=Vr({...a,ele:t,callback:()=>{e.$destroy(),a.callback&&a.callback()}});return{component:e,dialog:n,close:i}},fn="menu-config",Kr="custom_tab",hn="siyuan-crypt-plugin-activation-key";class Yr extends K.Plugin{constructor(){super(...arguments);Ce(this,"fileManagerDock");Ce(this,"settingUtils");Ce(this,"customTab");Ce(this,"isMobile");Ce(this,"blockIconEventBindThis",this.blockIconEvent.bind(this));Ce(this,"cryptLinkClickBindThis",this.handleCryptLinkClick.bind(this))}async encryptAndSaveActivationData(e,n){try{const i=JSON.stringify(n),o=new TextEncoder().encode(i),s=await De.encryptData(o.buffer,hn),l=new Uint8Array(s),u=btoa(String.fromCharCode(...l));localStorage.setItem(e,u)}catch(i){throw console.error("加密激活数据失败:",i),new Error("激活数据加密失败")}}async decryptActivationData(e){const n=localStorage.getItem(e);if(!n)return null;try{if(/^[A-Za-z0-9+/]*={0,2}$/.test(n)){const i=Uint8Array.from(atob(n),u=>u.charCodeAt(0)),r=await De.decryptData(i.buffer,hn),s=new TextDecoder().decode(r);return JSON.parse(s)}}catch(i){console.error("❌ 解密激活数据失败:",i)}try{const i=JSON.parse(n);if(i&&typeof i=="object")return i}catch(i){console.error("解析原始JSON数据也失败:",i)}return null}async onload(){this.data[fn]={readonlyText:"Readonly"};const e=K.getFrontend();this.isMobile=e==="mobile"||e==="browser-mobile",this.addIcons(`<symbol id="iconCryptFile" viewBox="0 0 32 32">
<path d="M16 2C8.268 2 2 8.268 2 16s6.268 14 14 14 14-6.268 14-14S23.732 2 16 2zm0 26C9.373 28 4 22.627 4 16S9.373 4 16 4s12 5.373 12 12-5.373 12-12 12z"/>
<path d="M16 8c-2.206 0-4 1.794-4 4v2h-1c-0.553 0-1 0.447-1 1v8c0 0.553 0.447 1 1 1h10c0.553 0 1-0.447 1-1v-8c0-0.553-0.447-1-1-1h-1v-2c0-2.206-1.794-4-4-4zm0 2c1.103 0 2 0.897 2 2v2h-4v-2c0-1.103 0.897-2 2-2zm-4 6h8v6h-8v-6z"/>
<circle cx="16" cy="19" r="1"/>
</symbol>
<symbol id="iconSaving" viewBox="0 0 32 32">
<path d="M20 13.333c0-0.733 0.6-1.333 1.333-1.333s1.333 0.6 1.333 1.333c0 0.733-0.6 1.333-1.333 1.333s-1.333-0.6-1.333-1.333zM10.667 12h6.667v-2.667h-6.667v2.667zM29.333 10v9.293l-3.76 1.253-2.24 7.453h-7.333v-2.667h-2.667v2.667h-7.333c0 0-3.333-11.28-3.333-15.333s3.28-7.333 7.333-7.333h6.667c1.213-1.613 3.147-2.667 5.333-2.667 1.107 0 2 0.893 2 2 0 0.28-0.053 0.533-0.16 0.773-0.187 0.453-0.347 0.973-0.427 1.533l3.027 3.027h2.893zM26.667 12.667h-1.333l-4.667-4.667c0-0.867 0.12-1.72 0.347-2.547-1.293 0.333-2.347 1.293-2.787 2.547h-8.227c-2.573 0-4.667 2.093-4.667 4.667 0 2.507 1.627 8.867 2.68 12.667h2.653v-2.667h8v2.667h2.68l2.067-6.867 3.253-1.093v-4.707z"></path>
</symbol>`),this.addCommand({langKey:"showDialog",hotkey:"⇧⌘O",callback:()=>{this.showDialog()},fileTreeCallback:n=>{},editorCallback:n=>{},dockCallback:n=>{n&&n.getAttribute("data-type")==="file-manager-dock"&&setTimeout(async()=>{this.fileManagerDock&&await this.initializeDockInterface(this.fileManagerDock)},100)}}),this.addCommand({langKey:"openFileManager",hotkey:"⇧⌘F",callback:()=>{this.openFileManager()}}),this.addCommand({langKey:"getTab",hotkey:"⇧⌘M",globalCallback:()=>{}}),this.fileManagerDock=this.addDock({config:{position:"RightTop",size:{width:300,height:0},icon:"iconCryptFile",title:"加密文件管理器",hotkey:"⇧⌘F"},data:{plugin:this},type:"file-manager-dock",resize(){},update(){},init:async n=>{await n.data.plugin.initializeDockInterface(n)},destroy:()=>{this.fileManagerDock=null}}),this.settingUtils=new Zr({plugin:this,name:fn}),this.settingUtils.addItem({key:"licenseActivation",value:"",type:"custom",title:"许可证激活",description:"请输入您的激活码以验证许可证",createElement:n=>{const i=document.createElement("div");i.className="fn__flex-column",i.style.gap="12px";const r=document.createElement("input");r.type="text",r.className="b3-text-field fn__flex-center fn__size200",r.placeholder="请输入激活码";const o=h=>!h||h.length<=4?h:"*".repeat(h.length-4)+h.slice(-4),s=n||"";r.value=s?o(s):"";let l=s;const u=document.createElement("div");u.className="fn__flex",u.style.gap="8px";const g=document.createElement("a");g.href="https://shop.hugeshop.cyou/",g.target="_blank",g.className="b3-button b3-button--outline",g.textContent="购买",g.style.minWidth="45px",g.style.textDecoration="none",g.style.display="inline-flex",g.style.alignItems="center",g.style.justifyContent="center";const d=document.createElement("button");d.className="b3-button b3-button--outline",d.textContent="验证",d.style.minWidth="45px";let p=null;const c=(h,L)=>{var J,U;if(p||(p=(J=i.closest(".config__item"))==null?void 0:J.querySelector(".b3-label__text")),!p){const ee=document.querySelectorAll(".config__item .b3-label__text");for(const W of ee)if((U=W.textContent)!=null&&U.includes("请输入您的激活码以验证许可证")){p=W;break}}p&&(p.innerHTML=`请输入您的激活码以验证许可证<br><span style="font-size: 12px; min-height: 16px; color: ${L};">${h}</span>`)},b=()=>{var h;p=(h=i.closest(".config__item"))==null?void 0:h.querySelector(".b3-label__text")},m=document.createElement("div");m.className="fn__flex",m.style.alignItems="center",m.style.gap="8px",m.style.marginTop="8px";const v=document.createElement("label");v.textContent="允许使用激活码找回密码",v.style.fontSize="14px",v.style.color="#333";const y=document.createElement("input");y.type="checkbox",y.className="b3-switch";const w=localStorage.getItem("allow_password_recovery")==="true";y.checked=w,m.appendChild(v),m.appendChild(y);const C=(h,L,J="text")=>new Promise(U=>{const ee=document.createElement("div");ee.style.cssText=`
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(0, 0, 0, 0.5);
              z-index: 10000;
              display: flex;
              align-items: center;
              justify-content: center;
            `;const W=document.createElement("div");W.style.cssText=`
              background: white;
              border-radius: 8px;
              padding: 20px;
              min-width: 300px;
              max-width: 400px;
              box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            `;const ie=document.createElement("h3");ie.textContent=h,ie.style.cssText=`
              margin: 0 0 15px 0;
              color: #333;
              font-size: 16px;
            `;const M=document.createElement("p");M.textContent=L,M.style.cssText=`
              margin: 0 0 15px 0;
              color: #666;
              font-size: 14px;
            `;const P=document.createElement("input");P.type=J,P.style.cssText=`
              width: 100%;
              padding: 8px 12px;
              border: 1px solid #ddd;
              border-radius: 4px;
              font-size: 14px;
              margin-bottom: 15px;
              box-sizing: border-box;
            `;const oe=document.createElement("div");oe.style.cssText=`
              display: flex;
              gap: 10px;
              justify-content: flex-end;
            `;const te=document.createElement("button");te.textContent="取消",te.style.cssText=`
              padding: 8px 16px;
              border: 1px solid #ddd;
              background: white;
              border-radius: 4px;
              cursor: pointer;
              font-size: 14px;
            `;const Y=document.createElement("button");Y.textContent="确认",Y.style.cssText=`
              padding: 8px 16px;
              border: none;
              background: #4caf50;
              color: white;
              border-radius: 4px;
              cursor: pointer;
              font-size: 14px;
            `,W.appendChild(ie),W.appendChild(M),W.appendChild(P),oe.appendChild(te),oe.appendChild(Y),W.appendChild(oe),ee.appendChild(W),document.body.appendChild(ee),P.focus();const ye=()=>{document.body.removeChild(ee)};te.onclick=()=>{ye(),U(null)},Y.onclick=()=>{const ve=P.value.trim();ye(),U(ve||null)},P.onkeydown=ve=>{if(ve.key==="Enter"){const he=P.value.trim();ye(),U(he||null)}else ve.key==="Escape"&&(ye(),U(null))},ee.onclick=ve=>{ve.target===ee&&(ye(),U(null))}}),D=async h=>{try{const L=await this.decryptActivationData("license_activation_data");return L&&L.activationCode===h}catch(L){return console.error("验证激活码失败:",L),!1}};y.addEventListener("change",async()=>{const h=y.checked;if(localStorage.getItem("allow_password_recovery")==="true"&&!h){const J=await C("验证激活码","请输入激活码以确认关闭密码找回功能:","password");if(!J){y.checked=!0;return}if(!await D(J)){alert("激活码验证失败，无法关闭密码找回功能"),y.checked=!0;return}}localStorage.setItem("allow_password_recovery",h.toString()),h?(r.disabled=!0,r.style.backgroundColor="#f5f5f5",r.title="开启密码找回功能后，激活码已锁定"):(r.disabled=!1,r.style.backgroundColor="",r.title="")}),w&&(r.disabled=!0,r.style.backgroundColor="#f5f5f5",r.title="开启密码找回功能后，激活码已锁定"),r.addEventListener("click",async()=>{if(localStorage.getItem("allow_password_recovery")==="true"){const L=await C("验证激活码","请输入当前激活码以修改:","password");if(!L)return;if(!await D(L)){alert("激活码验证失败，无法修改激活码");return}r.disabled=!1,r.style.backgroundColor="",r.value="",r.placeholder="请输入新的激活码",r.focus();const U=()=>{setTimeout(()=>{r.disabled=!0,r.style.backgroundColor="#f5f5f5",r.placeholder="请输入激活码",r.value.trim()&&(l=r.value.trim(),r.value=o(l)),r.removeEventListener("blur",U)},100)};r.addEventListener("blur",U)}}),r.addEventListener("input",()=>{localStorage.getItem("allow_password_recovery")==="true"||(l=r.value)});const x=async()=>{const h=l.trim();if(!h){c("❌ 请输入激活码","#d23f31");return}const L=await this.decryptActivationData("license_activation_data");if(L)try{if(L.activationCode===h&&L.isActivated){const J=new Date(L.expiredDate);if(new Date<=J){c(`✅ 激活成功！到期时间: ${L.expiredDate}`,"#4caf50"),K.showMessage("激活码验证成功！",3e3,"info");return}}if(L.activationCode&&L.activationCode!==h){const J=`检测到您已有激活码：${L.activationCode}

您正在尝试激活新的激活码：${h}

激活新激活码将会替换原有激活码，原激活码将被作废。

是否确认继续激活新激活码？`;if(!window.confirm(J)){d.disabled=!1,d.textContent="激活",c("❌ 用户取消激活","#d23f31");return}localStorage.removeItem("license_activation_data"),localStorage.removeItem("license_check_date"),localStorage.removeItem("license_data"),K.showMessage("已清空原有激活数据，正在激活新激活码...",3e3,"info")}}catch(J){console.error("解析本地激活数据失败:",J)}d.disabled=!0,d.textContent="验证中...",c("🔄 正在验证激活码...","#2196f3");try{const J=await fetch("https://shop.hugeshop.cyou/api/carmi-lifecycle/activate/by-content",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({carmi_content:h})}),U=await J.json();if(J.ok&&U.success)if(U.locked===0){const ee={isActivated:!0,activationCode:h,activationDate:U.data.activation_date,expiredDate:U.data.expired_date,carmiId:U.data.carmi_id};await this.encryptAndSaveActivationData("license_activation_data",ee),localStorage.setItem("license_check_date",new Date().toDateString()),this.settingUtils.set("licenseActivation",h),c(`✅ 激活成功！到期时间: ${U.data.expired_date}`,"#4caf50"),this.updateLicenseDisplay(U.data),await this.loadLicenseData(!0),this.fileManagerDock&&this.fileManagerDock.element&&await this.initializeDockInterface(this.fileManagerDock),K.showMessage("激活码验证成功！",3e3,"info")}else U.locked===1?(c("❌ 激活码已被使用，不允许激活","#d23f31"),K.showMessage("激活码已被使用，不允许激活",3e3,"error")):(c(`❌ 激活失败: 未知状态 (locked: ${U.locked})`,"#d23f31"),K.showMessage("激活失败: 未知状态",3e3,"error"));else{const ee=U.message||"激活码验证失败";c(`❌ ${ee}`,"#d23f31"),K.showMessage(ee,3e3,"error")}}catch(J){console.error("激活码验证失败:",J),c("❌ 网络错误，请检查网络连接后重试","#d23f31"),K.showMessage("网络错误，请检查网络连接后重试",3e3,"error")}finally{d.disabled=!1,d.textContent="验证"}};d.addEventListener("click",x),r.addEventListener("keypress",h=>{h.key==="Enter"&&(h.preventDefault(),x())});const B=document.createElement("button");B.style.cssText=`
          position: relative;
          width: 80px;
          height: 32px;
          border: 1px solid var(--b3-border-color);
          border-radius: 6px;
          background: var(--b3-theme-background);
          cursor: pointer;
          margin-left: 10px;
          overflow: hidden;
          transition: all 0.3s ease;
        `;const S=document.createElement("div");S.style.cssText=`
          position: absolute;
          top: 2px;
          left: 2px;
          width: 36px;
          height: 28px;
          background: #4caf50;
          border-radius: 4px;
          transition: transform 0.3s ease;
          z-index: 1;
        `;const z=document.createElement("span");z.textContent="编辑",z.style.cssText=`
          position: absolute;
          left: 6px;
          top: 50%;
          transform: translateY(-50%);
          font-size: 12px;
          color: white;
          z-index: 2;
          transition: color 0.3s ease;
        `;const T=document.createElement("span");T.textContent="只读",T.style.cssText=`
          position: absolute;
          right: 6px;
          top: 50%;
          transform: translateY(-50%);
          font-size: 12px;
          color: var(--b3-theme-on-background);
          z-index: 2;
          transition: color 0.3s ease;
        `,B.appendChild(S),B.appendChild(z),B.appendChild(T);let Z=!1;const ne=h=>{h?(S.style.transform="translateX(40px)",z.style.color="var(--b3-theme-on-background)",T.style.color="white",r.readOnly=!0,r.style.backgroundColor="#f5f5f5"):(S.style.transform="translateX(0)",z.style.color="white",T.style.color="var(--b3-theme-on-background)",r.readOnly=!1,r.style.backgroundColor="")},F=h=>{const L=document.createElement("div");L.style.cssText=`
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
          `;const J=document.createElement("div");J.style.cssText=`
            background: var(--b3-theme-background);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            min-width: 300px;
            max-width: 400px;
          `;const U=document.createElement("h3");U.textContent="验证激活码",U.style.cssText=`
            margin: 0 0 15px 0;
            color: var(--b3-theme-on-background);
            font-size: 16px;
          `;const ee=document.createElement("p");ee.textContent="请输入激活码以切换只读模式：",ee.style.cssText=`
            margin: 0 0 15px 0;
            color: var(--b3-theme-on-background);
            font-size: 14px;
          `;const W=document.createElement("input");W.type="text",W.placeholder="请输入激活码",W.style.cssText=`
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--b3-border-color);
            border-radius: 4px;
            font-size: 14px;
            margin-bottom: 15px;
            box-sizing: border-box;
          `;const ie=document.createElement("div");ie.style.cssText=`
            display: flex;
            gap: 10px;
            justify-content: flex-end;
          `;const M=document.createElement("button");M.textContent="取消",M.style.cssText=`
            padding: 8px 16px;
            border: 1px solid var(--b3-border-color);
            background: var(--b3-theme-background);
            color: var(--b3-theme-on-background);
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
          `;const P=document.createElement("button");P.textContent="确认",P.style.cssText=`
            padding: 8px 16px;
            border: none;
            background: #4caf50;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
          `;const oe=()=>{document.body.removeChild(L)},te=()=>{const Y=W.value.trim();if(!Y){K.showMessage("请输入激活码",2e3,"error");return}Y===l?(oe(),h(),K.showMessage("验证成功",2e3,"info")):(K.showMessage("激活码错误",2e3,"error"),W.value="",W.focus())};M.addEventListener("click",oe),P.addEventListener("click",te),W.addEventListener("keypress",Y=>{Y.key==="Enter"&&(Y.preventDefault(),te())}),L.addEventListener("keydown",Y=>{Y.key==="Escape"&&oe()}),L.addEventListener("click",Y=>{Y.target===L&&oe()}),ie.appendChild(M),ie.appendChild(P),J.appendChild(U),J.appendChild(ee),J.appendChild(W),J.appendChild(ie),L.appendChild(J),document.body.appendChild(L),setTimeout(()=>W.focus(),100)};B.addEventListener("click",()=>{if(!l){K.showMessage("请先设置激活码",2e3,"error");return}F(()=>{Z=!Z,ne(Z)})}),ne(!1),u.appendChild(g),u.appendChild(d),u.appendChild(B),i.appendChild(r),i.appendChild(u),i.activationInput=r,i.updateDescriptionWithStatus=c,i.actualActivationCode=()=>l,i.setActualActivationCode=h=>{l=h,r.value=h?o(h):""},n&&this.getActivationStatus().then(h=>{if(h.isActivated){const L=h.data;c(`✅ 已激活！到期时间: ${L.expiredDate}`,"#4caf50")}else h.reason==="激活已过期"?c("❌ 激活已过期，请重新激活","#d23f31"):h.reason==="未激活"?c("❌ 卡密已经激活，无法重复激活","#d23f31"):c(`❌ ${h.reason}`,"#d23f31")}).catch(h=>{console.error("检查激活状态失败:",h),c("❌ 检查激活状态失败","#d23f31")});const j=new MutationObserver(()=>{i.closest(".config__item")&&(b(),j.disconnect())});return j.observe(document.body,{childList:!0,subtree:!0}),i},getEleVal:n=>{const i=n.actualActivationCode;return i?i().trim():""},setEleVal:(n,i)=>{const r=n.setActualActivationCode;r&&r(i||"")}}),this.settingUtils.addItem({key:"encryptPassword",value:"",type:"custom",title:"加密密码",description:"🛑 密码一旦设置，永久不可修改<br/>🔓 密码请勿过于简单，避免被特征破解<br/>⚠️ 【密码找回】可以通过激活码找回密码",createElement:n=>{const i=document.createElement("div");if(i.className="fn__flex-column",i.style.gap="8px",n&&n.length>0){const p=document.createElement("div");p.className="b3-text-field fn__flex-center fn__size200",p.style.backgroundColor="#f5f5f5",p.style.color="#666",p.style.cursor="not-allowed",p.textContent="********";const c=document.createElement("button");c.className="b3-button b3-button--outline",c.style.marginTop="8px",c.style.width="100px",c.textContent="密码找回";const b=(m,v,y="text")=>new Promise(w=>{const C=document.createElement("div");C.style.cssText=`
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
              `;const D=document.createElement("div");D.style.cssText=`
                background: white;
                border-radius: 8px;
                padding: 20px;
                min-width: 300px;
                max-width: 400px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
              `;const x=document.createElement("h3");x.textContent=m,x.style.cssText=`
                margin: 0 0 15px 0;
                color: #333;
                font-size: 16px;
              `;const B=document.createElement("p");B.textContent=v,B.style.cssText=`
                margin: 0 0 15px 0;
                color: #666;
                font-size: 14px;
              `;const S=document.createElement("input");S.type=y,S.style.cssText=`
                width: 100%;
                padding: 8px;
                border: 1px solid #ddd;
                border-radius: 4px;
                margin-bottom: 20px;
                box-sizing: border-box;
              `;const z=document.createElement("div");z.style.cssText=`
                display: flex;
                justify-content: flex-end;
                gap: 10px;
              `;const T=document.createElement("button");T.textContent="取消",T.style.cssText=`
                padding: 6px 12px;
                border: 1px solid #ddd;
                background: white;
                border-radius: 4px;
                cursor: pointer;
              `;const Z=document.createElement("button");Z.textContent="确认",Z.style.cssText=`
                padding: 6px 12px;
                background: #007acc;
                color: white;
                border: none;
                border-radius: 4px;
                cursor: pointer;
              `,z.appendChild(T),z.appendChild(Z),D.appendChild(x),D.appendChild(B),D.appendChild(S),D.appendChild(z),C.appendChild(D),document.body.appendChild(C),S.focus();const ne=()=>{document.body.removeChild(C)};T.onclick=()=>{ne(),w(null)},Z.onclick=()=>{const F=S.value.trim();ne(),w(F||null)},S.onkeydown=F=>{if(F.key==="Enter"){F.preventDefault();const j=S.value.trim();ne(),w(j||null)}else F.key==="Escape"&&(F.preventDefault(),ne(),w(null))},C.onclick=F=>{F.target===C&&(ne(),w(null))}});return c.addEventListener("click",async()=>{const m=await b("验证激活码","请输入激活码以找回密码:","password");if(!m)return;const v=this.settingUtils.get("licenseActivation");if(!(m===v)){alert("激活码验证失败，无法找回密码");return}p.textContent=n,p.style.color="#333",setTimeout(()=>{p.textContent="********",p.style.color="#666"},3e3)}),i.appendChild(p),i.appendChild(c),i.isReadonly=!0,i.currentPassword=n,i}const o=document.createElement("input");o.type="password",o.className="b3-text-field fn__flex-center fn__size200",o.placeholder="请输入加密密码",o.value="";const s=document.createElement("input");s.type="password",s.className="b3-text-field fn__flex-center fn__size200",s.placeholder="请再次输入密码确认",s.value="";const l=document.createElement("div");l.className="b3-label__text",l.style.fontSize="12px",l.style.color="#999",l.textContent="两次输入的密码必须一致";const u=document.createElement("div");u.className="b3-label__text",u.style.fontSize="12px",u.style.minHeight="16px";const g=()=>{const p=o.value,c=s.value;return!p&&!c?(u.textContent="",u.style.color="#999",!0):p!==c?(u.textContent="❌ 两次输入的密码不一致",u.style.color="#d23f31",!1):(p.length>0&&(u.textContent="✅ 密码确认一致",u.style.color="#4caf50"),!0)};o.addEventListener("input",g),s.addEventListener("input",g);const d=p=>{p.key==="Enter"&&(p.preventDefault(),p.stopImmediatePropagation())};return o.addEventListener("keydown",d),s.addEventListener("keydown",d),i.appendChild(o),i.appendChild(s),i.appendChild(l),i.appendChild(u),i.passwordInput1=o,i.passwordInput2=s,i.validatePasswords=g,i},getEleVal:n=>{if(n.isReadonly)return n.currentPassword||"";const i=n.passwordInput1,r=n.passwordInput2;if(!i||!r)return"";const o=i.value,s=r.value;return o!==s?"":o},setEleVal:(n,i)=>{if(n.isReadonly)return;const r=n.passwordInput1,o=n.passwordInput2;r&&o&&(r.value=i||"",o.value=i||"",n.validatePasswords&&n.validatePasswords())},action:{callback:async()=>{const n=this.settingUtils.get("encryptPassword");if(n&&n.length>0){K.showMessage("密码已设置且不可修改，以保护已加密文件的安全性",3e3,"error");return}let i=await this.settingUtils.takeAndSave("encryptPassword");i&&i.length>0?K.showMessage("加密密码设置成功！请妥善保管，密码丢失将无法恢复加密文件。请重新打开设置面板查看。",5e3,"info"):K.showMessage("密码验证失败，请确保两次输入的密码一致",3e3,"error")}}});try{this.settingUtils.load()}catch{}this.setupCryptProtocolHandler(),this.protyleSlash=[{filter:["insert emoji 😊","插入表情 😊","crbqwx"],html:`<div class="b3-list-item__first"><span class="b3-list-item__text">${this.i18n.insertEmoji}</span><span class="b3-list-item__meta">😊</span></div>`,id:"insertEmoji",callback(n){n.insert("😊")}}],this.protyleOptions={toolbar:["block-ref","a","|","text","strong","em","u","s","mark","sup","sub","clear","|","code","kbd","tag","inline-math","inline-memo","|",{name:"insert-smail-emoji",icon:"iconEmoji",hotkey:"⇧⌘I",tipPosition:"n",tip:this.i18n.insertEmoji,click(n){n.insert("😊")}}]}}async getActivationStatus(){try{const e=await this.decryptActivationData("license_activation_data");if(!e)return{isActivated:!1,reason:"未找到激活数据"};if(!e.isActivated)return{isActivated:!1,reason:"未激活"};const n=new Date(e.expiredDate);return new Date>n?{isActivated:!1,reason:"激活已过期"}:{isActivated:!0,data:e}}catch(e){return console.error("获取激活状态失败:",e),{isActivated:!1,reason:"激活数据异常"}}}async initializeDockInterface(e){const n=await this.getActivationStatus();if(!n.isActivated){n.reason==="激活已过期"?e.element.innerHTML=`<div class="fn__flex-1 fn__flex-column" style="padding: 16px; text-align: center;">
                            <div style="margin-bottom: 16px;">
                                <svg style="width: 48px; height: 48px; color: #ff9800;"><use xlink:href="#iconTime"></use></svg>
                            </div>
                            <h3 style="margin-bottom: 8px; color: #333;">许可证已过期</h3>
                            <p style="margin-bottom: 16px; color: #666; font-size: 14px;">您的许可证已过期，无法继续使用加密文件管理器功能</p>
                            <div style="display: flex; gap: 8px; justify-content: center;">
                                <a href="https://shop.hugeshop.cyou/" target="_blank" class="b3-button b3-button--outline" style="text-decoration: none; display: inline-block;">前往续费</a>
                                <button class="b3-button b3-button--outline" onclick="this.closest('.sy__siyuan-plugin-crypt-filefile-manager-dock').dispatchEvent(new CustomEvent('openSettings'))">插件设置</button>
                            </div>
                        </div>`:e.element.innerHTML=`<div class="fn__flex-1 fn__flex-column" style="padding: 16px; text-align: center;">
                            <div style="margin-bottom: 16px;">
                                <svg style="width: 48px; height: 48px; color: #f44336;"><use xlink:href="#iconLock"></use></svg>
                            </div>
                            <h3 style="margin-bottom: 8px; color: #333;">插件未激活</h3>
                            <p style="margin-bottom: 16px; color: #666; font-size: 14px;">请先在插件设置中激活后使用</p>
                            <div style="display: flex; gap: 8px; justify-content: center;">
                                <a href="https://shop.hugeshop.cyou/" target="_blank" class="b3-button b3-button--outline" style="text-decoration: none; display: inline-block;">前往购买</a>
                                <button class="b3-button b3-button--outline" onclick="this.closest('.sy__siyuan-plugin-crypt-filefile-manager-dock').dispatchEvent(new CustomEvent('openSettings'))">插件设置</button>
                            </div>
                        </div>`;const o=()=>{this.openSetting()};e.element.addEventListener("openSettings",o);return}const i=localStorage.getItem("license_data");if(i)try{const o=JSON.parse(i),s=new Date(o.expired_date),l=new Date;if(o.is_expired||l>s){e.element.innerHTML=`<div class="fn__flex-1 fn__flex-column" style="padding: 16px; text-align: center;">
                            <div style="margin-bottom: 16px;">
                                <svg style="width: 48px; height: 48px; color: #ff9800;"><use xlink:href="#iconTime"></use></svg>
                            </div>
                            <h3 style="margin-bottom: 8px; color: #333;">许可证已过期</h3>
                            <p style="margin-bottom: 8px; color: #666; font-size: 14px;">到期时间: ${o.expired_date}</p>
                            <p style="margin-bottom: 16px; color: #666; font-size: 14px;">请续费后继续使用</p>
                            <a href="https://shop.hugeshop.cyou/" target="_blank" class="b3-button b3-button--outline" style="text-decoration: none; display: inline-block;">前往续费</a>
                        </div>`;return}}catch(o){console.error("解析许可证数据失败:",o)}this.isMobile?e.element.innerHTML=`<div class="toolbar toolbar--border toolbar--dark">
                        <svg class="toolbar__icon"><use xlink:href="#iconCryptFile"></use></svg>
                        <div class="toolbar__text">加密文件管理器</div>
                    </div>
                    <div id="fileManagerContainer" class="fn__flex-1" style="padding: 8px;"></div>`:e.element.innerHTML=`<div class="fn__flex-1 fn__flex-column">
                        <div class="block__icons">
                            <div class="block__logo">
                                <svg class="block__logoicon"><use xlink:href="#iconCryptFile"></use></svg>
                                加密文件管理器
                            </div>
                            <span class="fn__flex-1 fn__space"></span>
                            <span data-type="min" class="block__icon b3-tooltips b3-tooltips__sw" aria-label="最小化"><svg><use xlink:href="#iconMin"></use></svg></span>
                        </div>
                        <div id="fileManagerContainer" class="fn__flex-1" style="padding: 8px;"></div>
                    </div>`;const r=e.element.querySelector("#fileManagerContainer");r&&new Wr({target:r,props:{plugin:e.data.plugin}}),this.isMobile||this.addLicenseStatusToDock(e.element),this.initLicenseCheck()}async initLicenseCheck(){try{await this.checkLicenseStatus()}catch(e){console.error("许可证检查初始化失败:",e)}}async fetchLicenseData(e){try{const n=await fetch("https://shop.hugeshop.cyou/api/carmi-lifecycle/expiration/by-content",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({carmi_content:e})});if(n.ok){const i=await n.json();if(i.success)return i.data;throw console.error("许可证检查失败:",i.message),new Error(i.message||"许可证验证失败")}else throw console.error("许可证检查请求失败:",n.status),new Error("网络连接失败")}catch(n){throw console.error("许可证检查异常:",n),n}}async loadLicenseData(e=!1){try{const n=new Date().toDateString(),i=localStorage.getItem("license_last_check_date"),r=localStorage.getItem("license_data");if(!e&&i===n&&r){this.updateLicenseDisplay();return}const o=await this.decryptActivationData("license_activation_data");if(!o||!o.activationCode){console.warn("未找到激活码，无法检查许可证状态"),this.showLicenseError("未激活");return}const s=await this.fetchLicenseData(o.activationCode);if(s){localStorage.setItem("license_data",JSON.stringify(s)),localStorage.setItem("license_last_check_date",n),this.updateLicenseDisplay(s);const l=document.querySelector(".sy__siyuan-plugin-crypt-filefile-manager-dock");if(l){const u={element:l,data:{plugin:this}};await this.initializeDockInterface(u)}else this.fileManagerDock&&this.fileManagerDock.element&&await this.initializeDockInterface(this.fileManagerDock)}}catch(n){console.error("加载许可证数据失败:",n),this.showLicenseError(n.message||"检查异常")}}async checkLicenseStatus(){await this.loadLicenseData()}addLicenseStatusToDock(e){const n=e.querySelector(".block__icons");if(!n){console.warn("未找到 block__icons 容器");return}const i=document.createElement("span");i.id="license-status",i.style.cssText=`
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            margin-right: 8px;
            transition: all 0.3s ease;
            white-space: nowrap;
            background-color: rgba(108, 117, 125, 0.9);
            color: white;
        `,i.textContent="检查中...";const r=n.querySelector('[data-type="min"]');r?n.insertBefore(i,r):n.appendChild(i)}updateLicenseDisplay(e){if(!e){const u=localStorage.getItem("license_data");if(u)try{e=JSON.parse(u)}catch(g){console.error("解析本地许可证数据失败:",g);return}else return}const n=document.querySelector("#license-status");if(!n){console.warn("未找到许可证状态元素");return}n.onclick=()=>{this.showLicenseDetails(e)};const i=new Date(e.expired_date),r=new Date,o=Math.ceil((i.getTime()-r.getTime())/(1e3*60*60*24)),s=e.is_expired||o<=0,l=e.expired_date||"未知";s?(n.textContent=`到期时间: ${l} 已过期`,n.style.backgroundColor="rgba(220, 53, 69, 0.9)",n.style.color="white"):(n.textContent=`到期时间: ${l} 剩余: ${o} 天`,o<=7?(n.style.backgroundColor="rgba(255, 193, 7, 0.9)",n.style.color="black"):(n.style.backgroundColor="rgba(40, 167, 69, 0.9)",n.style.color="white"))}showLicenseDetails(e){new K.Dialog({title:"📋 许可证信息",content:`
                <div style="padding: 20px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
                    <div style="margin-bottom: 16px;">
                        <strong style="color: var(--b3-theme-primary);">产品名称：</strong>
                        <span>${e.goods_name||"未知"}</span>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <strong style="color: var(--b3-theme-primary);">激活日期：</strong>
                        <span>${e.activation_date||"未知"}</span>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <strong style="color: var(--b3-theme-primary);">到期日期：</strong>
                        <span>${e.expired_date||"未知"}</span>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <strong style="color: var(--b3-theme-primary);">有效期：</strong>
                        <span>${e.duration_months||0} 个月</span>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <strong style="color: var(--b3-theme-primary);">剩余天数：</strong>
                        <span style="color: ${e.is_expired?"#dc3545":e.remaining_days<=7?"#ffc107":"#28a745"};">
                            ${e.remaining_days||0} 天
                        </span>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <strong style="color: var(--b3-theme-primary);">状态：</strong>
                        <span style="color: ${e.is_expired?"#dc3545":"#28a745"};">
                            ${e.status||"未知"}
                        </span>
                    </div>
                    
                    ${e.is_expired?'<div style="margin-top: 20px; padding: 12px; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 4px; color: #721c24;">⚠️ 许可证已过期，请及时续费以继续使用。</div>':e.remaining_days<=7?'<div style="margin-top: 20px; padding: 12px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px; color: #856404;">⚠️ 许可证即将到期，建议提前续费。</div>':'<div style="margin-top: 20px; padding: 12px; background: #d4edda; border: 1px solid #c3e6cb; border-radius: 4px; color: #155724;">✅ 许可证状态正常。</div>'}
                </div>
            `,width:"400px"})}showLicenseError(e){const n=document.querySelector("#license-status");if(!n){console.warn("未找到许可证状态元素");return}n.textContent=e,n.style.backgroundColor="rgba(108, 117, 125, 0.9)",n.style.color="white"}onLayoutReady(){this.settingUtils.load();let e=document.createElement("div");new Zt({target:e,props:{app:this.app}}),this.customTab=this.addTab({type:Kr,init(){this.element.appendChild(e)},beforeDestroy(){},destroy(){}})}setupCryptProtocolHandler(){document.removeEventListener("click",this.cryptLinkClickBindThis,!0),document.removeEventListener("click",this.cryptLinkClickBindThis,!1),document.addEventListener("click",this.cryptLinkClickBindThis,!0)}async handleCryptLinkClick(e){if(e.defaultPrevented)return;const n=e.target;let i=n;for(;i;){if(i.id==="sidebarExpandBtn"||i.id==="downloadBtn"||i.id==="openWithAppBtn"||i.id==="saveChangesBtn"||i.classList.contains("b3-dialog")||i.classList.contains("b3-dialog__container"))return;i=i.parentElement}let r=null,o=n;for(;o&&!r;){if(o.tagName==="SPAN"&&o.getAttribute("data-type")==="a"){const s=o.getAttribute("data-href");if(s&&s.startsWith("crypt://")){r=s;break}}if(o.tagName==="A"){const s=o.href;if(s&&s.startsWith("crypt://")){r=s;break}const l=o.getAttribute("data-href");if(l&&l.startsWith("crypt://")){r=l;break}}o=o.parentElement}if(!r){const l=(n.textContent||"").match(/crypt:\/\/[^\s)\]]+/);l&&(r=l[0])}r&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),setTimeout(()=>{this.handleCryptFile(r)},0))}async handleCryptFile(e){try{const n=decodeURIComponent(e.replace("crypt://","")),{readDir:i,getFileBlob:r}=await Promise.resolve().then(()=>et),o=n.split("/"),s=o.pop(),l=o.join("/");try{const u=await i(l);if(!(Array.isArray(u)?u.some(d=>d.name===s&&!d.isDir):!1)){K.showMessage("文件不存在，可能已被删除",3e3,"error");return}}catch{const g=await r(n);if(!g||g.size===0){K.showMessage("文件不存在，可能已被删除",3e3,"error");return}}await this.previewEncryptedFile(n)}catch{K.showMessage("处理加密文件失败",3e3,"error")}}async promptForPassword(e){return new Promise(n=>{const i=e||"请输入文件解密密码:",r=e&&e.includes("错误"),o=new K.Dialog({title:"🔐 输入加密密码",content:`
                    <div style="padding: 20px;">
                        <div style="margin-bottom: 15px;">
                            <label for="cryptPassword" style="display: block; margin-bottom: 5px; font-weight: bold; color: ${r?"var(--b3-theme-error)":"var(--b3-theme-on-background)"};">${i}</label>
                            <input type="password" id="cryptPassword" placeholder="请输入密码" 
                                   style="width: 100%; padding: 8px; border: 1px solid ${r?"var(--b3-theme-error)":"var(--b3-border-color)"}; border-radius: 4px;" />
                        </div>
                        <div style="text-align: right; margin-top: 20px;">
                            <button id="cancelBtn" style="margin-right: 10px; padding: 6px 12px; border: 1px solid var(--b3-border-color); background: var(--b3-theme-background); border-radius: 4px;">取消</button>
                            <button id="confirmBtn" style="padding: 6px 12px; background: var(--b3-theme-primary); color: white; border: none; border-radius: 4px;">确认</button>
                        </div>
                    </div>
                `,width:"400px",destroyCallback:()=>{n(null)}}),s=o.element.querySelector("#cryptPassword"),l=o.element.querySelector("#confirmBtn"),u=o.element.querySelector("#cancelBtn");setTimeout(()=>s==null?void 0:s.focus(),100),l==null||l.addEventListener("click",()=>{var d;const g=(d=s==null?void 0:s.value)==null?void 0:d.trim();g?(o.destroy(),n(g)):(K.showMessage("请输入密码",2e3,"error"),s==null||s.focus())}),u==null||u.addEventListener("click",()=>{o.destroy(),n(null)}),s==null||s.addEventListener("keypress",g=>{g.key==="Enter"&&(l==null||l.click())})})}async previewEncryptedFile(e,n,i=0){var o,s,l;if(!n){const u=i>0?"密码错误，请重新输入：":"请输入文件解密密码：";if(n=await this.promptForPassword(u),!n)return}try{const{FileManager:u}=await Promise.resolve().then(()=>At),{CryptoUtils:g}=await Promise.resolve().then(()=>Xe),p=await new u(this).copyToPreviewAndDecrypt(e,n);if(!p||!p.data)throw new Error("解密失败：无法获取文件数据");let c=p.originalName;(!c||typeof c!="string"||c.trim()==="")&&(c=this.extractOriginalFileName(e)),(!c||typeof c!="string"||c.trim()==="")&&(c="unknown_file.txt"),await this.showFilePreview(c,p.data,e)}catch(u){if((o=u.message)!=null&&o.includes("文件不存在")){K.showMessage("文件不存在，可能已被删除",3e3,"error");return}if(((s=u.message)!=null&&s.includes("密码")||(l=u.message)!=null&&l.includes("password")||u.name==="OperationError")&&i<3)return this.previewEncryptedFile(e,void 0,i+1);i>=3?K.showMessage("密码错误次数过多，请检查密码是否正确",3e3,"error"):K.showMessage(`文件预览失败: ${u.message||u}`,3e3,"error")}}extractOriginalFileName(e){if(!e||typeof e!="string")return"unknown_file.txt";const n=e.split("/").pop()||"unknown",i=n.match(/^(.+)-\d+\.-[a-f0-9]+\.(\w+)$/);return i&&i[1]&&i[2]?`${i[1]}.${i[2]}`||"unknown_file.txt":n||"unknown_file.txt"}async showFilePreview(e,n,i){if(!e||typeof e!="string"){K.showMessage("无效的文件名",3e3,"error");return}if(!n||!(n instanceof ArrayBuffer)){K.showMessage("无效的文件数据",3e3,"error");return}const{CryptoUtils:r}=await Promise.resolve().then(()=>Xe);r.isEditableFile(e)?this.showTextFilePreview(e,n):this.isImageFile(e)?this.showImagePreview(e,n):this.isAudioFile(e)?this.showAudioPreview(e,n):this.isVideoFile(e)?this.showVideoPreview(e,n):this.isPdfFile(e)?this.showPdfPreview(e,n):this.isOfficeFile(e)?this.showOfficePreview(e,n,i):this.isEpubFile(e)?this.showEpubPreview(e,n):this.downloadFile(e,n)}showTextFilePreview(e,n){if(!e||typeof e!="string"){K.showMessage("无效的文件名",3e3,"error");return}if(!n||!(n instanceof ArrayBuffer)){K.showMessage("无效的文件数据",3e3,"error");return}const i=new TextDecoder().decode(n),r=new K.Dialog({title:`📝 ${e}`,content:`
                <div style="padding: 20px; height: 500px; display: flex; flex-direction: column;">
                    <textarea id="textContent" 
                              style="flex: 1; width: 100%; border: 1px solid var(--b3-border-color); 
                                     border-radius: 4px; padding: 10px; font-family: monospace; 
                                     resize: none; outline: none;">${i}</textarea>
                    <div style="text-align: right; margin-top: 15px;">
                        <button id="sidebarExpandBtn" style="padding: 6px 12px; background: #17a2b8; 
                                                             color: white; border: none; border-radius: 4px; margin-right: 10px;">侧边展开</button>
                        <button id="saveBtn" style="padding: 6px 12px; background: var(--b3-theme-primary); 
                                                   color: white; border: none; border-radius: 4px; margin-right: 10px;">保存</button>
                        <button id="downloadBtn" style="padding: 6px 12px; border: 1px solid var(--b3-border-color); 
                                                       background: var(--b3-theme-background); border-radius: 4px;">下载</button>
                    </div>
                </div>
            `,width:"800px",height:"600px"}),o=r.element.querySelector("#textContent"),s=r.element.querySelector("#sidebarExpandBtn"),l=r.element.querySelector("#saveBtn"),u=r.element.querySelector("#downloadBtn");s==null||s.addEventListener("click",()=>{this.expandToSidebar(e,new TextEncoder().encode(o.value).buffer),r.destroy()}),l==null||l.addEventListener("click",async()=>{await this.saveModifiedTextFile(e,o.value,r)}),u==null||u.addEventListener("click",()=>{this.downloadFile(e,new TextEncoder().encode(o.value).buffer)})}showImagePreview(e,n){if(!e||typeof e!="string"){K.showMessage("无效的文件名",3e3,"error");return}if(!n||!(n instanceof ArrayBuffer)){K.showMessage("无效的文件数据",3e3,"error");return}const i=new Blob([n]),r=URL.createObjectURL(i),o=new K.Dialog({title:`🖼️ ${e}`,content:`
                <div style="padding: 20px; text-align: center;">
                    <img src="${r}" style="max-width: 100%; max-height: 500px; border-radius: 4px;" />
                    <div style="margin-top: 15px;">
                        <button id="sidebarExpandBtn" style="padding: 6px 12px; background: #17a2b8; 
                                                             color: white; border: none; border-radius: 4px; margin-right: 10px;">侧边展开</button>
                        <button id="downloadBtn" style="padding: 6px 12px; border: 1px solid var(--b3-border-color); 
                                                       background: var(--b3-theme-background); border-radius: 4px;">下载图片</button>
                    </div>
                </div>
            `,width:"auto",destroyCallback:()=>{URL.revokeObjectURL(r)}}),s=o.element.querySelector("#sidebarExpandBtn"),l=o.element.querySelector("#downloadBtn");s==null||s.addEventListener("click",()=>{this.expandToSidebar(e,n),o.destroy()}),l==null||l.addEventListener("click",()=>{this.downloadFile(e,n)})}showPdfPreview(e,n){if(!e||typeof e!="string"){K.showMessage("无效的文件名",3e3,"error");return}if(!n||!(n instanceof ArrayBuffer)){K.showMessage("无效的文件数据",3e3,"error");return}const i=new Blob([n],{type:"application/pdf"}),r=URL.createObjectURL(i),o=new K.Dialog({title:`📄 ${e}`,content:`
                <div style="padding: 20px; height: 500px; display: flex; flex-direction: column;">
                    <iframe src="${r}" style="flex: 1; border: 1px solid var(--b3-border-color); border-radius: 4px;"></iframe>
                    <div style="text-align: right; margin-top: 15px;">
                        <button id="sidebarExpandBtn" style="padding: 6px 12px; background: #17a2b8; 
                                                             color: white; border: none; border-radius: 4px; margin-right: 10px;">侧边展开</button>
                        <button id="downloadBtn" style="padding: 6px 12px; border: 1px solid var(--b3-border-color); 
                                                       background: var(--b3-theme-background); border-radius: 4px;">下载 PDF</button>
                    </div>
                </div>
            `,width:"800px",height:"600px",destroyCallback:()=>{URL.revokeObjectURL(r)}}),s=o.element.querySelector("#sidebarExpandBtn"),l=o.element.querySelector("#downloadBtn");s==null||s.addEventListener("click",()=>{this.expandToSidebar(e,n),o.destroy()}),l==null||l.addEventListener("click",()=>{this.downloadFile(e,n)})}showAudioPreview(e,n){if(!e||typeof e!="string"){K.showMessage("无效的文件名",3e3,"error");return}if(!n||!(n instanceof ArrayBuffer)){K.showMessage("无效的文件数据",3e3,"error");return}const i=new Blob([n]),r=URL.createObjectURL(i),o=new K.Dialog({title:`🎵 ${e}`,content:`
                <div style="padding: 20px; text-align: center;">
                    <div style="margin-bottom: 20px;">
                        <audio controls style="width: 100%; max-width: 400px;">
                            <source src="${r}" type="${this.getAudioMimeType(e)}">
                            您的浏览器不支持音频播放。
                        </audio>
                    </div>
                    <div>
                        <button id="sidebarExpandBtn" style="padding: 6px 12px; background: #17a2b8; 
                                                             color: white; border: none; border-radius: 4px; margin-right: 10px;">侧边展开</button>
                        <button id="downloadBtn" style="padding: 6px 12px; border: 1px solid var(--b3-border-color); 
                                                       background: var(--b3-theme-background); border-radius: 4px;">下载音频</button>
                    </div>
                </div>
            `,width:"500px",destroyCallback:()=>{URL.revokeObjectURL(r)}}),s=o.element.querySelector("#sidebarExpandBtn"),l=o.element.querySelector("#downloadBtn");s==null||s.addEventListener("click",()=>{this.expandToSidebar(e,n),o.destroy()}),l==null||l.addEventListener("click",()=>{this.downloadFile(e,n)})}showVideoPreview(e,n){if(!e||typeof e!="string"){K.showMessage("无效的文件名",3e3,"error");return}if(!n||!(n instanceof ArrayBuffer)){K.showMessage("无效的文件数据",3e3,"error");return}const i=new Blob([n]),r=URL.createObjectURL(i),o=new K.Dialog({title:`🎬 ${e}`,content:`
                <div style="padding: 20px; text-align: center;">
                    <div style="margin-bottom: 20px;">
                        <video controls style="max-width: 100%; max-height: 400px;">
                            <source src="${r}" type="${this.getVideoMimeType(e)}">
                            您的浏览器不支持视频播放。
                        </video>
                    </div>
                    <div>
                        <button id="sidebarExpandBtn" style="padding: 6px 12px; background: #17a2b8; 
                                                             color: white; border: none; border-radius: 4px; margin-right: 10px;">侧边展开</button>
                        <button id="downloadBtn" style="padding: 6px 12px; border: 1px solid var(--b3-border-color); 
                                                       background: var(--b3-theme-background); border-radius: 4px;">下载视频</button>
                    </div>
                </div>
            `,width:"700px",destroyCallback:()=>{URL.revokeObjectURL(r)}}),s=o.element.querySelector("#sidebarExpandBtn"),l=o.element.querySelector("#downloadBtn");s==null||s.addEventListener("click",()=>{this.expandToSidebar(e,n),o.destroy()}),l==null||l.addEventListener("click",()=>{this.downloadFile(e,n)})}showOfficePreview(e,n,i){if(!e||typeof e!="string"){K.showMessage("无效的文件名",3e3,"error");return}if(!n||!(n instanceof ArrayBuffer)){K.showMessage("无效的文件数据",3e3,"error");return}const r=new Blob([n]),o=URL.createObjectURL(r);this.openWithNativeApp(e,n);const s=new K.Dialog({title:`📄 ${e}`,content:`
                <div style="padding: 20px; text-align: center;">
                    <div style="margin-bottom: 20px;">
                        <p style="font-size: 16px; margin-bottom: 15px;">正在使用系统默认应用打开文件...</p>
                        <p style="color: var(--b3-theme-on-surface-variant);">如果文件没有自动打开，请使用下方的备用选项</p>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <button id="openWithAppBtn" style="padding: 8px 16px; background: #28a745; 
                                                             color: white; border: none; border-radius: 4px; margin-right: 10px;">📱 重新尝试打开</button>
                        <button id="sidebarExpandBtn" style="padding: 8px 16px; background: #17a2b8; 
                                                             color: white; border: none; border-radius: 4px; margin-right: 10px;">侧边展开</button>
                        <button id="downloadBtn" style="padding: 8px 16px; border: 1px solid var(--b3-border-color); 
                                                       background: var(--b3-theme-background); border-radius: 4px; margin-right: 10px;">💾 下载文件</button>
                        <button id="saveChangesBtn" style="padding: 8px 16px; background: #007bff; 
                                                         color: white; border: none; border-radius: 4px;">💾 修改保存</button>
                    </div>
                </div>
            `,width:"500px",destroyCallback:()=>{URL.revokeObjectURL(o)}}),l=s.element.querySelector("#openWithAppBtn"),u=s.element.querySelector("#sidebarExpandBtn"),g=s.element.querySelector("#downloadBtn"),d=s.element.querySelector("#saveChangesBtn");l==null||l.addEventListener("click",()=>{this.openWithNativeApp(e,n)}),u==null||u.addEventListener("click",()=>{this.expandToSidebar(e,n),s.destroy()}),g==null||g.addEventListener("click",()=>{this.downloadFile(e,n)}),d==null||d.addEventListener("click",async()=>{await this.saveModifiedFile(e,i),s.destroy()})}async saveModifiedFile(e,n){if(!n){K.showMessage("无法确定原始文件路径，无法保存修改",3e3,"error");return}try{K.showMessage("正在保存修改的文件...",2e3,"info");const{FileManager:i}=await Promise.resolve().then(()=>At),{CryptoUtils:r}=await Promise.resolve().then(()=>Xe),{getFileBlob:o,putFile:s}=await Promise.resolve().then(()=>et),l=new i(this),u=r.extractOriginalName(e);if(!await new Promise(w=>{const C=new K.Dialog({title:"💾 保存修改提示",content:`
                        <div style="padding: 20px;">
                            <p style="margin-bottom: 15px;">请确保您已在外部应用中保存了对文件的修改。</p>
                            <p style="margin-bottom: 15px; color: #666;">系统将读取您修改后的文件并重新加密保存。</p>
                            <div style="text-align: right;">
                                <button id="cancelSaveBtn" style="padding: 6px 12px; margin-right: 10px; border: 1px solid var(--b3-border-color); 
                                                         background: var(--b3-theme-background); border-radius: 4px; cursor: pointer;">取消</button>
                                <button id="confirmSaveBtn" style="padding: 6px 12px; background: var(--b3-theme-primary); 
                                                          color: white; border: none; border-radius: 4px; cursor: pointer;">确认保存</button>
                            </div>
                        </div>
                    `,width:"400px",height:"200px"}),D=C.element.querySelector("#confirmSaveBtn"),x=C.element.querySelector("#cancelSaveBtn");D==null||D.addEventListener("click",()=>{C.destroy(),w(!0)}),x==null||x.addEventListener("click",()=>{C.destroy(),w(!1)})})){K.showMessage("用户取消保存操作",2e3,"info");return}const d=`data/assets/crypt/preview/${u}`,p=await o(d);if(!p){K.showMessage("无法读取修改后的文件，请确保文件已在外部应用中保存",3e3,"error");return}const c=await this.getEncryptionPassword("请输入密码以保存修改的文件:");if(!c){K.showMessage("未输入密码，取消保存",2e3,"info");return}const b=`data/assets/crypt/crypted/${e}`,m=await p.arrayBuffer(),v=await r.encryptData(m,c),y=new Blob([v]);await s(b,!1,y),K.showMessage(`文件 ${u} 修改已保存`,3e3,"info")}catch(i){K.showMessage(`保存失败: ${i.message||i}`,3e3,"error")}}async saveModifiedTextFile(e,n,i){try{K.showMessage("正在保存修改的文本文件...",2e3,"info");const{FileManager:r}=await Promise.resolve().then(()=>At),{CryptoUtils:o}=await Promise.resolve().then(()=>Xe),{putFile:s,getFileBlob:l}=await Promise.resolve().then(()=>et),u=new r(this),g=o.extractOriginalName(e),d=await this.getEncryptionPassword("请输入密码以保存修改的文本文件:");if(!d){K.showMessage("未输入密码，取消保存",2e3,"info");return}const p=`data/assets/crypt/crypted/${e}`;try{await l(p)}catch{throw new Error("原始加密文件不存在，无法保存修改")}const c=new TextEncoder().encode(n).buffer,b=await o.encryptData(c,d),m=new Blob([b]);await s(p,!1,m),K.showMessage(`文本文件 ${g} 修改已保存`,3e3,"info"),i.destroy()}catch(r){K.showMessage(`保存失败: ${r.message||r}`,3e3,"error")}}async getEncryptionPassword(e="请输入加密密码:"){return new Promise(n=>{const i=new K.Dialog({title:"🔐 输入密码",content:`
                    <div style="padding: 20px;">
                        <p style="margin-bottom: 15px;">${e}</p>
                        <input type="password" id="passwordInput" placeholder="请输入密码" 
                               style="width: 100%; padding: 8px; border: 1px solid var(--b3-border-color); border-radius: 4px; margin-bottom: 20px;" />
                        <div style="text-align: right;">
                            <button id="cancelBtn" style="padding: 6px 12px; margin-right: 10px; border: 1px solid var(--b3-border-color); 
                                                     background: var(--b3-theme-background); border-radius: 4px; cursor: pointer;">取消</button>
                            <button id="confirmBtn" style="padding: 6px 12px; background: var(--b3-theme-primary); 
                                                      color: white; border: none; border-radius: 4px; cursor: pointer;">确认</button>
                        </div>
                    </div>
                `,width:"400px",height:"200px"}),r=i.element.querySelector("#passwordInput"),o=i.element.querySelector("#confirmBtn"),s=i.element.querySelector("#cancelBtn");o==null||o.addEventListener("click",()=>{const l=r.value.trim();l?(i.destroy(),n(l)):K.showMessage("密码不能为空",2e3,"error")}),s==null||s.addEventListener("click",()=>{i.destroy(),n(null)}),r==null||r.addEventListener("keypress",l=>{l.key==="Enter"&&(o==null||o.click())}),setTimeout(()=>{r==null||r.focus()},100)})}async openWithNativeApp(e,n){try{const{CryptoUtils:i}=await Promise.resolve().then(()=>Xe),r=i.extractOriginalName(e);if(typeof window<"u"&&window.require)try{const{shell:o}=window.require("electron"),s=window.require("path"),{app:l}=window.require("@electron/remote")||window.require("electron").remote,{getConf:u}=await Promise.resolve().then(()=>et),g=await u();let d;g.system&&g.system.workspaceDir?d=g.system.workspaceDir:g.conf&&g.conf.system&&g.conf.system.workspaceDir?d=g.conf.system.workspaceDir:g.workspaceDir?d=g.workspaceDir:d=process.cwd();const p=s.join(d,"data","assets","crypt","preview",r),c=await o.openPath(p);c===""?K.showMessage(`文件 ${r} 已使用系统默认应用打开，修改后请点击"修改保存"按钮`,4e3,"info"):(K.showMessage(`打开文件失败: ${c}`,3e3,"error"),this.fallbackToDownload(r,n))}catch{K.showMessage("无法访问系统应用，将使用下载方案",3e3,"info"),this.fallbackToDownload(r,n)}else this.fallbackToDownload(r,n)}catch(i){K.showMessage(`打开文件失败: ${i.message}`,3e3,"error");try{const{CryptoUtils:r}=await Promise.resolve().then(()=>Xe),o=r.extractOriginalName(e);this.fallbackToDownload(o,n)}catch{this.fallbackToDownload(e,n)}}}fallbackToDownload(e,n){const i=new Blob([n]),r=URL.createObjectURL(i),o=document.createElement("a");o.href=r,o.download=e;const s=e.toLowerCase().split(".").pop();if(s){const l={doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation"};if(l[s]){const u=new Blob([n],{type:l[s]}),g=URL.createObjectURL(u);o.href=g,URL.revokeObjectURL(r)}}document.body.appendChild(o),o.click(),document.body.removeChild(o),setTimeout(()=>URL.revokeObjectURL(o.href),1e3),K.showMessage(`文件 ${e} 已下载，请在下载文件夹中找到并双击打开`,5e3,"info"),new K.Dialog({title:"📱 本机应用打开指南",content:`
                <div style="padding: 20px; text-align: center;">
                    <div style="margin-bottom: 20px;">
                        <p style="font-size: 16px; margin-bottom: 15px;">✅ 文件已下载到您的下载文件夹</p>
                        <p style="color: var(--b3-theme-on-surface-variant);">文件名：${e}</p>
                    </div>
                    
                    <div style="background: var(--b3-theme-background-light); padding: 15px; border-radius: 6px; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 10px 0;">📋 接下来的操作：</h4>
                        <ol style="text-align: left; margin: 0; padding-left: 20px; line-height: 1.6;">
                            <li>打开您的下载文件夹</li>
                            <li>找到文件：<strong>${e}</strong></li>
                            <li>双击文件，系统会自动选择合适的应用打开</li>
                            <li>如果有多个应用可选，建议选择 WPS Office 或 Microsoft Office</li>
                        </ol>
                    </div>
                    
                    <div style="background: #d1ecf1; border: 1px solid #bee5eb; border-radius: 4px; padding: 15px;">
                        <h4 style="margin: 0 0 10px 0; color: #0c5460;">💡 提示</h4>
                        <p style="margin: 0; font-size: 13px; color: #0c5460;">
                            如果系统没有自动打开，请右键点击文件选择"打开方式"，
                            然后选择 WPS Office、Microsoft Office 或其他 Office 软件。
                        </p>
                    </div>
                        
                    <button onclick="this.closest('.b3-dialog').remove()" 
                            style="margin-top: 20px; padding: 8px 20px; background: var(--b3-theme-primary); 
                                   color: white; border: none; border-radius: 4px; cursor: pointer;">我知道了</button>
                </div>
            `,width:"500px"})}showUploadSolutionDialog(){new K.Dialog({title:"💡 实现在线预览的解决方案",content:`
                <div style="padding: 20px; max-height: 500px; overflow-y: auto;">
                    <h3 style="margin-top: 0; color: var(--b3-theme-primary);">为什么需要上传到云存储？</h3>
                    <p style="margin-bottom: 15px; line-height: 1.6;">由于浏览器的同源策略和安全限制，Microsoft Office Online 和 Google Docs Viewer 等在线预览服务无法直接访问本地的 blob URL。</p>
                    
                    <h3 style="color: var(--b3-theme-primary);">推荐的实现方案：</h3>
                    <div style="background: var(--b3-theme-background-light); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="margin: 0 0 10px 0;">1. 云存储服务集成</h4>
                        <ul style="margin: 0; padding-left: 20px; line-height: 1.6;">
                            <li>阿里云 OSS / 腾讯云 COS / AWS S3</li>
                            <li>上传解密后的文件到云存储</li>
                            <li>获取公网可访问的URL</li>
                            <li>使用该URL进行在线预览</li>
                        </ul>
                    </div>
                    
                    <div style="background: var(--b3-theme-background-light); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="margin: 0 0 10px 0;">2. 临时文件服务</h4>
                        <ul style="margin: 0; padding-left: 20px; line-height: 1.6;">
                            <li>搭建临时文件上传接口</li>
                            <li>设置文件自动过期删除</li>
                            <li>确保数据安全和隐私保护</li>
                        </ul>
                    </div>
                    
                    <div style="background: var(--b3-theme-background-light); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="margin: 0 0 10px 0;">3. 本地服务器方案</h4>
                        <ul style="margin: 0; padding-left: 20px; line-height: 1.6;">
                            <li>启动本地HTTP服务器</li>
                            <li>提供文件访问接口</li>
                            <li>配置CORS允许外部访问</li>
                        </ul>
                    </div>
                    
                    <h3 style="color: var(--b3-theme-primary);">示例代码：</h3>
                    <pre style="background: var(--b3-theme-surface); padding: 15px; border-radius: 6px; overflow-x: auto; font-size: 12px;"><code>// 上传到云存储示例
async uploadToCloudStorage(file: ArrayBuffer, fileName: string) {
    const formData = new FormData();
    formData.append('file', new Blob([file]), fileName);
    
    const response = await fetch('/api/upload', {
        method: 'POST',
        body: formData
    });
    
    const result = await response.json();
    return result.publicUrl; // 返回公网URL
}

// 使用公网URL进行预览
const publicUrl = await this.uploadToCloudStorage(data, fileName);
const previewUrl = \`https://view.officeapps.live.com/op/embed.aspx?src=\${encodeURIComponent(publicUrl)}\`;</code></pre>
                    
                    <div style="background: #d1ecf1; border: 1px solid #bee5eb; border-radius: 4px; padding: 15px; margin-top: 15px;">
                        <h4 style="margin: 0 0 10px 0; color: #0c5460;">💡 安全提示</h4>
                        <p style="margin: 0; font-size: 13px; color: #0c5460;">上传敏感文件时，请确保：</p>
                        <ul style="margin: 5px 0 0 0; padding-left: 20px; font-size: 13px; color: #0c5460;">
                            <li>使用HTTPS加密传输</li>
                            <li>设置文件访问权限和过期时间</li>
                            <li>考虑文件内容的敏感性</li>
                        </ul>
                    </div>
                </div>
            `,width:"700px",height:"600px"})}showPreviewFrame(e,n,i,r){e.src=i,e.style.display="block",n.style.display="none";const o=setTimeout(()=>{n.innerHTML=`
                <div style="text-align: center;">
                    <p style="color: var(--b3-theme-error);">⚠️ ${r} 预览加载超时</p>
                    <p style="font-size: 12px; margin-top: 10px;">可能的原因：</p>
                    <ul style="font-size: 12px; text-align: left; margin: 10px 0;">
                        <li>文件需要上传到公网服务器才能预览</li>
                        <li>网络连接问题</li>
                        <li>文件格式不被支持</li>
                    </ul>
                    <p style="font-size: 12px;">建议下载文件后使用专业软件打开</p>
                </div>
            `,n.style.display="flex",e.style.display="none"},1e4);e.onload=()=>{clearTimeout(o)},e.onerror=()=>{clearTimeout(o),n.innerHTML=`
                <div style="text-align: center;">
                    <p style="color: var(--b3-theme-error);">❌ ${r} 预览失败</p>
                    <p style="font-size: 12px; margin-top: 10px;">请尝试其他预览方式或下载文件</p>
                </div>
            `,n.style.display="flex",e.style.display="none"}}expandToSidebar(e,n){if(!e||typeof e!="string"){K.showMessage("无效的文件名",3e3,"error");return}if(!n||!(n instanceof ArrayBuffer)){K.showMessage("无效的文件数据",3e3,"error");return}this.openFileManager(),this.getFileType(e);const i=new CustomEvent("expandFilePreview",{detail:{name:e,data:n}});document.dispatchEvent(i)}getFileType(e){var n;if(!e||typeof e!="string")return"unknown";try{const i=((n=e.split(".").pop())==null?void 0:n.toLowerCase())||"";return this.getFileTypeByExtension(i)}catch{return"unknown"}}getFileTypeByExtension(e){return["txt","md","json","xml","html","css","js","ts"].includes(e)?"text":["jpg","jpeg","png","gif","bmp","webp"].includes(e)?"image":["mp3","wav","ogg","aac"].includes(e)?"audio":["mp4","avi","mov","wmv"].includes(e)?"video":e==="pdf"?"pdf":e==="epub"?"epub":["doc","docx","xls","xlsx","ppt","pptx"].includes(e)?"office":"unknown"}showEpubPreview(e,n){if(!e||typeof e!="string"){K.showMessage("无效的文件名",3e3,"error");return}if(!n||!(n instanceof ArrayBuffer)){K.showMessage("无效的文件数据",3e3,"error");return}const i=new Blob([n]),r=URL.createObjectURL(i),o=new K.Dialog({title:`📚 ${e}`,content:`
                <div style="padding: 20px; height: 100px; display: flex; flex-direction: column;">
                    <div style="margin-bottom: 15px; text-align: center;">
                        <button id="sidebarExpandBtn" style="padding: 8px 16px; background: #17a2b8; 
                                                             color: white; border: none; border-radius: 4px; margin-right: 10px;">侧边展开</button>
                        <button id="downloadBtn" style="padding: 8px 16px; border: 1px solid var(--b3-border-color); 
                                                       background: var(--b3-theme-background); border-radius: 4px;">下载 EPUB</button>
                    </div>
                </div>
            `,width:"900px",height:"700px",destroyCallback:()=>{URL.revokeObjectURL(r)}}),s=o.element.querySelector("#downloadBtn"),l=o.element.querySelector("#sidebarExpandBtn");o.element.querySelector("#epubContent"),o.element.querySelector("#epubPlaceholder"),o.element.querySelector("#epubControls"),o.element.querySelector("#prevBtn"),o.element.querySelector("#nextBtn"),o.element.querySelector("#pageInfo"),s==null||s.addEventListener("click",()=>{this.downloadFile(e,n)}),l==null||l.addEventListener("click",()=>{this.expandToSidebar(e,n),o.destroy()})}async loadEpubReader(e,n,i,r,o,s,l){try{i.innerHTML=`
                <div style="text-align: center;">
                    <p>📖 正在加载 EPUB 文件...</p>
                    <div style="margin-top: 10px;">
                        <div style="width: 200px; height: 4px; background: var(--b3-border-color); border-radius: 2px; margin: 0 auto; overflow: hidden;">
                            <div style="width: 30%; height: 100%; background: var(--b3-theme-primary); border-radius: 2px; animation: loading 1.5s infinite;"></div>
                        </div>
                    </div>
                </div>
                <style>
                    @keyframes loading {
                        0% { transform: translateX(-100%); }
                        100% { transform: translateX(400%); }
                    }
                </style>
            `;const g=await(await fetch(e)).arrayBuffer(),p=await new mn().loadAsync(g),c=await this.parseEpubStructure(p);await this.displayEpubChapter(c,0,n,i,r,o,s,l)}catch(u){throw i.innerHTML=`
                <div style="text-align: center; color: var(--b3-theme-error);">
                    <p>❌ 加载 EPUB 文件失败</p>
                    <p style="font-size: 12px; margin-top: 10px;">请尝试下载文件后使用专业阅读器打开</p>
                </div>
            `,u}}async parseEpubStructure(e){var y,w,C,D;const n=await((y=e.file("META-INF/container.xml"))==null?void 0:y.async("text"));if(!n)throw new Error("无效的 EPUB 文件：缺少 container.xml");const i=new DOMParser,o=(w=i.parseFromString(n,"text/xml").querySelector("rootfile"))==null?void 0:w.getAttribute("full-path");if(!o)throw new Error("无法找到 OPF 文件路径");const s=await((C=e.file(o))==null?void 0:C.async("text"));if(!s)throw new Error("无法读取 OPF 文件");const l=i.parseFromString(s,"text/xml"),u=l.querySelectorAll("manifest item"),g=l.querySelectorAll("spine itemref"),d=new Map;u.forEach(x=>{const B=x.getAttribute("id"),S=x.getAttribute("href");B&&S&&d.set(B,S)});let p=null;const c=l.querySelector('meta[name="cover"]');if(c){const x=c.getAttribute("content");x&&d.has(x)&&(p=d.get(x))}if(!p){const x=l.querySelector('manifest item[properties*="cover-image"]');x&&(p=x.getAttribute("href"))}if(!p)for(const x of u){const B=(D=x.getAttribute("id"))==null?void 0:D.toLowerCase(),S=x.getAttribute("media-type");if(B&&S&&S.startsWith("image/")&&(B.includes("cover")||B.includes("front"))){p=x.getAttribute("href");break}}const b=[],m=o.substring(0,o.lastIndexOf("/")+1);if(p){const x=m+p;b.push({id:"cover",path:"cover",title:"封面",coverImagePath:x,isCover:!0})}let v=1;for(const x of g){const B=x.getAttribute("idref");if(B&&d.has(B)){const S=d.get(B),z=m+S;b.push({id:B,path:z,title:`第 ${v} 章`}),v++}}return{chapters:b,zipContent:e,basePath:m,coverImagePath:p?m+p:null}}async displayCoverPage(e,n,i,r,o,s,l,u,g){try{const d=u.zipContent.file(e.coverImagePath);if(!d)throw new Error("无法找到封面图片文件");const p=await d.async("arraybuffer"),c=e.coverImagePath.toLowerCase().split(".").pop();let b="image/jpeg";switch(c){case"png":b="image/png";break;case"gif":b="image/gif";break;case"svg":b="image/svg+xml";break;case"webp":b="image/webp";break;case"bmp":b="image/bmp";break}const m=new Blob([p],{type:b}),v=URL.createObjectURL(m),y=`
                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; 
                           height: 100%; padding: 20px; background: var(--b3-theme-surface);">
                    <h2 style="color: var(--b3-theme-on-surface); margin-bottom: 20px; text-align: center;">${e.title}</h2>
                    <img src="${v}" alt="封面" 
                         style="max-width: 90%; max-height: 70%; object-fit: contain; 
                               border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);" 
                         onload="" 
                         onerror="" />
                </div>
            `;n.innerHTML=y,n.style.display="block",n.style.overflow="auto",n.style.height="100%",i.style.display="none",r.style.display="block",l.textContent=`${g+1} / ${u.chapters.length}`,o.disabled=g===0,s.disabled=g===u.chapters.length-1,o.onclick=()=>{g>0&&this.displayEpubChapter(u,g-1,n,i,r,o,s,l)},s.onclick=()=>{g<u.chapters.length-1&&this.displayEpubChapter(u,g+1,n,i,r,o,s,l)},setTimeout(()=>{URL.revokeObjectURL(v)},6e4)}catch(d){i.innerHTML=`
                <div style="text-align: center; color: var(--b3-theme-error);">
                    <p>❌ 显示封面失败</p>
                    <p style="font-size: 12px; margin-top: 10px;">错误: ${d.message}</p>
                </div>
            `,i.style.display="flex",n.style.display="none",r.style.display="none"}}async processEpubImages(e,n,i){const r=e.querySelectorAll("img");for(const o of r){const s=o.getAttribute("src");if(s&&!s.startsWith("http")&&!s.startsWith("data:"))try{let l=s;if(s.startsWith("/"))l=s.substring(1);else if(s.startsWith("../")){const g=i.substring(0,i.lastIndexOf("/"));l=g.substring(0,g.lastIndexOf("/")+1)+s.substring(3)}else l=i.substring(0,i.lastIndexOf("/")+1)+s;let u=n.zipContent.file(l);if(!u){const g=s.split("/").pop(),d=[`images/${g}`,`Images/${g}`,`OEBPS/images/${g}`,`OEBPS/Images/${g}`,`text/images/${g}`,`content/images/${g}`,g];for(const p of d)if(u=n.zipContent.file(p),u)break}if(u){const g=await u.async("arraybuffer"),d=l.toLowerCase().split(".").pop();let p="image/jpeg";switch(d){case"png":p="image/png";break;case"gif":p="image/gif";break;case"svg":p="image/svg+xml";break;case"webp":p="image/webp";break;case"bmp":p="image/bmp";break}const c=new Blob([g],{type:p}),b=URL.createObjectURL(c);o.setAttribute("src",b),o.style.maxWidth="100%",o.style.height="auto",o.style.display="block",o.style.margin="10px auto",o.onload=()=>{setTimeout(()=>{URL.revokeObjectURL(b)},6e4)}}else o.style.border="1px dashed #ccc",o.style.padding="10px",o.alt=`图片未找到: ${s}`}catch{}}}async displayEpubChapter(e,n,i,r,o,s,l,u){var g;try{const d=e.chapters[n];if(!d)throw new Error("章节不存在");if(d.isCover&&d.coverImagePath){await this.displayCoverPage(d,i,r,o,s,l,u,e,n);return}const p=await((g=e.zipContent.file(d.path))==null?void 0:g.async("text"));if(!p)throw new Error("无法读取章节内容");const b=new DOMParser().parseFromString(p,"text/html"),m=b.body||b.documentElement;m.querySelectorAll("script, style").forEach(y=>y.remove()),m.querySelectorAll("svg image, image[xlink:href]").forEach(y=>{y.remove()}),await this.processEpubImages(m,e,d.path);const v=`
                <div style="padding: 20px; line-height: 1.6; font-size: 16px; color: var(--b3-theme-on-surface); 
                           font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                           max-width: 100%; word-wrap: break-word; overflow-wrap: break-word;">
                    ${m.innerHTML}
                </div>
            `;i.innerHTML=v,i.style.display="block",i.style.overflow="auto",i.style.height="100%",r.style.display="none",o.style.display="block",u.textContent=`${n+1} / ${e.chapters.length}`,s.disabled=n===0,l.disabled=n===e.chapters.length-1,s.onclick=()=>{n>0&&this.displayEpubChapter(e,n-1,i,r,o,s,l,u)},l.onclick=()=>{n<e.chapters.length-1&&this.displayEpubChapter(e,n+1,i,r,o,s,l,u)},i.scrollTop=0}catch{r.innerHTML=`
                <div style="text-align: center; color: var(--b3-theme-error);">
                    <p>❌ 显示章节内容失败</p>
                    <p style="font-size: 12px; margin-top: 10px;">请尝试下载文件后使用专业阅读器打开</p>
                </div>
            `,r.style.display="flex",i.style.display="none",o.style.display="none"}}downloadFile(e,n){const i=new Blob([n]),r=URL.createObjectURL(i),o=document.createElement("a");o.href=r,o.download=e,o.click(),setTimeout(()=>URL.revokeObjectURL(r),1e3),K.showMessage(`文件 ${e} 已下载`,3e3,"info")}isImageFile(e){return[".jpg",".jpeg",".png",".gif",".bmp",".webp",".svg"].some(i=>e.toLowerCase().endsWith(i))}isPdfFile(e){return e.toLowerCase().endsWith(".pdf")}isAudioFile(e){return[".mp3",".wav",".ogg",".m4a",".aac",".flac",".wma"].some(i=>e.toLowerCase().endsWith(i))}isVideoFile(e){return[".mp4",".avi",".mov",".wmv",".flv",".webm",".mkv",".m4v"].some(i=>e.toLowerCase().endsWith(i))}isOfficeFile(e){return[".doc",".docx",".xls",".xlsx",".ppt",".pptx"].some(i=>e.toLowerCase().endsWith(i))}isEpubFile(e){return e.toLowerCase().endsWith(".epub")}getAudioMimeType(e){const n=e.toLowerCase().split(".").pop();return{mp3:"audio/mpeg",wav:"audio/wav",ogg:"audio/ogg",aac:"audio/aac",flac:"audio/flac",m4a:"audio/mp4",wma:"audio/x-ms-wma"}[n||""]||"audio/mpeg"}getVideoMimeType(e){const n=e.toLowerCase().split(".").pop();return{mp4:"video/mp4",avi:"video/x-msvideo",mov:"video/quicktime",wmv:"video/x-ms-wmv",flv:"video/x-flv",webm:"video/webm",mkv:"video/x-matroska","3gp":"video/3gpp"}[n||""]||"video/mp4"}openFileManager(){if(this.fileManagerDock)try{this.fileManagerDock.config.show=!0,setTimeout(()=>{const e=document.querySelectorAll(".dock__item");for(let i=0;i<e.length;i++){const r=e[i],o=r.getAttribute("aria-label")||r.title||"";if(o.includes("加密文件管理器")||o.includes("file-manager")){r.click();return}}const n=document.querySelectorAll('[data-type="file-manager-dock"], .iconCryptFile');if(n.length>0){n[0].click();return}},100)}catch{K.showMessage("显示文件管理器面板失败",3e3,"error")}else K.showMessage("文件管理器面板未初始化",3e3,"error")}async onunload(){K.showMessage("加密文件管理器已关闭"),document.removeEventListener("click",this.cryptLinkClickBindThis,!0),document.removeEventListener("click",this.cryptLinkClickBindThis,!1),this.fileManagerDock&&(this.fileManagerDock=null)}uninstall(){}async updateCards(e){return e.cards.sort((n,i)=>n.blockID<i.blockID?-1:n.blockID>i.blockID?1:0),e}openDIYSetting(){let e=new K.Dialog({title:"SettingPannel",content:'<div id="SettingPanel" style="height: 100%;"></div>',width:"800px",destroyCallback:i=>{n.$destroy()}}),n=new kr({target:e.element.querySelector("#SettingPanel")})}eventBusPaste(e){e.preventDefault(),e.detail.resolve({textPlain:e.detail.textPlain.trim()})}eventBusLog({detail:e}){}blockIconEvent({detail:e}){e.menu.addItem({iconHTML:"",label:this.i18n.removeSpace,click:()=>{const n=[];e.blockElements.forEach(i=>{const r=i.querySelector('[contenteditable="true"]');r&&(r.textContent=r.textContent.replace(/ /g,""),n.push({id:i.dataset.nodeId,data:i.outerHTML,action:"update"}))}),e.protyle.getInstance().transaction(n)}})}showDialog(){Gr({title:`SiYuan ${K.Constants.SIYUAN_VERSION}`,width:this.isMobile?"92vw":"720px",constructor:e=>new Zt({target:e,props:{app:this.app}})})}}module.exports=Yr;
